{"ast":null,"code":"import api from '@landinghub/api';\nimport { v4 as uuidv4 } from 'uuid';\nconst validateImageFile = file => {\n  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\n  if (!allowedTypes.includes(file.type)) {\n    return {\n      valid: false,\n      error: 'Chỉ chấp nhận file JPG, PNG, GIF, WebP'\n    };\n  }\n  if (file.size > 10 * 1024 * 1024) {\n    return {\n      valid: false,\n      error: 'File quá lớn (tối đa 10MB)'\n    };\n  }\n  return {\n    valid: true\n  };\n};\nconst compressImage = async file => {\n  try {\n    // Giả sử dùng một thư viện như compressorjs hoặc xử lý thủ công\n    // Ở đây chỉ trả về file gốc vì sharp chạy ở backend\n    return file;\n  } catch (error) {\n    throw new Error('Lỗi khi nén ảnh: ' + error.message);\n  }\n};\nconst uploadImage = async (file, pageId, setProgress) => {\n  const response = await api.post('/images/presigned-url', {\n    filename: file.name,\n    filetype: file.type,\n    pageId\n  });\n  const {\n    uploadUrl,\n    publicUrl,\n    key\n  } = response.data.data;\n  await api.put(uploadUrl, file, {\n    headers: {\n      'Content-Type': file.type\n    },\n    onUploadProgress: progressEvent => {\n      const percent = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n      setProgress(percent);\n    }\n  });\n  return {\n    data: {\n      id: uuidv4(),\n      url: publicUrl,\n      key,\n      name: file.name,\n      size: file.size,\n      mimetype: file.type\n    }\n  };\n};\nconst uploadMultipleImages = async (files, pageId, setProgress) => {\n  const results = [];\n  for (let i = 0; i < files.length; i++) {\n    const file = files[i];\n    const response = await api.post('/images/presigned-url', {\n      filename: file.name,\n      filetype: file.type,\n      pageId\n    });\n    const {\n      uploadUrl,\n      publicUrl,\n      key\n    } = response.data.data;\n    await api.put(uploadUrl, file, {\n      headers: {\n        'Content-Type': file.type\n      },\n      onUploadProgress: progressEvent => {\n        const percent = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n        setProgress(Math.round((percent + i * 100) / files.length));\n      }\n    });\n    results.push({\n      id: uuidv4(),\n      url: publicUrl,\n      key,\n      name: file.name,\n      size: file.size,\n      mimetype: file.type\n    });\n  }\n  return {\n    data: results\n  };\n};\nconst getPageImages = async pageId => {\n  return await api.get(`/images/page/${pageId}`);\n};\nconst getUserImages = async () => {\n  return await api.get('/images/user');\n};\nconst deleteImage = async key => {\n  return await api.delete(`/images/${key}`);\n};\nexport default {\n  validateImageFile,\n  compressImage,\n  uploadImage,\n  uploadMultipleImages,\n  getPageImages,\n  getUserImages,\n  deleteImage\n};","map":{"version":3,"names":["api","v4","uuidv4","validateImageFile","file","allowedTypes","includes","type","valid","error","size","compressImage","Error","message","uploadImage","pageId","setProgress","response","post","filename","name","filetype","uploadUrl","publicUrl","key","data","put","headers","onUploadProgress","progressEvent","percent","Math","round","loaded","total","id","url","mimetype","uploadMultipleImages","files","results","i","length","push","getPageImages","get","getUserImages","deleteImage","delete"],"sources":["F:/landinghub-iconic/apps/web/src/components/imageService.js"],"sourcesContent":["import api from '@landinghub/api';\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nconst validateImageFile = (file) => {\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n        return { valid: false, error: 'Chỉ chấp nhận file JPG, PNG, GIF, WebP' };\r\n    }\r\n    if (file.size > 10 * 1024 * 1024) {\r\n        return { valid: false, error: 'File quá lớn (tối đa 10MB)' };\r\n    }\r\n    return { valid: true };\r\n};\r\n\r\nconst compressImage = async (file) => {\r\n    try {\r\n        // Giả sử dùng một thư viện như compressorjs hoặc xử lý thủ công\r\n        // Ở đây chỉ trả về file gốc vì sharp chạy ở backend\r\n        return file;\r\n    } catch (error) {\r\n        throw new Error('Lỗi khi nén ảnh: ' + error.message);\r\n    }\r\n};\r\n\r\nconst uploadImage = async (file, pageId, setProgress) => {\r\n    const response = await api.post('/images/presigned-url', {\r\n        filename: file.name,\r\n        filetype: file.type,\r\n        pageId,\r\n    });\r\n    const { uploadUrl, publicUrl, key } = response.data.data;\r\n\r\n    await api.put(uploadUrl, file, {\r\n        headers: { 'Content-Type': file.type },\r\n        onUploadProgress: (progressEvent) => {\r\n            const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total);\r\n            setProgress(percent);\r\n        },\r\n    });\r\n\r\n    return { data: { id: uuidv4(), url: publicUrl, key, name: file.name, size: file.size, mimetype: file.type } };\r\n};\r\n\r\nconst uploadMultipleImages = async (files, pageId, setProgress) => {\r\n    const results = [];\r\n    for (let i = 0; i < files.length; i++) {\r\n        const file = files[i];\r\n        const response = await api.post('/images/presigned-url', {\r\n            filename: file.name,\r\n            filetype: file.type,\r\n            pageId,\r\n        });\r\n        const { uploadUrl, publicUrl, key } = response.data.data;\r\n\r\n        await api.put(uploadUrl, file, {\r\n            headers: { 'Content-Type': file.type },\r\n            onUploadProgress: (progressEvent) => {\r\n                const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total);\r\n                setProgress(Math.round((percent + i * 100) / files.length));\r\n            },\r\n        });\r\n\r\n        results.push({ id: uuidv4(), url: publicUrl, key, name: file.name, size: file.size, mimetype: file.type });\r\n    }\r\n    return { data: results };\r\n};\r\n\r\nconst getPageImages = async (pageId) => {\r\n    return await api.get(`/images/page/${pageId}`);\r\n};\r\n\r\nconst getUserImages = async () => {\r\n    return await api.get('/images/user');\r\n};\r\n\r\nconst deleteImage = async (key) => {\r\n    return await api.delete(`/images/${key}`);\r\n};\r\n\r\nexport default {\r\n    validateImageFile,\r\n    compressImage,\r\n    uploadImage,\r\n    uploadMultipleImages,\r\n    getPageImages,\r\n    getUserImages,\r\n    deleteImage,\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}