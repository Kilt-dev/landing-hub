{"ast":null,"code":"var _s = $RefreshSig$();\n// src/components/CozeChat.js\nimport React, { useState, useEffect } from 'react';\nconst COZE_BOT_ID = process.env.REACT_APP_COZE_BOT_ID || '7564406577911463952';\nconst BACKEND_API_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:3001';\nconst CozeChat = () => {\n  _s();\n  // State để lưu token lấy từ backend\n  const [authToken, setAuthToken] = useState(null);\n\n  // useEffect đầu tiên: Chạy 1 lần để gọi API lấy token từ backend\n  useEffect(() => {\n    const fetchAuthToken = async () => {\n      try {\n        const response = await fetch(`${BACKEND_API_URL}/api/coze/auth`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        setAuthToken(data.token);\n      } catch (error) {\n        console.error(\"Could not fetch Coze auth token:\", error);\n      }\n    };\n    fetchAuthToken();\n  }, []); // Mảng rỗng `[]` đảm bảo nó chỉ chạy một lần khi component mount\n\n  // useEffect thứ hai: Chạy khi `authToken` đã có giá trị\n  useEffect(() => {\n    // Nếu chưa có token thì không làm gì cả\n    if (!authToken) {\n      return;\n    }\n\n    // Tải script SDK của Coze\n    const script = document.createElement('script');\n    script.src = \"https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.6/libs/oversea/index.js\";\n    script.async = true;\n\n    // Chỉ khởi tạo chat sau khi script đã được tải xong\n    script.onload = () => {\n      if (window.CozeWebSDK) {\n        new window.CozeWebSDK.WebChatClient({\n          config: {\n            bot_id: COZE_BOT_ID\n          },\n          componentProps: {\n            title: 'LandingHub Assistant',\n            description: 'Trợ lý AI của bạn'\n          },\n          auth: {\n            type: 'token',\n            token: authToken // Sử dụng token an toàn từ backend\n          }\n        });\n      }\n    };\n\n    // Gắn script vào trang\n    document.body.appendChild(script);\n\n    // Hàm dọn dẹp: Sẽ chạy khi component bị unmount (chuyển trang)\n    // Rất quan trọng cho các ứng dụng SPA như React\n    return () => {\n      if (document.body.contains(script)) {\n        document.body.removeChild(script);\n      }\n      const chatWidget = document.querySelector('.web-chat-sdk-container');\n      if (chatWidget) {\n        chatWidget.remove();\n      }\n    };\n  }, [authToken]); // Dependency array: useEffect này sẽ chạy khi `authToken` thay đổi\n\n  return null; // Component này không render ra bất cứ thứ gì\n};\n_s(CozeChat, \"MU7XoFqhOQt3LwaTqLMgtB35PqI=\");\n_c = CozeChat;\nexport default CozeChat;\nvar _c;\n$RefreshReg$(_c, \"CozeChat\");","map":{"version":3,"names":["React","useState","useEffect","COZE_BOT_ID","process","env","REACT_APP_COZE_BOT_ID","BACKEND_API_URL","REACT_APP_BACKEND_URL","CozeChat","_s","authToken","setAuthToken","fetchAuthToken","response","fetch","ok","Error","status","data","json","token","error","console","script","document","createElement","src","async","onload","window","CozeWebSDK","WebChatClient","config","bot_id","componentProps","title","description","auth","type","body","appendChild","contains","removeChild","chatWidget","querySelector","remove","_c","$RefreshReg$"],"sources":["D:/landing-hub/apps/web/src/components/CozeChat.js"],"sourcesContent":["// src/components/CozeChat.js\r\nimport React, { useState, useEffect } from 'react';\r\n\r\nconst COZE_BOT_ID = process.env.REACT_APP_COZE_BOT_ID || '7564406577911463952';\r\nconst BACKEND_API_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:3001';\r\n\r\nconst CozeChat = () => {\r\n    // State để lưu token lấy từ backend\r\n    const [authToken, setAuthToken] = useState(null);\r\n\r\n    // useEffect đầu tiên: Chạy 1 lần để gọi API lấy token từ backend\r\n    useEffect(() => {\r\n        const fetchAuthToken = async () => {\r\n            try {\r\n                const response = await fetch(`${BACKEND_API_URL}/api/coze/auth`);\r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n                const data = await response.json();\r\n                setAuthToken(data.token);\r\n            } catch (error) {\r\n                console.error(\"Could not fetch Coze auth token:\", error);\r\n            }\r\n        };\r\n\r\n        fetchAuthToken();\r\n    }, []); // Mảng rỗng `[]` đảm bảo nó chỉ chạy một lần khi component mount\r\n\r\n    // useEffect thứ hai: Chạy khi `authToken` đã có giá trị\r\n    useEffect(() => {\r\n        // Nếu chưa có token thì không làm gì cả\r\n        if (!authToken) {\r\n            return;\r\n        }\r\n\r\n        // Tải script SDK của Coze\r\n        const script = document.createElement('script');\r\n        script.src = \"https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.6/libs/oversea/index.js\";\r\n        script.async = true;\r\n\r\n        // Chỉ khởi tạo chat sau khi script đã được tải xong\r\n        script.onload = () => {\r\n            if (window.CozeWebSDK) {\r\n                new window.CozeWebSDK.WebChatClient({\r\n                    config: {\r\n                        bot_id: COZE_BOT_ID,\r\n                    },\r\n                    componentProps: {\r\n                        title: 'LandingHub Assistant',\r\n                        description: 'Trợ lý AI của bạn',\r\n                    },\r\n                    auth: {\r\n                        type: 'token',\r\n                        token: authToken, // Sử dụng token an toàn từ backend\r\n                    },\r\n                });\r\n            }\r\n        };\r\n\r\n        // Gắn script vào trang\r\n        document.body.appendChild(script);\r\n\r\n        // Hàm dọn dẹp: Sẽ chạy khi component bị unmount (chuyển trang)\r\n        // Rất quan trọng cho các ứng dụng SPA như React\r\n        return () => {\r\n            if (document.body.contains(script)) {\r\n                document.body.removeChild(script);\r\n            }\r\n            const chatWidget = document.querySelector('.web-chat-sdk-container');\r\n            if (chatWidget) {\r\n                chatWidget.remove();\r\n            }\r\n        };\r\n    }, [authToken]); // Dependency array: useEffect này sẽ chạy khi `authToken` thay đổi\r\n\r\n    return null; // Component này không render ra bất cứ thứ gì\r\n};\r\n\r\nexport default CozeChat;"],"mappings":";AAAA;AACA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAElD,MAAMC,WAAW,GAAGC,OAAO,CAACC,GAAG,CAACC,qBAAqB,IAAI,qBAAqB;AAC9E,MAAMC,eAAe,GAAGH,OAAO,CAACC,GAAG,CAACG,qBAAqB,IAAI,uBAAuB;AAEpF,MAAMC,QAAQ,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB;EACA,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC;;EAEhD;EACAC,SAAS,CAAC,MAAM;IACZ,MAAMW,cAAc,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGR,eAAe,gBAAgB,CAAC;QAChE,IAAI,CAACO,QAAQ,CAACE,EAAE,EAAE;UACd,MAAM,IAAIC,KAAK,CAAC,uBAAuBH,QAAQ,CAACI,MAAM,EAAE,CAAC;QAC7D;QACA,MAAMC,IAAI,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;QAClCR,YAAY,CAACO,IAAI,CAACE,KAAK,CAAC;MAC5B,CAAC,CAAC,OAAOC,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MAC5D;IACJ,CAAC;IAEDT,cAAc,CAAC,CAAC;EACpB,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;;EAER;EACAX,SAAS,CAAC,MAAM;IACZ;IACA,IAAI,CAACS,SAAS,EAAE;MACZ;IACJ;;IAEA;IACA,MAAMa,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IAC/CF,MAAM,CAACG,GAAG,GAAG,oGAAoG;IACjHH,MAAM,CAACI,KAAK,GAAG,IAAI;;IAEnB;IACAJ,MAAM,CAACK,MAAM,GAAG,MAAM;MAClB,IAAIC,MAAM,CAACC,UAAU,EAAE;QACnB,IAAID,MAAM,CAACC,UAAU,CAACC,aAAa,CAAC;UAChCC,MAAM,EAAE;YACJC,MAAM,EAAE/B;UACZ,CAAC;UACDgC,cAAc,EAAE;YACZC,KAAK,EAAE,sBAAsB;YAC7BC,WAAW,EAAE;UACjB,CAAC;UACDC,IAAI,EAAE;YACFC,IAAI,EAAE,OAAO;YACblB,KAAK,EAAEV,SAAS,CAAE;UACtB;QACJ,CAAC,CAAC;MACN;IACJ,CAAC;;IAED;IACAc,QAAQ,CAACe,IAAI,CAACC,WAAW,CAACjB,MAAM,CAAC;;IAEjC;IACA;IACA,OAAO,MAAM;MACT,IAAIC,QAAQ,CAACe,IAAI,CAACE,QAAQ,CAAClB,MAAM,CAAC,EAAE;QAChCC,QAAQ,CAACe,IAAI,CAACG,WAAW,CAACnB,MAAM,CAAC;MACrC;MACA,MAAMoB,UAAU,GAAGnB,QAAQ,CAACoB,aAAa,CAAC,yBAAyB,CAAC;MACpE,IAAID,UAAU,EAAE;QACZA,UAAU,CAACE,MAAM,CAAC,CAAC;MACvB;IACJ,CAAC;EACL,CAAC,EAAE,CAACnC,SAAS,CAAC,CAAC,CAAC,CAAC;;EAEjB,OAAO,IAAI,CAAC,CAAC;AACjB,CAAC;AAACD,EAAA,CAtEID,QAAQ;AAAAsC,EAAA,GAARtC,QAAQ;AAwEd,eAAeA,QAAQ;AAAC,IAAAsC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}