{"ast":null,"code":"// ==================== EVENT RUNTIME GENERATOR ====================\n\n/**\r\n * Generate runtime script ƒë·ªÉ x·ª≠ l√Ω events trong HTML tƒ©nh\r\n * @param {Array} events - Danh s√°ch events t·ª´ pageData\r\n * @param {Array} popups - Danh s√°ch popup elements\r\n * @returns {string} - JavaScript code\r\n */\nconst generateEventRuntime = (events, popups) => {\n  return `\n    // Landing Page Builder Runtime v1.0\n    (function() {\n        'use strict';\n        \n        window.LPB = window.LPB || {};\n        \n        // ========== POPUP MANAGER ==========\n        LPB.popups = {\n            active: new Set(),\n            \n            open: function(popupId, data) {\n                const popup = document.getElementById(popupId);\n                if (!popup) {\n                    console.error('[LPB] Popup not found:', popupId);\n                    return;\n                }\n                \n                // Update content n·∫øu c√≥ data\n                if (data && data.html) {\n                    const content = popup.querySelector('.lpb-popup-body');\n                    if (content) content.innerHTML = data.html;\n                }\n                \n                // Show popup\n                popup.classList.add('lpb-popup-active');\n                document.body.style.overflow = 'hidden';\n                this.active.add(popupId);\n                \n                // Analytics tracking\n                if (window.gtag) {\n                    gtag('event', 'popup_open', {\n                        event_category: 'Engagement',\n                        event_label: popupId\n                    });\n                }\n            },\n            \n            close: function(popupId) {\n                const popup = document.getElementById(popupId);\n                if (popup) {\n                    popup.classList.remove('lpb-popup-active');\n                    this.active.delete(popupId);\n                    \n                    // Restore scroll n·∫øu kh√¥ng c√≤n popup n√†o\n                    if (this.active.size === 0) {\n                        document.body.style.overflow = '';\n                    }\n                }\n            },\n            \n            closeAll: function() {\n                this.active.forEach(id => this.close(id));\n            }\n        };\n        \n        // ========== API MANAGER ==========\n        LPB.api = {\n            cache: new Map(),\n            \n            getCacheKey: function(endpoint, params) {\n                return endpoint + JSON.stringify(params || {});\n            },\n            \n            fetch: async function(endpoint, options = {}) {\n                const cacheKey = this.getCacheKey(endpoint, options.params);\n                \n                // Check cache\n                if (this.cache.has(cacheKey)) {\n                    const cached = this.cache.get(cacheKey);\n                    const now = Date.now();\n                    const TTL = options.ttl || 5 * 60 * 1000; // 5 ph√∫t default\n                    \n                    if (now - cached.timestamp < TTL) {\n                        console.log('[LPB] Cache hit:', endpoint);\n                        return cached.data;\n                    }\n                }\n                \n                // Fetch m·ªõi\n                try {\n                    console.log('[LPB] Fetching:', endpoint);\n                    const response = await fetch(endpoint, {\n                        method: options.method || 'GET',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            ...options.headers\n                        },\n                        body: options.data ? JSON.stringify(options.data) : undefined\n                    });\n                    \n                    if (!response.ok) {\n                        throw new Error(\\`HTTP \\${response.status}: \\${response.statusText}\\`);\n                    }\n                    \n                    const data = await response.json();\n                    \n                    // Cache result\n                    this.cache.set(cacheKey, {\n                        data: data,\n                        timestamp: Date.now()\n                    });\n                    \n                    return data;\n                } catch (error) {\n                    console.error('[LPB] API Error:', error);\n                    throw error;\n                }\n            },\n            \n            clearCache: function(endpoint) {\n                if (endpoint) {\n                    for (let key of this.cache.keys()) {\n                        if (key.startsWith(endpoint)) {\n                            this.cache.delete(key);\n                        }\n                    }\n                } else {\n                    this.cache.clear();\n                }\n            }\n        };\n        \n        // ========== EVENT HANDLER ==========\n        LPB.handleEvent = async function(config) {\n            const { type } = config;\n            \n            try {\n                switch(type) {\n                    case 'openPopup':\n                        if (!config.popupId) {\n                            console.error('[LPB] Missing popupId');\n                            return;\n                        }\n                        this.popups.open(config.popupId, config.data);\n                        break;\n                        \n                    case 'closePopup':\n                        const targetPopupId = config.popupId || config.elementId;\n                        if (!targetPopupId) {\n                            console.error('[LPB] Missing popupId');\n                            return;\n                        }\n                        this.popups.close(targetPopupId);\n                        break;\n                        \n                    case 'triggerApi':\n                        if (!config.apiUrl) {\n                            console.error('[LPB] Missing apiUrl');\n                            return;\n                        }\n                        const data = await this.api.fetch(config.apiUrl, {\n                            method: config.method || 'GET',\n                            params: config.params,\n                            data: config.data\n                        });\n                        \n                        // Update target n·∫øu c√≥\n                        if (config.updateTarget) {\n                            const target = document.getElementById(config.updateTarget);\n                            if (target && data.html) {\n                                target.innerHTML = data.html;\n                            }\n                        }\n                        break;\n                        \n                    case 'both':\n                        // Open popup immediately v·ªõi loading\n                        this.popups.open(config.popupId, { \n                            html: '<div style=\"text-align:center;padding:40px;\"><div class=\"lpb-spinner\"></div><p>ƒêang t·∫£i...</p></div>' \n                        });\n                        \n                        // Fetch API in background\n                        const apiData = await this.api.fetch(config.apiUrl, {\n                            method: config.method || 'GET',\n                            params: config.params\n                        });\n                        \n                        // Update popup content\n                        this.popups.open(config.popupId, { html: apiData.html || JSON.stringify(apiData) });\n                        break;\n                        \n                    case 'navigate':\n                        if (!config.url) {\n                            console.error('[LPB] Missing url');\n                            return;\n                        }\n                        if (config.newTab) {\n                            window.open(config.url, '_blank');\n                        } else {\n                            window.location.href = config.url;\n                        }\n                        break;\n                        \n                    case 'scrollToSection':\n                        if (!config.sectionId) {\n                            console.error('[LPB] Missing sectionId');\n                            return;\n                        }\n                        const section = document.querySelector(\\`[data-element-id=\"\\${config.sectionId}\"]\\`);\n                        if (section) {\n                            section.scrollIntoView({ \n                                behavior: config.smooth !== false ? 'smooth' : 'auto',\n                                block: 'start'\n                            });\n                        } else {\n                            console.error('[LPB] Section not found:', config.sectionId);\n                        }\n                        break;\n                        \n                    case 'submitForm':\n                        if (!config.apiUrl) {\n                            console.error('[LPB] Missing apiUrl');\n                            return;\n                        }\n                        console.log('[LPB] Form submit to:', config.apiUrl);\n                        break;\n                        \n                    default:\n                        console.warn('[LPB] Unknown event type:', type);\n                }\n            } catch (error) {\n                console.error('[LPB] Event handling error:', error);\n                alert('C√≥ l·ªói x·∫£y ra: ' + error.message);\n            }\n        };\n        \n        // ========== AUTO-BIND EVENTS ==========\n        const eventsConfig = ${JSON.stringify(events, null, 2)};\n        \n        document.addEventListener('DOMContentLoaded', function() {\n            console.log('[LPB] Initializing events...', eventsConfig.length);\n            \n            eventsConfig.forEach(config => {\n                const element = document.getElementById(config.elementId);\n                if (!element) {\n                    console.warn('[LPB] Element not found:', config.elementId);\n                    return;\n                }\n                \n                // Bind onClick\n                if (config.events.onClick && config.events.onClick.type !== 'none') {\n                    element.addEventListener('click', function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        LPB.handleEvent(config.events.onClick);\n                    });\n                    \n                    element.style.cursor = 'pointer';\n                }\n                \n                // Bind hover prefetch\n                if (config.events.onClick?.params?.apiConfig?.preload) {\n                    element.addEventListener('mouseenter', function() {\n                        LPB.api.fetch(\n                            config.events.onClick.params.apiConfig.endpoint,\n                            config.events.onClick.params.apiConfig\n                        ).catch(() => {}); // Silent prefetch\n                    }, { once: true });\n                }\n                \n                // Bind onHover effects\n                if (config.events.onHover) {\n                    const hoverClass = config.events.onHover.className;\n                    if (hoverClass) {\n                        element.addEventListener('mouseenter', function() {\n                            this.classList.add(hoverClass);\n                        });\n                        element.addEventListener('mouseleave', function() {\n                            this.classList.remove(hoverClass);\n                        });\n                    }\n                }\n            });\n            \n            console.log('[LPB] Events initialized!');\n        });\n        \n        // ========== ESC TO CLOSE POPUP ==========\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                LPB.popups.closeAll();\n            }\n        });\n        \n        console.log('[LPB] Runtime loaded');\n    })();\n    `;\n};\n\n/**\r\n * Extract t·∫•t c·∫£ events t·ª´ pageData elements (FIXED - Recursive & No Duplicates)\r\n * @param {Object} pageData - Page data object\r\n * @returns {Array} - Array of event configs\r\n */\nconst extractEvents = pageData => {\n  const events = [];\n  const processedIds = new Set(); // Track processed IDs to avoid duplicates\n\n  const processElement = (element, parentId = null) => {\n    var _element$componentDat;\n    const elementId = element.id;\n\n    // Skip n·∫øu ƒë√£ x·ª≠ l√Ω\n    if (processedIds.has(elementId)) {\n      console.warn(`[extractEvents] ‚ö†Ô∏è Duplicate ID detected (skipped): ${elementId}`);\n      return;\n    }\n    processedIds.add(elementId);\n\n    // Check element events\n    if ((_element$componentDat = element.componentData) !== null && _element$componentDat !== void 0 && _element$componentDat.events) {\n      const hasValidEvent = Object.values(element.componentData.events).some(event => event && typeof event === 'object' && event.type && event.type !== 'none');\n      if (hasValidEvent) {\n        events.push({\n          elementId: elementId,\n          events: element.componentData.events,\n          type: element.type,\n          parentId: parentId\n        });\n        console.log(`[extractEvents] ‚úì Added event for: ${elementId}`);\n      }\n    }\n\n    // Recursive cho children\n    if (Array.isArray(element.children)) {\n      element.children.forEach(child => {\n        processElement(child, elementId);\n      });\n    }\n  };\n  pageData.elements.forEach(element => {\n    processElement(element, null);\n  });\n  console.log(`[extractEvents] ‚úÖ Total events extracted: ${events.length}`);\n  return events;\n};\n\n/**\r\n * Render t·∫•t c·∫£ popups th√†nh HTML\r\n * @param {Array} popups - Array of popup elements\r\n * @returns {string} - HTML string\r\n */\nconst renderPopupsHTML = popups => {\n  return popups.map(popup => {\n    const {\n      id,\n      componentData = {},\n      styles = {},\n      size = {},\n      children = []\n    } = popup;\n\n    // Render children content recursively\n    const childrenHTML = children.map(child => renderElementHTML(child, true)).join('');\n    return `\n            <div \n                id=\"${id}\" \n                class=\"lpb-popup\" \n                data-element-id=\"${id}\"\n                style=\"display:none;\"\n            >\n                <!-- Overlay -->\n                <div \n                    class=\"lpb-popup-overlay\" \n                    onclick=\"LPB.popups.close('${id}')\"\n                ></div>\n                \n                <!-- Popup Container -->\n                <div \n                    class=\"lpb-popup-container\"\n                    style=\"\n                        width: ${size.width || 600}px;\n                        max-width: 90vw;\n                        min-height: ${size.height || 400}px;\n                        background: ${styles.background || componentData.background || 'rgba(255, 255, 255, 0.95)'};\n                        border-radius: ${styles.borderRadius || componentData.borderRadius || '12px'};\n                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);\n                    \"\n                >\n                    <!-- Header -->\n                    <div class=\"lpb-popup-header\">\n                        <h3 style=\"margin:0; font-size:16px; font-weight:600; color:#111827;\">\n                            ${componentData.title || 'Popup Title'}\n                        </h3>\n                        <button \n                            class=\"lpb-popup-close\" \n                            onclick=\"LPB.popups.close('${id}')\"\n                            aria-label=\"Close popup\"\n                        >\n                            ‚úï\n                        </button>\n                    </div>\n                    \n                    <!-- Body -->\n                    <div class=\"lpb-popup-body\" style=\"padding: ${componentData.padding || '20px'};\">\n                        ${childrenHTML || `<p style=\"color:#6b7280;\">${componentData.content || 'Popup content'}</p>`}\n                    </div>\n                </div>\n            </div>\n        `;\n  }).join('\\n');\n};\n\n/**\r\n * Render m·ªôt element th√†nh HTML v·ªõi proper ID (FIXED - Recursive Children)\r\n * @param {Object} element - Element object\r\n * @param {boolean} isChild - Whether this is a child element\r\n * @returns {string} - HTML string\r\n */\nconst renderElementHTML = (element, isChild = false) => {\n  var _position$desktop, _position$desktop2, _componentData$icon;\n  const {\n    id,\n    type,\n    componentData = {},\n    styles = {},\n    size = {},\n    position = {},\n    children = []\n  } = element;\n\n  // Convert styles object to inline CSS\n  const inlineStyles = Object.entries(styles).filter(([key]) => !key.startsWith(':') && !key.startsWith('@')).map(([key, value]) => {\n    const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\n    return `${kebabKey}:${value}`;\n  }).join(';');\n\n  // Base attributes\n  const baseAttrs = `\n        id=\"${id}\"\n        data-element-id=\"${id}\"\n        data-type=\"${type}\"\n        class=\"lpb-element lpb-${type}\"\n    `.trim();\n\n  // Position styles cho child elements\n  const positionStyles = isChild ? `\n        position: absolute;\n        left: ${((_position$desktop = position.desktop) === null || _position$desktop === void 0 ? void 0 : _position$desktop.x) || 0}px;\n        top: ${((_position$desktop2 = position.desktop) === null || _position$desktop2 === void 0 ? void 0 : _position$desktop2.y) || 0}px;\n        width: ${size.width || 200}px;\n        height: ${size.height || 50}px;\n    ` : '';\n\n  // Render children recursively\n  const childrenHTML = children.map(child => renderElementHTML(child, true)).join('');\n\n  // Render based on type\n  switch (type) {\n    case 'section':\n      return renderSectionHTML(element);\n    case 'button':\n      return `\n                <button \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Button'}\n                    ${childrenHTML}\n                </button>\n            `;\n    case 'heading':\n      const HeadingTag = componentData.level || 'h2';\n      return `\n                <${HeadingTag} \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Heading'}\n                    ${childrenHTML}\n                </${HeadingTag}>\n            `;\n    case 'paragraph':\n      return `\n                <p \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Paragraph'}\n                    ${childrenHTML}\n                </p>\n            `;\n    case 'image':\n      return `\n                <img \n                    ${baseAttrs}\n                    src=\"${componentData.src || componentData.imageUrl || 'https://via.placeholder.com/150'}\"\n                    alt=\"${componentData.alt || 'Image'}\"\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                />\n            `;\n    case 'icon':\n      const isSvg = (_componentData$icon = componentData.icon) === null || _componentData$icon === void 0 ? void 0 : _componentData$icon.startsWith('<svg');\n      return `\n                <div \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                    title=\"${componentData.title || ''}\"\n                >\n                    ${componentData.imageUrl ? `<img src=\"${componentData.imageUrl}\" alt=\"${componentData.title || 'Icon'}\" style=\"width:100%;height:100%;object-fit:contain;\" />` : isSvg ? componentData.icon : componentData.icon ? `<i class=\"${componentData.icon}\"></i>` : 'üì¶'}\n                    ${childrenHTML}\n                </div>\n            `;\n    case 'gallery':\n      return renderGalleryHTML(element, isChild);\n    default:\n      return `\n                <div \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || type}\n                    ${childrenHTML}\n                </div>\n            `;\n  }\n};\n\n/**\r\n * Render gallery element\r\n */\nconst renderGalleryHTML = (element, isChild) => {\n  var _position$desktop3, _position$desktop4;\n  const {\n    id,\n    componentData = {},\n    styles = {},\n    size = {},\n    position = {},\n    children = []\n  } = element;\n  const positionStyles = isChild ? `\n        position: absolute;\n        left: ${((_position$desktop3 = position.desktop) === null || _position$desktop3 === void 0 ? void 0 : _position$desktop3.x) || 0}px;\n        top: ${((_position$desktop4 = position.desktop) === null || _position$desktop4 === void 0 ? void 0 : _position$desktop4.y) || 0}px;\n    ` : '';\n  const images = componentData.images || [];\n\n  // Render gallery children if any\n  const galleryChildrenHTML = children.map(child => renderElementHTML(child, true)).join('');\n  return `\n        <div \n            id=\"${id}\"\n            data-element-id=\"${id}\"\n            data-type=\"gallery\"\n            class=\"lpb-element lpb-gallery\"\n            style=\"${positionStyles} width: ${size.width || 380}px; height: ${size.height || 300}px;\"\n        >\n            <div style=\"\n                display: ${styles.display || 'grid'};\n                grid-template-columns: ${styles.gridTemplateColumns || 'repeat(auto-fill, minmax(150px, 1fr))'};\n                gap: ${styles.gap || '10px'};\n                width: 100%;\n                height: 100%;\n            \">\n                ${images.map((imageUrl, index) => `\n                    <div style=\"\n                        position: relative;\n                        overflow: hidden;\n                        border-radius: ${styles.borderRadius || '8px'};\n                        aspect-ratio: 1 / 1;\n                    \">\n                        <img\n                            src=\"${imageUrl || 'https://via.placeholder.com/150'}\"\n                            alt=\"Gallery ${index + 1}\"\n                            style=\"\n                                width: 100%;\n                                height: 100%;\n                                object-fit: ${styles.objectFit || 'cover'};\n                                object-position: ${styles.objectPosition || 'center'};\n                            \"\n                            loading=\"lazy\"\n                        />\n                    </div>\n                `).join('')}\n                ${images.length === 0 ? `\n                    <div style=\"\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        color: #9ca3af;\n                        text-align: center;\n                        grid-column: 1 / -1;\n                    \">\n                        <i class=\"fas fa-image\" style=\"font-size: 48px; margin-bottom: 8px;\"></i>\n                        <p>Empty gallery</p>\n                    </div>\n                ` : ''}\n                ${galleryChildrenHTML}\n            </div>\n        </div>\n    `;\n};\n\n/**\r\n * Render section v·ªõi children\r\n */\nconst renderSectionHTML = section => {\n  var _position$desktop5;\n  const {\n    id,\n    componentData = {},\n    styles = {},\n    size = {},\n    position = {},\n    children = []\n  } = section;\n\n  // Render children recursively\n  const childrenHTML = children.map(child => renderElementHTML(child, true)).join('\\n');\n  return `\n        <section \n            id=\"${id}\"\n            data-element-id=\"${id}\"\n            class=\"lpb-section ladi-section\"\n            style=\"\n                position: absolute;\n                top: ${((_position$desktop5 = position.desktop) === null || _position$desktop5 === void 0 ? void 0 : _position$desktop5.y) || 0}px;\n                left: 50%;\n                transform: translateX(-50%);\n                width: 1200px;\n                height: ${size.height || 400}px;\n            \"\n        >\n            <!-- Background -->\n            <div class=\"ladi-section-background\" style=\"\n                position: absolute;\n                inset: 0;\n                z-index: 0;\n                background-color: ${componentData.backgroundColor || styles.backgroundColor || 'transparent'};\n                background-image: ${componentData.backgroundImage ? `url(${componentData.backgroundImage})` : 'none'};\n                background-size: cover;\n                background-position: center;\n            \"></div>\n            \n            <!-- Overlay -->\n            <div class=\"ladi-overlay\" style=\"\n                position: absolute;\n                inset: 0;\n                z-index: 0;\n                background-color: ${componentData.overlayColor || 'transparent'};\n                opacity: ${componentData.overlayOpacity || 0};\n            \"></div>\n            \n            <!-- Container -->\n            <div class=\"ladi-container\" style=\"\n                position: relative;\n                z-index: 1;\n                padding: ${componentData.padding || styles.padding || '20px'};\n                width: 100%;\n                height: 100%;\n            \">\n                ${childrenHTML}\n            </div>\n        </section>\n    `;\n};\n\n/**\r\n * Generate CSS t·ª´ pageData\r\n */\nconst generateCSS = pageData => {\n  let css = `\n        * {\n            box-sizing: border-box;\n        }\n        \n        body {\n            margin: 0;\n            padding: 0;\n        }\n        \n        .lpb-element {\n            transition: all 0.3s ease;\n        }\n    `;\n\n  // Extract pseudo-classes v√† animations t·ª´ elements (recursive)\n  const processElementStyles = element => {\n    const {\n      id,\n      styles = {}\n    } = element;\n\n    // Process hover states\n    if (styles[':hover']) {\n      css += `\\n#${id}:hover {`;\n      Object.entries(styles[':hover']).forEach(([key, value]) => {\n        const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\n        css += `${kebabKey}:${value};`;\n      });\n      css += `}`;\n    }\n\n    // Process keyframes\n    Object.entries(styles).forEach(([key, value]) => {\n      if (key.startsWith('@keyframes')) {\n        css += `\\n${key} {`;\n        Object.entries(value).forEach(([frame, props]) => {\n          css += `${frame} {`;\n          Object.entries(props).forEach(([prop, val]) => {\n            const kebabProp = prop.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\n            css += `${kebabProp}:${val};`;\n          });\n          css += `}`;\n        });\n        css += `}`;\n      }\n    });\n\n    // Recursive for children\n    if (element.children) {\n      element.children.forEach(child => processElementStyles(child));\n    }\n  };\n  pageData.elements.forEach(element => {\n    processElementStyles(element);\n  });\n  return css;\n};\n\n/**\r\n * Render to√†n b·ªô pageData th√†nh static HTML v·ªõi embedded runtime\r\n * @param {Object} pageData - Page data\r\n * @returns {string} - Complete HTML document\r\n */\nexport const renderStaticHTML = pageData => {\n  var _pageData$meta, _pageData$meta2, _pageData$canvas, _pageData$analytics;\n  console.log('[renderStaticHTML] Starting render...');\n  console.log('[renderStaticHTML] Page data:', pageData);\n\n  // Extract components\n  const popups = pageData.elements.filter(el => el.type === 'popup');\n  const sections = pageData.elements.filter(el => el.type === 'section');\n  const events = extractEvents(pageData);\n  console.log('[renderStaticHTML] Extracted:', {\n    popups: popups.length,\n    sections: sections.length,\n    events: events.length\n  });\n\n  // Generate HTML parts\n  const sectionsHTML = sections.map(section => renderSectionHTML(section)).join('\\n');\n  const popupsHTML = renderPopupsHTML(popups);\n  const runtimeScript = generateEventRuntime(events, popups);\n\n  // Generate CSS\n  const cssContent = generateCSS(pageData);\n\n  // Combine everything\n  return `<!DOCTYPE html>\n<html lang=\"vi\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta name=\"description\" content=\"${((_pageData$meta = pageData.meta) === null || _pageData$meta === void 0 ? void 0 : _pageData$meta.description) || 'Landing page generated by LandingHub'}\">\n    <title>${((_pageData$meta2 = pageData.meta) === null || _pageData$meta2 === void 0 ? void 0 : _pageData$meta2.title) || 'Landing Page'}</title>\n    \n    <!-- Font Awesome -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n    \n    <!-- Styles -->\n    <style>\n        ${cssContent}\n        \n        /* Popup Styles */\n        .lpb-popup {\n            position: fixed;\n            inset: 0;\n            z-index: 9999;\n            display: none;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .lpb-popup.lpb-popup-active {\n            display: flex;\n        }\n        \n        .lpb-popup-overlay {\n            position: absolute;\n            inset: 0;\n            background: rgba(0, 0, 0, 0.5);\n            cursor: pointer;\n        }\n        \n        .lpb-popup-container {\n            position: relative;\n            z-index: 1;\n            background: white;\n            border-radius: 12px;\n            max-height: 90vh;\n            overflow-y: auto;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n        }\n        \n        .lpb-popup-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 16px 20px;\n            border-bottom: 1px solid #e5e7eb;\n            background: linear-gradient(to bottom, #f9fafb, #ffffff);\n        }\n        \n        .lpb-popup-close {\n            width: 28px;\n            height: 28px;\n            border: none;\n            background: transparent;\n            cursor: pointer;\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.15s ease;\n            color: #6b7280;\n            font-size: 18px;\n            font-weight: bold;\n        }\n        \n        .lpb-popup-close:hover {\n            background: #f3f4f6;\n            color: #111827;\n        }\n        \n        .lpb-popup-body {\n            padding: 20px;\n        }\n        \n        /* Loading Spinner */\n        .lpb-spinner {\n            border: 3px solid #f3f3f3;\n            border-top: 3px solid #3b82f6;\n            border-radius: 50%;\n            width: 40px;\n            height: 40px;\n            animation: spin 1s linear infinite;\n            margin: 0 auto;\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        \n        /* Responsive */\n        @media (max-width: 768px) {\n            .lpb-section {\n                width: 100% !important;\n            }\n            \n            .lpb-popup-container {\n                width: 90% !important;\n                max-width: 90vw !important;\n            }\n        }\n    </style>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\">\n    <!-- Canvas -->\n    <div id=\"lpb-canvas\" style=\"\n        position: relative;\n        min-height: 100vh;\n        background: ${((_pageData$canvas = pageData.canvas) === null || _pageData$canvas === void 0 ? void 0 : _pageData$canvas.background) || '#ffffff'};\n    \">\n        ${sectionsHTML}\n    </div>\n    \n    <!-- Popups -->\n    ${popupsHTML}\n    \n    <!-- Runtime Script -->\n    <script>\n        ${runtimeScript}\n    </script>\n    \n    <!-- Google Analytics (optional) -->\n    ${(_pageData$analytics = pageData.analytics) !== null && _pageData$analytics !== void 0 && _pageData$analytics.googleAnalyticsId ? `\n    <script async src=\"https://www.googletagmanager.com/gtag/js?id=${pageData.analytics.googleAnalyticsId}\"></script>\n    <script>\n        window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n        gtag('config', '${pageData.analytics.googleAnalyticsId}');\n    </script>\n    ` : ''}\n</body>\n</html>`;\n};\n\n/**\r\n * Parse HTML string th√†nh pageData structure (FIXED - Recursive Parsing)\r\n */\nexport const parseHTMLToPageData = htmlString => {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(htmlString, 'text/html');\n  const pageData = {\n    canvas: {\n      width: 1200,\n      height: 'auto',\n      background: '#ffffff'\n    },\n    elements: [],\n    meta: {}\n  };\n  try {\n    // Parse canvas\n    const canvasEl = doc.getElementById('lpb-canvas');\n    if (canvasEl) {\n      pageData.canvas.background = canvasEl.style.background || '#ffffff';\n    }\n\n    // Parse meta\n    const titleEl = doc.querySelector('title');\n    if (titleEl) {\n      pageData.meta.title = titleEl.textContent;\n    }\n    const descEl = doc.querySelector('meta[name=\"description\"]');\n    if (descEl) {\n      pageData.meta.description = descEl.getAttribute('content');\n    }\n\n    // Parse sections\n    const sections = doc.querySelectorAll('.lpb-section');\n    sections.forEach(sectionEl => {\n      const section = parseElementRecursive(sectionEl, 'section');\n      if (section) {\n        pageData.elements.push(section);\n      }\n    });\n\n    // Parse popups\n    const popups = doc.querySelectorAll('.lpb-popup');\n    popups.forEach(popupEl => {\n      const popup = parseElementRecursive(popupEl, 'popup');\n      if (popup) {\n        pageData.elements.push(popup);\n      }\n    });\n\n    // Parse events t·ª´ script (improved regex)\n    const scripts = doc.querySelectorAll('script');\n    scripts.forEach(script => {\n      const content = script.textContent || script.innerHTML;\n      // Improved regex to capture JSON array more reliably\n      const eventsMatch = content.match(/eventsConfig\\s*=\\s*(\\[[\\s\\S]*?\\]);/);\n      if (eventsMatch) {\n        try {\n          // Clean up the captured string (remove comments if any)\n          const jsonStr = eventsMatch[1].replace(/\\/\\/.*$/gm, '').trim();\n          const events = JSON.parse(jsonStr);\n          events.forEach(eventConfig => {\n            const element = findElementById(pageData.elements, eventConfig.elementId);\n            if (element) {\n              if (!element.componentData) {\n                element.componentData = {};\n              }\n              element.componentData.events = eventConfig.events;\n            }\n          });\n          console.log(`[parseHTMLToPageData] Parsed ${events.length} events`);\n        } catch (e) {\n          console.warn('[parseHTMLToPageData] Cannot parse events config:', e, jsonStr);\n        }\n      }\n    });\n    console.log('[parseHTMLToPageData] Parsed successfully:', pageData.elements.length, 'elements');\n    return pageData;\n  } catch (error) {\n    console.error('[parseHTMLToPageData] Parse error:', error);\n    return {\n      canvas: {\n        width: 1200,\n        height: 'auto',\n        background: '#ffffff'\n      },\n      elements: [],\n      meta: {}\n    };\n  }\n};\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\r\n * Parse element recursively (FIXED - Handles nested children)\r\n * @param {HTMLElement} elementEl - DOM element\r\n * @param {string} parentType - Type of parent (section/popup)\r\n * @returns {Object} Parsed element object\r\n */\nconst parseElementRecursive = (elementEl, parentType) => {\n  const id = elementEl.id || element.getAttribute('data-element-id') || `${parentType}-${Date.now()}`;\n  const type = parentType;\n  const styles = parseInlineStyles(elementEl.style);\n  let componentData = {};\n  let position = {\n    desktop: {\n      x: 0,\n      y: 0\n    },\n    tablet: {\n      x: 0,\n      y: 0\n    },\n    mobile: {\n      x: 0,\n      y: 0\n    }\n  };\n  let size = {\n    width: 1200,\n    height: 400\n  };\n  if (parentType === 'section') {\n    var _elementEl$style$top, _elementEl$style$widt, _elementEl$style$heig;\n    const topMatch = (_elementEl$style$top = elementEl.style.top) === null || _elementEl$style$top === void 0 ? void 0 : _elementEl$style$top.match(/(\\d+)px/);\n    position.desktop.y = topMatch ? parseInt(topMatch[1]) : 0;\n    position.tablet.y = position.desktop.y;\n    position.mobile.y = position.desktop.y;\n    const widthMatch = (_elementEl$style$widt = elementEl.style.width) === null || _elementEl$style$widt === void 0 ? void 0 : _elementEl$style$widt.match(/(\\d+)px/);\n    const heightMatch = (_elementEl$style$heig = elementEl.style.height) === null || _elementEl$style$heig === void 0 ? void 0 : _elementEl$style$heig.match(/(\\d+)px/);\n    size.width = widthMatch ? parseInt(widthMatch[1]) : 1200;\n    size.height = heightMatch ? parseInt(heightMatch[1]) : 400;\n    const bgEl = elementEl.querySelector('.ladi-section-background');\n    const overlayEl = elementEl.querySelector('.ladi-overlay');\n    const containerEl = elementEl.querySelector('.ladi-container');\n    componentData = {\n      structure: 'ladi-standard'\n    };\n    if (bgEl) {\n      var _bgStyle$backgroundIm;\n      const bgStyle = bgEl.style;\n      componentData.backgroundColor = bgStyle.backgroundColor || 'transparent';\n      const bgImageMatch = (_bgStyle$backgroundIm = bgStyle.backgroundImage) === null || _bgStyle$backgroundIm === void 0 ? void 0 : _bgStyle$backgroundIm.match(/url\\(['\"]?(.+?)['\"]?\\)/);\n      if (bgImageMatch) {\n        componentData.backgroundImage = bgImageMatch[1];\n        componentData.backgroundType = 'image';\n      } else if (componentData.backgroundColor !== 'transparent') {\n        componentData.backgroundType = 'color';\n      }\n      componentData.backgroundPosition = bgStyle.backgroundPosition || 'center';\n    }\n    if (overlayEl) {\n      componentData.overlayColor = overlayEl.style.backgroundColor || 'transparent';\n      componentData.overlayOpacity = parseFloat(overlayEl.style.opacity) || 0;\n    }\n    if (containerEl) {\n      componentData.padding = containerEl.style.padding || '20px';\n    }\n  } else if (parentType === 'popup') {\n    var _containerEl$style$wi, _containerEl$style$mi;\n    const containerEl = elementEl.querySelector('.lpb-popup-container');\n    if (!containerEl) return null;\n    const widthMatch = (_containerEl$style$wi = containerEl.style.width) === null || _containerEl$style$wi === void 0 ? void 0 : _containerEl$style$wi.match(/(\\d+)px/);\n    const minHeightMatch = (_containerEl$style$mi = containerEl.style.minHeight) === null || _containerEl$style$mi === void 0 ? void 0 : _containerEl$style$mi.match(/(\\d+)px/);\n    size.width = widthMatch ? parseInt(widthMatch[1]) : 600;\n    size.height = minHeightMatch ? parseInt(minHeightMatch[1]) : 400;\n    const headerEl = elementEl.querySelector('.lpb-popup-header h3');\n    const bodyEl = elementEl.querySelector('.lpb-popup-body');\n    componentData = {\n      title: (headerEl === null || headerEl === void 0 ? void 0 : headerEl.textContent) || 'Popup',\n      background: containerEl.style.background || 'rgba(255, 255, 255, 0.95)',\n      borderRadius: containerEl.style.borderRadius || '12px',\n      padding: (bodyEl === null || bodyEl === void 0 ? void 0 : bodyEl.style.padding) || '20px'\n    };\n  }\n\n  // Parse children recursively\n  const children = [];\n  const containerSelector = parentType === 'section' ? '.ladi-container' : '.lpb-popup-body';\n  const containerEl = elementEl.querySelector(containerSelector);\n  if (containerEl) {\n    const childElements = containerEl.querySelectorAll('[data-element-id]');\n    childElements.forEach(childEl => {\n      // Only direct children or properly nested\n      if (childEl.parentElement === containerEl) {\n        const child = parseChildElementRecursive(childEl);\n        if (child) {\n          children.push(child);\n        }\n      }\n    });\n  }\n  return {\n    id,\n    type,\n    componentData,\n    position,\n    size,\n    styles,\n    children,\n    visible: true,\n    locked: false\n  };\n};\n\n/**\r\n * Parse child element recursively (FIXED - Nested Children)\r\n * @param {HTMLElement} childEl - DOM child element\r\n * @returns {Object} Parsed child object\r\n */\nconst parseChildElementRecursive = childEl => {\n  var _childEl$style$left, _childEl$style$top, _childEl$style$width, _childEl$style$height;\n  const id = childEl.id || childEl.getAttribute('data-element-id') || `child-${Date.now()}`;\n  const type = childEl.getAttribute('data-type') || inferTypeFromElement(childEl);\n  const leftMatch = (_childEl$style$left = childEl.style.left) === null || _childEl$style$left === void 0 ? void 0 : _childEl$style$left.match(/(\\d+)px/);\n  const topMatch = (_childEl$style$top = childEl.style.top) === null || _childEl$style$top === void 0 ? void 0 : _childEl$style$top.match(/(\\d+)px/);\n  const left = leftMatch ? parseInt(leftMatch[1]) : 0;\n  const top = topMatch ? parseInt(topMatch[1]) : 0;\n  const widthMatch = (_childEl$style$width = childEl.style.width) === null || _childEl$style$width === void 0 ? void 0 : _childEl$style$width.match(/(\\d+)px/);\n  const heightMatch = (_childEl$style$height = childEl.style.height) === null || _childEl$style$height === void 0 ? void 0 : _childEl$style$height.match(/(\\d+)px/);\n  const width = widthMatch ? parseInt(widthMatch[1]) : type === 'icon' ? 50 : type === 'gallery' ? 380 : 200;\n  const height = heightMatch ? parseInt(heightMatch[1]) : type === 'icon' ? 50 : type === 'gallery' ? 300 : 50;\n  const styles = parseInlineStyles(childEl.style);\n  const componentData = parseComponentData(childEl, type);\n\n  // Parse nested children recursively\n  const children = [];\n  const nestedChildren = childEl.querySelectorAll('[data-element-id]');\n  nestedChildren.forEach(nestedEl => {\n    if (nestedEl.parentElement === childEl || nestedEl.closest('[data-element-id]') === childEl) {\n      const nestedChild = parseChildElementRecursive(nestedEl);\n      if (nestedChild) {\n        children.push(nestedChild);\n      }\n    }\n  });\n  return {\n    id,\n    type,\n    componentData,\n    position: {\n      desktop: {\n        x: left,\n        y: top\n      },\n      tablet: {\n        x: left,\n        y: top\n      },\n      mobile: {\n        x: left,\n        y: top\n      }\n    },\n    size: {\n      width,\n      height\n    },\n    styles,\n    children,\n    visible: true,\n    locked: false\n  };\n};\nconst parseComponentData = (element, type) => {\n  const componentData = {};\n  switch (type) {\n    case 'button':\n      componentData.content = element.textContent.trim() || 'Button';\n      componentData.background = element.style.background;\n      componentData.color = element.style.color;\n      componentData.borderRadius = element.style.borderRadius;\n      componentData.border = element.style.border;\n      componentData.fontSize = element.style.fontSize;\n      componentData.fontWeight = element.style.fontWeight;\n      break;\n    case 'heading':\n      componentData.content = element.textContent.trim() || 'Heading';\n      componentData.level = element.tagName.toLowerCase();\n      componentData.fontSize = element.style.fontSize;\n      componentData.color = element.style.color;\n      componentData.fontWeight = element.style.fontWeight;\n      componentData.textAlign = element.style.textAlign;\n      break;\n    case 'paragraph':\n      componentData.content = element.textContent.trim() || 'Paragraph';\n      componentData.fontSize = element.style.fontSize;\n      componentData.color = element.style.color;\n      componentData.fontWeight = element.style.fontWeight;\n      componentData.lineHeight = element.style.lineHeight;\n      componentData.textAlign = element.style.textAlign;\n      break;\n    case 'image':\n      componentData.src = element.getAttribute('src');\n      componentData.alt = element.getAttribute('alt') || 'Image';\n      componentData.imageUrl = element.getAttribute('src');\n      break;\n    case 'icon':\n      const img = element.querySelector('img');\n      const iconEl = element.querySelector('i');\n      const svgEl = element.querySelector('svg');\n      if (img) {\n        componentData.imageUrl = img.getAttribute('src');\n      } else if (svgEl) {\n        componentData.icon = svgEl.outerHTML;\n      } else if (iconEl) {\n        componentData.icon = iconEl.className;\n      }\n      componentData.title = element.getAttribute('title') || '';\n      break;\n    case 'gallery':\n      const images = Array.from(element.querySelectorAll('img')).map(img => img.src);\n      componentData.images = images.filter(src => src && src !== 'https://via.placeholder.com/150');\n      break;\n    default:\n      componentData.content = element.textContent.trim() || '';\n      break;\n  }\n  return componentData;\n};\nconst parseInlineStyles = styleObj => {\n  const styles = {};\n  const importantProps = ['background', 'backgroundColor', 'backgroundImage', 'backgroundSize', 'backgroundPosition', 'color', 'fontSize', 'fontWeight', 'fontFamily', 'border', 'borderRadius', 'boxShadow', 'textShadow', 'padding', 'margin', 'display', 'alignItems', 'justifyContent', 'flexDirection', 'gap', 'textAlign', 'lineHeight', 'textTransform', 'cursor', 'transition', 'animation', 'zIndex', 'opacity'];\n  importantProps.forEach(prop => {\n    if (styleObj[prop]) {\n      styles[prop] = styleObj[prop];\n    }\n  });\n  return styles;\n};\nconst inferTypeFromElement = element => {\n  const tagName = element.tagName.toLowerCase();\n  const classList = element.classList;\n  if (classList.contains('lpb-button') || tagName === 'button') return 'button';\n  if (classList.contains('lpb-icon')) return 'icon';\n  if (classList.contains('lpb-gallery')) return 'gallery';\n  if (classList.contains('lpb-section')) return 'section';\n  if (classList.contains('lpb-popup')) return 'popup';\n  if (tagName.match(/^h[1-6]$/)) return 'heading';\n  if (tagName === 'p') return 'paragraph';\n  if (tagName === 'img') return 'image';\n  if (tagName === 'hr') return 'divider';\n  if (tagName === 'form') return 'form';\n  if (tagName === 'ul' || tagName === 'ol') return 'list';\n  return 'container';\n};\nconst findElementById = (elements, id) => {\n  for (const element of elements) {\n    if (element.id === id) return element;\n    if (element.children && element.children.length > 0) {\n      const found = findElementById(element.children, id);\n      if (found) return found;\n    }\n  }\n  return null;\n};","map":{"version":3,"names":["generateEventRuntime","events","popups","JSON","stringify","extractEvents","pageData","processedIds","Set","processElement","element","parentId","_element$componentDat","elementId","id","has","console","warn","add","componentData","hasValidEvent","Object","values","some","event","type","push","log","Array","isArray","children","forEach","child","elements","length","renderPopupsHTML","map","popup","styles","size","childrenHTML","renderElementHTML","join","width","height","background","borderRadius","title","padding","content","isChild","_position$desktop","_position$desktop2","_componentData$icon","position","inlineStyles","entries","filter","key","startsWith","value","kebabKey","replace","m","toLowerCase","baseAttrs","trim","positionStyles","desktop","x","y","renderSectionHTML","HeadingTag","level","src","imageUrl","alt","isSvg","icon","renderGalleryHTML","_position$desktop3","_position$desktop4","images","galleryChildrenHTML","display","gridTemplateColumns","gap","index","objectFit","objectPosition","section","_position$desktop5","backgroundColor","backgroundImage","overlayColor","overlayOpacity","generateCSS","css","processElementStyles","frame","props","prop","val","kebabProp","renderStaticHTML","_pageData$meta","_pageData$meta2","_pageData$canvas","_pageData$analytics","el","sections","sectionsHTML","popupsHTML","runtimeScript","cssContent","meta","description","canvas","analytics","googleAnalyticsId","parseHTMLToPageData","htmlString","parser","DOMParser","doc","parseFromString","canvasEl","getElementById","style","titleEl","querySelector","textContent","descEl","getAttribute","querySelectorAll","sectionEl","parseElementRecursive","popupEl","scripts","script","innerHTML","eventsMatch","match","jsonStr","parse","eventConfig","findElementById","e","error","elementEl","parentType","Date","now","parseInlineStyles","tablet","mobile","_elementEl$style$top","_elementEl$style$widt","_elementEl$style$heig","topMatch","top","parseInt","widthMatch","heightMatch","bgEl","overlayEl","containerEl","structure","_bgStyle$backgroundIm","bgStyle","bgImageMatch","backgroundType","backgroundPosition","parseFloat","opacity","_containerEl$style$wi","_containerEl$style$mi","minHeightMatch","minHeight","headerEl","bodyEl","containerSelector","childElements","childEl","parentElement","parseChildElementRecursive","visible","locked","_childEl$style$left","_childEl$style$top","_childEl$style$width","_childEl$style$height","inferTypeFromElement","leftMatch","left","parseComponentData","nestedChildren","nestedEl","closest","nestedChild","color","border","fontSize","fontWeight","tagName","textAlign","lineHeight","img","iconEl","svgEl","outerHTML","className","from","styleObj","importantProps","classList","contains","found"],"sources":["F:/landinghub-iconic/apps/web/src/utils/pageUtils.js"],"sourcesContent":["// ==================== EVENT RUNTIME GENERATOR ====================\r\n\r\n/**\r\n * Generate runtime script ƒë·ªÉ x·ª≠ l√Ω events trong HTML tƒ©nh\r\n * @param {Array} events - Danh s√°ch events t·ª´ pageData\r\n * @param {Array} popups - Danh s√°ch popup elements\r\n * @returns {string} - JavaScript code\r\n */\r\nconst generateEventRuntime = (events, popups) => {\r\n    return `\r\n    // Landing Page Builder Runtime v1.0\r\n    (function() {\r\n        'use strict';\r\n        \r\n        window.LPB = window.LPB || {};\r\n        \r\n        // ========== POPUP MANAGER ==========\r\n        LPB.popups = {\r\n            active: new Set(),\r\n            \r\n            open: function(popupId, data) {\r\n                const popup = document.getElementById(popupId);\r\n                if (!popup) {\r\n                    console.error('[LPB] Popup not found:', popupId);\r\n                    return;\r\n                }\r\n                \r\n                // Update content n·∫øu c√≥ data\r\n                if (data && data.html) {\r\n                    const content = popup.querySelector('.lpb-popup-body');\r\n                    if (content) content.innerHTML = data.html;\r\n                }\r\n                \r\n                // Show popup\r\n                popup.classList.add('lpb-popup-active');\r\n                document.body.style.overflow = 'hidden';\r\n                this.active.add(popupId);\r\n                \r\n                // Analytics tracking\r\n                if (window.gtag) {\r\n                    gtag('event', 'popup_open', {\r\n                        event_category: 'Engagement',\r\n                        event_label: popupId\r\n                    });\r\n                }\r\n            },\r\n            \r\n            close: function(popupId) {\r\n                const popup = document.getElementById(popupId);\r\n                if (popup) {\r\n                    popup.classList.remove('lpb-popup-active');\r\n                    this.active.delete(popupId);\r\n                    \r\n                    // Restore scroll n·∫øu kh√¥ng c√≤n popup n√†o\r\n                    if (this.active.size === 0) {\r\n                        document.body.style.overflow = '';\r\n                    }\r\n                }\r\n            },\r\n            \r\n            closeAll: function() {\r\n                this.active.forEach(id => this.close(id));\r\n            }\r\n        };\r\n        \r\n        // ========== API MANAGER ==========\r\n        LPB.api = {\r\n            cache: new Map(),\r\n            \r\n            getCacheKey: function(endpoint, params) {\r\n                return endpoint + JSON.stringify(params || {});\r\n            },\r\n            \r\n            fetch: async function(endpoint, options = {}) {\r\n                const cacheKey = this.getCacheKey(endpoint, options.params);\r\n                \r\n                // Check cache\r\n                if (this.cache.has(cacheKey)) {\r\n                    const cached = this.cache.get(cacheKey);\r\n                    const now = Date.now();\r\n                    const TTL = options.ttl || 5 * 60 * 1000; // 5 ph√∫t default\r\n                    \r\n                    if (now - cached.timestamp < TTL) {\r\n                        console.log('[LPB] Cache hit:', endpoint);\r\n                        return cached.data;\r\n                    }\r\n                }\r\n                \r\n                // Fetch m·ªõi\r\n                try {\r\n                    console.log('[LPB] Fetching:', endpoint);\r\n                    const response = await fetch(endpoint, {\r\n                        method: options.method || 'GET',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            ...options.headers\r\n                        },\r\n                        body: options.data ? JSON.stringify(options.data) : undefined\r\n                    });\r\n                    \r\n                    if (!response.ok) {\r\n                        throw new Error(\\`HTTP \\${response.status}: \\${response.statusText}\\`);\r\n                    }\r\n                    \r\n                    const data = await response.json();\r\n                    \r\n                    // Cache result\r\n                    this.cache.set(cacheKey, {\r\n                        data: data,\r\n                        timestamp: Date.now()\r\n                    });\r\n                    \r\n                    return data;\r\n                } catch (error) {\r\n                    console.error('[LPB] API Error:', error);\r\n                    throw error;\r\n                }\r\n            },\r\n            \r\n            clearCache: function(endpoint) {\r\n                if (endpoint) {\r\n                    for (let key of this.cache.keys()) {\r\n                        if (key.startsWith(endpoint)) {\r\n                            this.cache.delete(key);\r\n                        }\r\n                    }\r\n                } else {\r\n                    this.cache.clear();\r\n                }\r\n            }\r\n        };\r\n        \r\n        // ========== EVENT HANDLER ==========\r\n        LPB.handleEvent = async function(config) {\r\n            const { type } = config;\r\n            \r\n            try {\r\n                switch(type) {\r\n                    case 'openPopup':\r\n                        if (!config.popupId) {\r\n                            console.error('[LPB] Missing popupId');\r\n                            return;\r\n                        }\r\n                        this.popups.open(config.popupId, config.data);\r\n                        break;\r\n                        \r\n                    case 'closePopup':\r\n                        const targetPopupId = config.popupId || config.elementId;\r\n                        if (!targetPopupId) {\r\n                            console.error('[LPB] Missing popupId');\r\n                            return;\r\n                        }\r\n                        this.popups.close(targetPopupId);\r\n                        break;\r\n                        \r\n                    case 'triggerApi':\r\n                        if (!config.apiUrl) {\r\n                            console.error('[LPB] Missing apiUrl');\r\n                            return;\r\n                        }\r\n                        const data = await this.api.fetch(config.apiUrl, {\r\n                            method: config.method || 'GET',\r\n                            params: config.params,\r\n                            data: config.data\r\n                        });\r\n                        \r\n                        // Update target n·∫øu c√≥\r\n                        if (config.updateTarget) {\r\n                            const target = document.getElementById(config.updateTarget);\r\n                            if (target && data.html) {\r\n                                target.innerHTML = data.html;\r\n                            }\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'both':\r\n                        // Open popup immediately v·ªõi loading\r\n                        this.popups.open(config.popupId, { \r\n                            html: '<div style=\"text-align:center;padding:40px;\"><div class=\"lpb-spinner\"></div><p>ƒêang t·∫£i...</p></div>' \r\n                        });\r\n                        \r\n                        // Fetch API in background\r\n                        const apiData = await this.api.fetch(config.apiUrl, {\r\n                            method: config.method || 'GET',\r\n                            params: config.params\r\n                        });\r\n                        \r\n                        // Update popup content\r\n                        this.popups.open(config.popupId, { html: apiData.html || JSON.stringify(apiData) });\r\n                        break;\r\n                        \r\n                    case 'navigate':\r\n                        if (!config.url) {\r\n                            console.error('[LPB] Missing url');\r\n                            return;\r\n                        }\r\n                        if (config.newTab) {\r\n                            window.open(config.url, '_blank');\r\n                        } else {\r\n                            window.location.href = config.url;\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'scrollToSection':\r\n                        if (!config.sectionId) {\r\n                            console.error('[LPB] Missing sectionId');\r\n                            return;\r\n                        }\r\n                        const section = document.querySelector(\\`[data-element-id=\"\\${config.sectionId}\"]\\`);\r\n                        if (section) {\r\n                            section.scrollIntoView({ \r\n                                behavior: config.smooth !== false ? 'smooth' : 'auto',\r\n                                block: 'start'\r\n                            });\r\n                        } else {\r\n                            console.error('[LPB] Section not found:', config.sectionId);\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'submitForm':\r\n                        if (!config.apiUrl) {\r\n                            console.error('[LPB] Missing apiUrl');\r\n                            return;\r\n                        }\r\n                        console.log('[LPB] Form submit to:', config.apiUrl);\r\n                        break;\r\n                        \r\n                    default:\r\n                        console.warn('[LPB] Unknown event type:', type);\r\n                }\r\n            } catch (error) {\r\n                console.error('[LPB] Event handling error:', error);\r\n                alert('C√≥ l·ªói x·∫£y ra: ' + error.message);\r\n            }\r\n        };\r\n        \r\n        // ========== AUTO-BIND EVENTS ==========\r\n        const eventsConfig = ${JSON.stringify(events, null, 2)};\r\n        \r\n        document.addEventListener('DOMContentLoaded', function() {\r\n            console.log('[LPB] Initializing events...', eventsConfig.length);\r\n            \r\n            eventsConfig.forEach(config => {\r\n                const element = document.getElementById(config.elementId);\r\n                if (!element) {\r\n                    console.warn('[LPB] Element not found:', config.elementId);\r\n                    return;\r\n                }\r\n                \r\n                // Bind onClick\r\n                if (config.events.onClick && config.events.onClick.type !== 'none') {\r\n                    element.addEventListener('click', function(e) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        LPB.handleEvent(config.events.onClick);\r\n                    });\r\n                    \r\n                    element.style.cursor = 'pointer';\r\n                }\r\n                \r\n                // Bind hover prefetch\r\n                if (config.events.onClick?.params?.apiConfig?.preload) {\r\n                    element.addEventListener('mouseenter', function() {\r\n                        LPB.api.fetch(\r\n                            config.events.onClick.params.apiConfig.endpoint,\r\n                            config.events.onClick.params.apiConfig\r\n                        ).catch(() => {}); // Silent prefetch\r\n                    }, { once: true });\r\n                }\r\n                \r\n                // Bind onHover effects\r\n                if (config.events.onHover) {\r\n                    const hoverClass = config.events.onHover.className;\r\n                    if (hoverClass) {\r\n                        element.addEventListener('mouseenter', function() {\r\n                            this.classList.add(hoverClass);\r\n                        });\r\n                        element.addEventListener('mouseleave', function() {\r\n                            this.classList.remove(hoverClass);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n            \r\n            console.log('[LPB] Events initialized!');\r\n        });\r\n        \r\n        // ========== ESC TO CLOSE POPUP ==========\r\n        document.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Escape') {\r\n                LPB.popups.closeAll();\r\n            }\r\n        });\r\n        \r\n        console.log('[LPB] Runtime loaded');\r\n    })();\r\n    `;\r\n};\r\n\r\n/**\r\n * Extract t·∫•t c·∫£ events t·ª´ pageData elements (FIXED - Recursive & No Duplicates)\r\n * @param {Object} pageData - Page data object\r\n * @returns {Array} - Array of event configs\r\n */\r\nconst extractEvents = (pageData) => {\r\n    const events = [];\r\n    const processedIds = new Set(); // Track processed IDs to avoid duplicates\r\n\r\n    const processElement = (element, parentId = null) => {\r\n        const elementId = element.id;\r\n\r\n        // Skip n·∫øu ƒë√£ x·ª≠ l√Ω\r\n        if (processedIds.has(elementId)) {\r\n            console.warn(`[extractEvents] ‚ö†Ô∏è Duplicate ID detected (skipped): ${elementId}`);\r\n            return;\r\n        }\r\n        processedIds.add(elementId);\r\n\r\n        // Check element events\r\n        if (element.componentData?.events) {\r\n            const hasValidEvent = Object.values(element.componentData.events).some(\r\n                event => event && typeof event === 'object' && event.type && event.type !== 'none'\r\n            );\r\n            if (hasValidEvent) {\r\n                events.push({\r\n                    elementId: elementId,\r\n                    events: element.componentData.events,\r\n                    type: element.type,\r\n                    parentId: parentId\r\n                });\r\n                console.log(`[extractEvents] ‚úì Added event for: ${elementId}`);\r\n            }\r\n        }\r\n\r\n        // Recursive cho children\r\n        if (Array.isArray(element.children)) {\r\n            element.children.forEach(child => {\r\n                processElement(child, elementId);\r\n            });\r\n        }\r\n    };\r\n\r\n    pageData.elements.forEach(element => {\r\n        processElement(element, null);\r\n    });\r\n\r\n    console.log(`[extractEvents] ‚úÖ Total events extracted: ${events.length}`);\r\n    return events;\r\n};\r\n\r\n/**\r\n * Render t·∫•t c·∫£ popups th√†nh HTML\r\n * @param {Array} popups - Array of popup elements\r\n * @returns {string} - HTML string\r\n */\r\nconst renderPopupsHTML = (popups) => {\r\n    return popups.map(popup => {\r\n        const { id, componentData = {}, styles = {}, size = {}, children = [] } = popup;\r\n\r\n        // Render children content recursively\r\n        const childrenHTML = children.map(child =>\r\n            renderElementHTML(child, true)\r\n        ).join('');\r\n\r\n        return `\r\n            <div \r\n                id=\"${id}\" \r\n                class=\"lpb-popup\" \r\n                data-element-id=\"${id}\"\r\n                style=\"display:none;\"\r\n            >\r\n                <!-- Overlay -->\r\n                <div \r\n                    class=\"lpb-popup-overlay\" \r\n                    onclick=\"LPB.popups.close('${id}')\"\r\n                ></div>\r\n                \r\n                <!-- Popup Container -->\r\n                <div \r\n                    class=\"lpb-popup-container\"\r\n                    style=\"\r\n                        width: ${size.width || 600}px;\r\n                        max-width: 90vw;\r\n                        min-height: ${size.height || 400}px;\r\n                        background: ${styles.background || componentData.background || 'rgba(255, 255, 255, 0.95)'};\r\n                        border-radius: ${styles.borderRadius || componentData.borderRadius || '12px'};\r\n                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);\r\n                    \"\r\n                >\r\n                    <!-- Header -->\r\n                    <div class=\"lpb-popup-header\">\r\n                        <h3 style=\"margin:0; font-size:16px; font-weight:600; color:#111827;\">\r\n                            ${componentData.title || 'Popup Title'}\r\n                        </h3>\r\n                        <button \r\n                            class=\"lpb-popup-close\" \r\n                            onclick=\"LPB.popups.close('${id}')\"\r\n                            aria-label=\"Close popup\"\r\n                        >\r\n                            ‚úï\r\n                        </button>\r\n                    </div>\r\n                    \r\n                    <!-- Body -->\r\n                    <div class=\"lpb-popup-body\" style=\"padding: ${componentData.padding || '20px'};\">\r\n                        ${childrenHTML || `<p style=\"color:#6b7280;\">${componentData.content || 'Popup content'}</p>`}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('\\n');\r\n};\r\n\r\n/**\r\n * Render m·ªôt element th√†nh HTML v·ªõi proper ID (FIXED - Recursive Children)\r\n * @param {Object} element - Element object\r\n * @param {boolean} isChild - Whether this is a child element\r\n * @returns {string} - HTML string\r\n */\r\nconst renderElementHTML = (element, isChild = false) => {\r\n    const { id, type, componentData = {}, styles = {}, size = {}, position = {}, children = [] } = element;\r\n\r\n    // Convert styles object to inline CSS\r\n    const inlineStyles = Object.entries(styles)\r\n        .filter(([key]) => !key.startsWith(':') && !key.startsWith('@'))\r\n        .map(([key, value]) => {\r\n            const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\r\n            return `${kebabKey}:${value}`;\r\n        })\r\n        .join(';');\r\n\r\n    // Base attributes\r\n    const baseAttrs = `\r\n        id=\"${id}\"\r\n        data-element-id=\"${id}\"\r\n        data-type=\"${type}\"\r\n        class=\"lpb-element lpb-${type}\"\r\n    `.trim();\r\n\r\n    // Position styles cho child elements\r\n    const positionStyles = isChild ? `\r\n        position: absolute;\r\n        left: ${position.desktop?.x || 0}px;\r\n        top: ${position.desktop?.y || 0}px;\r\n        width: ${size.width || 200}px;\r\n        height: ${size.height || 50}px;\r\n    ` : '';\r\n\r\n    // Render children recursively\r\n    const childrenHTML = children.map(child => renderElementHTML(child, true)).join('');\r\n\r\n    // Render based on type\r\n    switch(type) {\r\n        case 'section':\r\n            return renderSectionHTML(element);\r\n\r\n        case 'button':\r\n            return `\r\n                <button \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Button'}\r\n                    ${childrenHTML}\r\n                </button>\r\n            `;\r\n\r\n        case 'heading':\r\n            const HeadingTag = componentData.level || 'h2';\r\n            return `\r\n                <${HeadingTag} \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Heading'}\r\n                    ${childrenHTML}\r\n                </${HeadingTag}>\r\n            `;\r\n\r\n        case 'paragraph':\r\n            return `\r\n                <p \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Paragraph'}\r\n                    ${childrenHTML}\r\n                </p>\r\n            `;\r\n\r\n        case 'image':\r\n            return `\r\n                <img \r\n                    ${baseAttrs}\r\n                    src=\"${componentData.src || componentData.imageUrl || 'https://via.placeholder.com/150'}\"\r\n                    alt=\"${componentData.alt || 'Image'}\"\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                />\r\n            `;\r\n\r\n        case 'icon':\r\n            const isSvg = componentData.icon?.startsWith('<svg');\r\n            return `\r\n                <div \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                    title=\"${componentData.title || ''}\"\r\n                >\r\n                    ${componentData.imageUrl\r\n                ? `<img src=\"${componentData.imageUrl}\" alt=\"${componentData.title || 'Icon'}\" style=\"width:100%;height:100%;object-fit:contain;\" />`\r\n                : isSvg\r\n                    ? componentData.icon\r\n                    : componentData.icon\r\n                        ? `<i class=\"${componentData.icon}\"></i>`\r\n                        : 'üì¶'\r\n            }\r\n                    ${childrenHTML}\r\n                </div>\r\n            `;\r\n\r\n        case 'gallery':\r\n            return renderGalleryHTML(element, isChild);\r\n\r\n        default:\r\n            return `\r\n                <div \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || type}\r\n                    ${childrenHTML}\r\n                </div>\r\n            `;\r\n    }\r\n};\r\n\r\n/**\r\n * Render gallery element\r\n */\r\nconst renderGalleryHTML = (element, isChild) => {\r\n    const { id, componentData = {}, styles = {}, size = {}, position = {}, children = [] } = element;\r\n\r\n    const positionStyles = isChild ? `\r\n        position: absolute;\r\n        left: ${position.desktop?.x || 0}px;\r\n        top: ${position.desktop?.y || 0}px;\r\n    ` : '';\r\n\r\n    const images = componentData.images || [];\r\n\r\n    // Render gallery children if any\r\n    const galleryChildrenHTML = children.map(child => renderElementHTML(child, true)).join('');\r\n\r\n    return `\r\n        <div \r\n            id=\"${id}\"\r\n            data-element-id=\"${id}\"\r\n            data-type=\"gallery\"\r\n            class=\"lpb-element lpb-gallery\"\r\n            style=\"${positionStyles} width: ${size.width || 380}px; height: ${size.height || 300}px;\"\r\n        >\r\n            <div style=\"\r\n                display: ${styles.display || 'grid'};\r\n                grid-template-columns: ${styles.gridTemplateColumns || 'repeat(auto-fill, minmax(150px, 1fr))'};\r\n                gap: ${styles.gap || '10px'};\r\n                width: 100%;\r\n                height: 100%;\r\n            \">\r\n                ${images.map((imageUrl, index) => `\r\n                    <div style=\"\r\n                        position: relative;\r\n                        overflow: hidden;\r\n                        border-radius: ${styles.borderRadius || '8px'};\r\n                        aspect-ratio: 1 / 1;\r\n                    \">\r\n                        <img\r\n                            src=\"${imageUrl || 'https://via.placeholder.com/150'}\"\r\n                            alt=\"Gallery ${index + 1}\"\r\n                            style=\"\r\n                                width: 100%;\r\n                                height: 100%;\r\n                                object-fit: ${styles.objectFit || 'cover'};\r\n                                object-position: ${styles.objectPosition || 'center'};\r\n                            \"\r\n                            loading=\"lazy\"\r\n                        />\r\n                    </div>\r\n                `).join('')}\r\n                ${images.length === 0 ? `\r\n                    <div style=\"\r\n                        display: flex;\r\n                        flex-direction: column;\r\n                        align-items: center;\r\n                        justify-content: center;\r\n                        color: #9ca3af;\r\n                        text-align: center;\r\n                        grid-column: 1 / -1;\r\n                    \">\r\n                        <i class=\"fas fa-image\" style=\"font-size: 48px; margin-bottom: 8px;\"></i>\r\n                        <p>Empty gallery</p>\r\n                    </div>\r\n                ` : ''}\r\n                ${galleryChildrenHTML}\r\n            </div>\r\n        </div>\r\n    `;\r\n};\r\n\r\n/**\r\n * Render section v·ªõi children\r\n */\r\nconst renderSectionHTML = (section) => {\r\n    const { id, componentData = {}, styles = {}, size = {}, position = {}, children = [] } = section;\r\n\r\n    // Render children recursively\r\n    const childrenHTML = children.map(child =>\r\n        renderElementHTML(child, true)\r\n    ).join('\\n');\r\n\r\n    return `\r\n        <section \r\n            id=\"${id}\"\r\n            data-element-id=\"${id}\"\r\n            class=\"lpb-section ladi-section\"\r\n            style=\"\r\n                position: absolute;\r\n                top: ${position.desktop?.y || 0}px;\r\n                left: 50%;\r\n                transform: translateX(-50%);\r\n                width: 1200px;\r\n                height: ${size.height || 400}px;\r\n            \"\r\n        >\r\n            <!-- Background -->\r\n            <div class=\"ladi-section-background\" style=\"\r\n                position: absolute;\r\n                inset: 0;\r\n                z-index: 0;\r\n                background-color: ${componentData.backgroundColor || styles.backgroundColor || 'transparent'};\r\n                background-image: ${componentData.backgroundImage ? `url(${componentData.backgroundImage})` : 'none'};\r\n                background-size: cover;\r\n                background-position: center;\r\n            \"></div>\r\n            \r\n            <!-- Overlay -->\r\n            <div class=\"ladi-overlay\" style=\"\r\n                position: absolute;\r\n                inset: 0;\r\n                z-index: 0;\r\n                background-color: ${componentData.overlayColor || 'transparent'};\r\n                opacity: ${componentData.overlayOpacity || 0};\r\n            \"></div>\r\n            \r\n            <!-- Container -->\r\n            <div class=\"ladi-container\" style=\"\r\n                position: relative;\r\n                z-index: 1;\r\n                padding: ${componentData.padding || styles.padding || '20px'};\r\n                width: 100%;\r\n                height: 100%;\r\n            \">\r\n                ${childrenHTML}\r\n            </div>\r\n        </section>\r\n    `;\r\n};\r\n\r\n/**\r\n * Generate CSS t·ª´ pageData\r\n */\r\nconst generateCSS = (pageData) => {\r\n    let css = `\r\n        * {\r\n            box-sizing: border-box;\r\n        }\r\n        \r\n        body {\r\n            margin: 0;\r\n            padding: 0;\r\n        }\r\n        \r\n        .lpb-element {\r\n            transition: all 0.3s ease;\r\n        }\r\n    `;\r\n\r\n    // Extract pseudo-classes v√† animations t·ª´ elements (recursive)\r\n    const processElementStyles = (element) => {\r\n        const { id, styles = {} } = element;\r\n\r\n        // Process hover states\r\n        if (styles[':hover']) {\r\n            css += `\\n#${id}:hover {`;\r\n            Object.entries(styles[':hover']).forEach(([key, value]) => {\r\n                const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\r\n                css += `${kebabKey}:${value};`;\r\n            });\r\n            css += `}`;\r\n        }\r\n\r\n        // Process keyframes\r\n        Object.entries(styles).forEach(([key, value]) => {\r\n            if (key.startsWith('@keyframes')) {\r\n                css += `\\n${key} {`;\r\n                Object.entries(value).forEach(([frame, props]) => {\r\n                    css += `${frame} {`;\r\n                    Object.entries(props).forEach(([prop, val]) => {\r\n                        const kebabProp = prop.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\r\n                        css += `${kebabProp}:${val};`;\r\n                    });\r\n                    css += `}`;\r\n                });\r\n                css += `}`;\r\n            }\r\n        });\r\n\r\n        // Recursive for children\r\n        if (element.children) {\r\n            element.children.forEach(child => processElementStyles(child));\r\n        }\r\n    };\r\n\r\n    pageData.elements.forEach(element => {\r\n        processElementStyles(element);\r\n    });\r\n\r\n    return css;\r\n};\r\n\r\n/**\r\n * Render to√†n b·ªô pageData th√†nh static HTML v·ªõi embedded runtime\r\n * @param {Object} pageData - Page data\r\n * @returns {string} - Complete HTML document\r\n */\r\nexport const renderStaticHTML = (pageData) => {\r\n    console.log('[renderStaticHTML] Starting render...');\r\n    console.log('[renderStaticHTML] Page data:', pageData);\r\n\r\n    // Extract components\r\n    const popups = pageData.elements.filter(el => el.type === 'popup');\r\n    const sections = pageData.elements.filter(el => el.type === 'section');\r\n    const events = extractEvents(pageData);\r\n\r\n    console.log('[renderStaticHTML] Extracted:', {\r\n        popups: popups.length,\r\n        sections: sections.length,\r\n        events: events.length\r\n    });\r\n\r\n    // Generate HTML parts\r\n    const sectionsHTML = sections.map(section => renderSectionHTML(section)).join('\\n');\r\n    const popupsHTML = renderPopupsHTML(popups);\r\n    const runtimeScript = generateEventRuntime(events, popups);\r\n\r\n    // Generate CSS\r\n    const cssContent = generateCSS(pageData);\r\n\r\n    // Combine everything\r\n    return `<!DOCTYPE html>\r\n<html lang=\"vi\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <meta name=\"description\" content=\"${pageData.meta?.description || 'Landing page generated by LandingHub'}\">\r\n    <title>${pageData.meta?.title || 'Landing Page'}</title>\r\n    \r\n    <!-- Font Awesome -->\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\r\n    \r\n    <!-- Styles -->\r\n    <style>\r\n        ${cssContent}\r\n        \r\n        /* Popup Styles */\r\n        .lpb-popup {\r\n            position: fixed;\r\n            inset: 0;\r\n            z-index: 9999;\r\n            display: none;\r\n            align-items: center;\r\n            justify-content: center;\r\n        }\r\n        \r\n        .lpb-popup.lpb-popup-active {\r\n            display: flex;\r\n        }\r\n        \r\n        .lpb-popup-overlay {\r\n            position: absolute;\r\n            inset: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            cursor: pointer;\r\n        }\r\n        \r\n        .lpb-popup-container {\r\n            position: relative;\r\n            z-index: 1;\r\n            background: white;\r\n            border-radius: 12px;\r\n            max-height: 90vh;\r\n            overflow-y: auto;\r\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n        }\r\n        \r\n        .lpb-popup-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: 16px 20px;\r\n            border-bottom: 1px solid #e5e7eb;\r\n            background: linear-gradient(to bottom, #f9fafb, #ffffff);\r\n        }\r\n        \r\n        .lpb-popup-close {\r\n            width: 28px;\r\n            height: 28px;\r\n            border: none;\r\n            background: transparent;\r\n            cursor: pointer;\r\n            border-radius: 6px;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            transition: all 0.15s ease;\r\n            color: #6b7280;\r\n            font-size: 18px;\r\n            font-weight: bold;\r\n        }\r\n        \r\n        .lpb-popup-close:hover {\r\n            background: #f3f4f6;\r\n            color: #111827;\r\n        }\r\n        \r\n        .lpb-popup-body {\r\n            padding: 20px;\r\n        }\r\n        \r\n        /* Loading Spinner */\r\n        .lpb-spinner {\r\n            border: 3px solid #f3f3f3;\r\n            border-top: 3px solid #3b82f6;\r\n            border-radius: 50%;\r\n            width: 40px;\r\n            height: 40px;\r\n            animation: spin 1s linear infinite;\r\n            margin: 0 auto;\r\n        }\r\n        \r\n        @keyframes spin {\r\n            0% { transform: rotate(0deg); }\r\n            100% { transform: rotate(360deg); }\r\n        }\r\n        \r\n        /* Responsive */\r\n        @media (max-width: 768px) {\r\n            .lpb-section {\r\n                width: 100% !important;\r\n            }\r\n            \r\n            .lpb-popup-container {\r\n                width: 90% !important;\r\n                max-width: 90vw !important;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\">\r\n    <!-- Canvas -->\r\n    <div id=\"lpb-canvas\" style=\"\r\n        position: relative;\r\n        min-height: 100vh;\r\n        background: ${pageData.canvas?.background || '#ffffff'};\r\n    \">\r\n        ${sectionsHTML}\r\n    </div>\r\n    \r\n    <!-- Popups -->\r\n    ${popupsHTML}\r\n    \r\n    <!-- Runtime Script -->\r\n    <script>\r\n        ${runtimeScript}\r\n    </script>\r\n    \r\n    <!-- Google Analytics (optional) -->\r\n    ${pageData.analytics?.googleAnalyticsId ? `\r\n    <script async src=\"https://www.googletagmanager.com/gtag/js?id=${pageData.analytics.googleAnalyticsId}\"></script>\r\n    <script>\r\n        window.dataLayer = window.dataLayer || [];\r\n        function gtag(){dataLayer.push(arguments);}\r\n        gtag('js', new Date());\r\n        gtag('config', '${pageData.analytics.googleAnalyticsId}');\r\n    </script>\r\n    ` : ''}\r\n</body>\r\n</html>`;\r\n};\r\n\r\n/**\r\n * Parse HTML string th√†nh pageData structure (FIXED - Recursive Parsing)\r\n */\r\nexport const parseHTMLToPageData = (htmlString) => {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(htmlString, 'text/html');\r\n\r\n    const pageData = {\r\n        canvas: {\r\n            width: 1200,\r\n            height: 'auto',\r\n            background: '#ffffff'\r\n        },\r\n        elements: [],\r\n        meta: {}\r\n    };\r\n\r\n    try {\r\n        // Parse canvas\r\n        const canvasEl = doc.getElementById('lpb-canvas');\r\n        if (canvasEl) {\r\n            pageData.canvas.background = canvasEl.style.background || '#ffffff';\r\n        }\r\n\r\n        // Parse meta\r\n        const titleEl = doc.querySelector('title');\r\n        if (titleEl) {\r\n            pageData.meta.title = titleEl.textContent;\r\n        }\r\n\r\n        const descEl = doc.querySelector('meta[name=\"description\"]');\r\n        if (descEl) {\r\n            pageData.meta.description = descEl.getAttribute('content');\r\n        }\r\n\r\n        // Parse sections\r\n        const sections = doc.querySelectorAll('.lpb-section');\r\n        sections.forEach(sectionEl => {\r\n            const section = parseElementRecursive(sectionEl, 'section');\r\n            if (section) {\r\n                pageData.elements.push(section);\r\n            }\r\n        });\r\n\r\n        // Parse popups\r\n        const popups = doc.querySelectorAll('.lpb-popup');\r\n        popups.forEach(popupEl => {\r\n            const popup = parseElementRecursive(popupEl, 'popup');\r\n            if (popup) {\r\n                pageData.elements.push(popup);\r\n            }\r\n        });\r\n\r\n        // Parse events t·ª´ script (improved regex)\r\n        const scripts = doc.querySelectorAll('script');\r\n        scripts.forEach(script => {\r\n            const content = script.textContent || script.innerHTML;\r\n            // Improved regex to capture JSON array more reliably\r\n            const eventsMatch = content.match(/eventsConfig\\s*=\\s*(\\[[\\s\\S]*?\\]);/);\r\n            if (eventsMatch) {\r\n                try {\r\n                    // Clean up the captured string (remove comments if any)\r\n                    const jsonStr = eventsMatch[1].replace(/\\/\\/.*$/gm, '').trim();\r\n                    const events = JSON.parse(jsonStr);\r\n                    events.forEach(eventConfig => {\r\n                        const element = findElementById(pageData.elements, eventConfig.elementId);\r\n                        if (element) {\r\n                            if (!element.componentData) {\r\n                                element.componentData = {};\r\n                            }\r\n                            element.componentData.events = eventConfig.events;\r\n                        }\r\n                    });\r\n                    console.log(`[parseHTMLToPageData] Parsed ${events.length} events`);\r\n                } catch (e) {\r\n                    console.warn('[parseHTMLToPageData] Cannot parse events config:', e, jsonStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        console.log('[parseHTMLToPageData] Parsed successfully:', pageData.elements.length, 'elements');\r\n        return pageData;\r\n\r\n    } catch (error) {\r\n        console.error('[parseHTMLToPageData] Parse error:', error);\r\n        return {\r\n            canvas: { width: 1200, height: 'auto', background: '#ffffff' },\r\n            elements: [],\r\n            meta: {}\r\n        };\r\n    }\r\n};\r\n\r\n// ==================== HELPER FUNCTIONS ====================\r\n\r\n/**\r\n * Parse element recursively (FIXED - Handles nested children)\r\n * @param {HTMLElement} elementEl - DOM element\r\n * @param {string} parentType - Type of parent (section/popup)\r\n * @returns {Object} Parsed element object\r\n */\r\nconst parseElementRecursive = (elementEl, parentType) => {\r\n    const id = elementEl.id || element.getAttribute('data-element-id') || `${parentType}-${Date.now()}`;\r\n    const type = parentType;\r\n\r\n    const styles = parseInlineStyles(elementEl.style);\r\n\r\n    let componentData = {};\r\n    let position = {\r\n        desktop: { x: 0, y: 0 },\r\n        tablet: { x: 0, y: 0 },\r\n        mobile: { x: 0, y: 0 }\r\n    };\r\n    let size = { width: 1200, height: 400 };\r\n\r\n    if (parentType === 'section') {\r\n        const topMatch = elementEl.style.top?.match(/(\\d+)px/);\r\n        position.desktop.y = topMatch ? parseInt(topMatch[1]) : 0;\r\n        position.tablet.y = position.desktop.y;\r\n        position.mobile.y = position.desktop.y;\r\n\r\n        const widthMatch = elementEl.style.width?.match(/(\\d+)px/);\r\n        const heightMatch = elementEl.style.height?.match(/(\\d+)px/);\r\n        size.width = widthMatch ? parseInt(widthMatch[1]) : 1200;\r\n        size.height = heightMatch ? parseInt(heightMatch[1]) : 400;\r\n\r\n        const bgEl = elementEl.querySelector('.ladi-section-background');\r\n        const overlayEl = elementEl.querySelector('.ladi-overlay');\r\n        const containerEl = elementEl.querySelector('.ladi-container');\r\n\r\n        componentData = { structure: 'ladi-standard' };\r\n\r\n        if (bgEl) {\r\n            const bgStyle = bgEl.style;\r\n            componentData.backgroundColor = bgStyle.backgroundColor || 'transparent';\r\n            const bgImageMatch = bgStyle.backgroundImage?.match(/url\\(['\"]?(.+?)['\"]?\\)/);\r\n            if (bgImageMatch) {\r\n                componentData.backgroundImage = bgImageMatch[1];\r\n                componentData.backgroundType = 'image';\r\n            } else if (componentData.backgroundColor !== 'transparent') {\r\n                componentData.backgroundType = 'color';\r\n            }\r\n            componentData.backgroundPosition = bgStyle.backgroundPosition || 'center';\r\n        }\r\n\r\n        if (overlayEl) {\r\n            componentData.overlayColor = overlayEl.style.backgroundColor || 'transparent';\r\n            componentData.overlayOpacity = parseFloat(overlayEl.style.opacity) || 0;\r\n        }\r\n\r\n        if (containerEl) {\r\n            componentData.padding = containerEl.style.padding || '20px';\r\n        }\r\n    } else if (parentType === 'popup') {\r\n        const containerEl = elementEl.querySelector('.lpb-popup-container');\r\n        if (!containerEl) return null;\r\n\r\n        const widthMatch = containerEl.style.width?.match(/(\\d+)px/);\r\n        const minHeightMatch = containerEl.style.minHeight?.match(/(\\d+)px/);\r\n        size.width = widthMatch ? parseInt(widthMatch[1]) : 600;\r\n        size.height = minHeightMatch ? parseInt(minHeightMatch[1]) : 400;\r\n\r\n        const headerEl = elementEl.querySelector('.lpb-popup-header h3');\r\n        const bodyEl = elementEl.querySelector('.lpb-popup-body');\r\n\r\n        componentData = {\r\n            title: headerEl?.textContent || 'Popup',\r\n            background: containerEl.style.background || 'rgba(255, 255, 255, 0.95)',\r\n            borderRadius: containerEl.style.borderRadius || '12px',\r\n            padding: bodyEl?.style.padding || '20px'\r\n        };\r\n    }\r\n\r\n    // Parse children recursively\r\n    const children = [];\r\n    const containerSelector = parentType === 'section' ? '.ladi-container' : '.lpb-popup-body';\r\n    const containerEl = elementEl.querySelector(containerSelector);\r\n    if (containerEl) {\r\n        const childElements = containerEl.querySelectorAll('[data-element-id]');\r\n        childElements.forEach(childEl => {\r\n            // Only direct children or properly nested\r\n            if (childEl.parentElement === containerEl) {\r\n                const child = parseChildElementRecursive(childEl);\r\n                if (child) {\r\n                    children.push(child);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    return {\r\n        id,\r\n        type,\r\n        componentData,\r\n        position,\r\n        size,\r\n        styles,\r\n        children,\r\n        visible: true,\r\n        locked: false\r\n    };\r\n};\r\n\r\n/**\r\n * Parse child element recursively (FIXED - Nested Children)\r\n * @param {HTMLElement} childEl - DOM child element\r\n * @returns {Object} Parsed child object\r\n */\r\nconst parseChildElementRecursive = (childEl) => {\r\n    const id = childEl.id || childEl.getAttribute('data-element-id') || `child-${Date.now()}`;\r\n    const type = childEl.getAttribute('data-type') || inferTypeFromElement(childEl);\r\n\r\n    const leftMatch = childEl.style.left?.match(/(\\d+)px/);\r\n    const topMatch = childEl.style.top?.match(/(\\d+)px/);\r\n    const left = leftMatch ? parseInt(leftMatch[1]) : 0;\r\n    const top = topMatch ? parseInt(topMatch[1]) : 0;\r\n\r\n    const widthMatch = childEl.style.width?.match(/(\\d+)px/);\r\n    const heightMatch = childEl.style.height?.match(/(\\d+)px/);\r\n    const width = widthMatch ? parseInt(widthMatch[1]) : (type === 'icon' ? 50 : type === 'gallery' ? 380 : 200);\r\n    const height = heightMatch ? parseInt(heightMatch[1]) : (type === 'icon' ? 50 : type === 'gallery' ? 300 : 50);\r\n\r\n    const styles = parseInlineStyles(childEl.style);\r\n    const componentData = parseComponentData(childEl, type);\r\n\r\n    // Parse nested children recursively\r\n    const children = [];\r\n    const nestedChildren = childEl.querySelectorAll('[data-element-id]');\r\n    nestedChildren.forEach(nestedEl => {\r\n        if (nestedEl.parentElement === childEl || nestedEl.closest('[data-element-id]') === childEl) {\r\n            const nestedChild = parseChildElementRecursive(nestedEl);\r\n            if (nestedChild) {\r\n                children.push(nestedChild);\r\n            }\r\n        }\r\n    });\r\n\r\n    return {\r\n        id,\r\n        type,\r\n        componentData,\r\n        position: {\r\n            desktop: { x: left, y: top },\r\n            tablet: { x: left, y: top },\r\n            mobile: { x: left, y: top }\r\n        },\r\n        size: { width, height },\r\n        styles,\r\n        children,\r\n        visible: true,\r\n        locked: false\r\n    };\r\n};\r\n\r\nconst parseComponentData = (element, type) => {\r\n    const componentData = {};\r\n\r\n    switch (type) {\r\n        case 'button':\r\n            componentData.content = element.textContent.trim() || 'Button';\r\n            componentData.background = element.style.background;\r\n            componentData.color = element.style.color;\r\n            componentData.borderRadius = element.style.borderRadius;\r\n            componentData.border = element.style.border;\r\n            componentData.fontSize = element.style.fontSize;\r\n            componentData.fontWeight = element.style.fontWeight;\r\n            break;\r\n\r\n        case 'heading':\r\n            componentData.content = element.textContent.trim() || 'Heading';\r\n            componentData.level = element.tagName.toLowerCase();\r\n            componentData.fontSize = element.style.fontSize;\r\n            componentData.color = element.style.color;\r\n            componentData.fontWeight = element.style.fontWeight;\r\n            componentData.textAlign = element.style.textAlign;\r\n            break;\r\n\r\n        case 'paragraph':\r\n            componentData.content = element.textContent.trim() || 'Paragraph';\r\n            componentData.fontSize = element.style.fontSize;\r\n            componentData.color = element.style.color;\r\n            componentData.fontWeight = element.style.fontWeight;\r\n            componentData.lineHeight = element.style.lineHeight;\r\n            componentData.textAlign = element.style.textAlign;\r\n            break;\r\n\r\n        case 'image':\r\n            componentData.src = element.getAttribute('src');\r\n            componentData.alt = element.getAttribute('alt') || 'Image';\r\n            componentData.imageUrl = element.getAttribute('src');\r\n            break;\r\n\r\n        case 'icon':\r\n            const img = element.querySelector('img');\r\n            const iconEl = element.querySelector('i');\r\n            const svgEl = element.querySelector('svg');\r\n\r\n            if (img) {\r\n                componentData.imageUrl = img.getAttribute('src');\r\n            } else if (svgEl) {\r\n                componentData.icon = svgEl.outerHTML;\r\n            } else if (iconEl) {\r\n                componentData.icon = iconEl.className;\r\n            }\r\n            componentData.title = element.getAttribute('title') || '';\r\n            break;\r\n\r\n        case 'gallery':\r\n            const images = Array.from(element.querySelectorAll('img')).map(img => img.src);\r\n            componentData.images = images.filter(src => src && src !== 'https://via.placeholder.com/150');\r\n            break;\r\n\r\n        default:\r\n            componentData.content = element.textContent.trim() || '';\r\n            break;\r\n    }\r\n\r\n    return componentData;\r\n};\r\n\r\nconst parseInlineStyles = (styleObj) => {\r\n    const styles = {};\r\n    const importantProps = [\r\n        'background', 'backgroundColor', 'backgroundImage', 'backgroundSize', 'backgroundPosition',\r\n        'color', 'fontSize', 'fontWeight', 'fontFamily',\r\n        'border', 'borderRadius', 'boxShadow', 'textShadow',\r\n        'padding', 'margin',\r\n        'display', 'alignItems', 'justifyContent', 'flexDirection', 'gap',\r\n        'textAlign', 'lineHeight', 'textTransform',\r\n        'cursor', 'transition', 'animation',\r\n        'zIndex', 'opacity'\r\n    ];\r\n\r\n    importantProps.forEach(prop => {\r\n        if (styleObj[prop]) {\r\n            styles[prop] = styleObj[prop];\r\n        }\r\n    });\r\n\r\n    return styles;\r\n};\r\n\r\nconst inferTypeFromElement = (element) => {\r\n    const tagName = element.tagName.toLowerCase();\r\n    const classList = element.classList;\r\n\r\n    if (classList.contains('lpb-button') || tagName === 'button') return 'button';\r\n    if (classList.contains('lpb-icon')) return 'icon';\r\n    if (classList.contains('lpb-gallery')) return 'gallery';\r\n    if (classList.contains('lpb-section')) return 'section';\r\n    if (classList.contains('lpb-popup')) return 'popup';\r\n\r\n    if (tagName.match(/^h[1-6]$/)) return 'heading';\r\n    if (tagName === 'p') return 'paragraph';\r\n    if (tagName === 'img') return 'image';\r\n    if (tagName === 'hr') return 'divider';\r\n    if (tagName === 'form') return 'form';\r\n    if (tagName === 'ul' || tagName === 'ol') return 'list';\r\n\r\n    return 'container';\r\n};\r\n\r\nconst findElementById = (elements, id) => {\r\n    for (const element of elements) {\r\n        if (element.id === id) return element;\r\n\r\n        if (element.children && element.children.length > 0) {\r\n            const found = findElementById(element.children, id);\r\n            if (found) return found;\r\n        }\r\n    }\r\n    return null;\r\n};"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,oBAAoB,GAAGA,CAACC,MAAM,EAAEC,MAAM,KAAK;EAC7C,OAAO;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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AACA,wCAAwC,EAAAmG,cAAA,GAAAnG,QAAQ,CAAC6G,IAAI,cAAAV,cAAA,uBAAbA,cAAA,CAAeW,WAAW,KAAI,sCAAsC;AAC5G,aAAa,EAAAV,eAAA,GAAApG,QAAQ,CAAC6G,IAAI,cAAAT,eAAA,uBAAbA,eAAA,CAAe3D,KAAK,KAAI,cAAc;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,UAAUmE,UAAU;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,EAAAP,gBAAA,GAAArG,QAAQ,CAAC+G,MAAM,cAAAV,gBAAA,uBAAfA,gBAAA,CAAiB9D,UAAU,KAAI,SAAS;AAC9D;AACA,UAAUkE,YAAY;AACtB;AACA;AACA;AACA,MAAMC,UAAU;AAChB;AACA;AACA;AACA,UAAUC,aAAa;AACvB;AACA;AACA;AACA,MAAM,CAAAL,mBAAA,GAAAtG,QAAQ,CAACgH,SAAS,cAAAV,mBAAA,eAAlBA,mBAAA,CAAoBW,iBAAiB,GAAG;AAC9C,qEAAqEjH,QAAQ,CAACgH,SAAS,CAACC,iBAAiB;AACzG;AACA;AACA;AACA;AACA,0BAA0BjH,QAAQ,CAACgH,SAAS,CAACC,iBAAiB;AAC9D;AACA,KAAK,GAAG,EAAE;AACV;AACA,QAAQ;AACR,CAAC;;AAED;AACA;AACA;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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}