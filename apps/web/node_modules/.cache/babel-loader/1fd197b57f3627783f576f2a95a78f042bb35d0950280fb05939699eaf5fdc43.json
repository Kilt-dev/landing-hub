{"ast":null,"code":"var _jsxFileName = \"F:\\\\landinghub-iconic\\\\apps\\\\web\\\\src\\\\components\\\\create-page\\\\Canvas.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useRef, useCallback, useState, useEffect } from 'react';\nimport { useDrop, useDrag } from 'react-dnd';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { toast } from 'react-toastify';\nimport Guidelines from './Guidelines';\nimport Rulers from './Rulers';\nimport SelectionOverlay from './SelectionOverlay';\nimport { throttle } from 'lodash'; // npm install lodash\nimport '../../styles/Canvas.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ItemTypes = {\n  ELEMENT: 'element',\n  EXISTING_ELEMENT: 'existingElement'\n};\n\n// Hàm tính tọa độ trên Canvas\nconst getCanvasPosition = (mouseX, mouseY, canvasRef, zoomLevel, scrollX = 0, scrollY = 0) => {\n  if (!canvasRef.current) {\n    console.error('Canvas ref is null in getCanvasPosition');\n    return {\n      x: 0,\n      y: 0\n    };\n  }\n  const canvasRect = canvasRef.current.getBoundingClientRect();\n  const x = (mouseX - canvasRect.left + scrollX) / (zoomLevel / 100);\n  const y = (mouseY - canvasRect.top + scrollY) / (zoomLevel / 100);\n  return {\n    x: Math.max(0, x),\n    y: Math.max(0, y)\n  };\n};\n\n// Hàm snapping\nconst snapToGrid = (x, y, gridSize, snapPoints = [], canvasBounds) => {\n  let snappedX = Math.round(x / gridSize) * gridSize;\n  let snappedY = Math.round(y / gridSize) * gridSize;\n  snapPoints.forEach(point => {\n    if (Math.abs(x - point.x) < 15) snappedX = point.x;\n    if (Math.abs(y - point.y) < 15) snappedY = point.y;\n  });\n  snappedX = Math.max(0, Math.min(snappedX, canvasBounds.width));\n  snappedY = Math.max(0, Math.min(snappedY, canvasBounds.height));\n  return {\n    x: snappedX,\n    y: snappedY\n  };\n};\n\n// Hàm tính bounds của phần tử\nconst getElementBounds = element => {\n  var _element$position$des, _element$position$des2, _element$position$des3, _element$size, _element$position$des4, _element$size2, _element$position$des5, _element$size3, _element$position$des6, _element$size4;\n  return {\n    left: ((_element$position$des = element.position.desktop) === null || _element$position$des === void 0 ? void 0 : _element$position$des.x) || 0,\n    top: ((_element$position$des2 = element.position.desktop) === null || _element$position$des2 === void 0 ? void 0 : _element$position$des2.y) || 0,\n    right: (((_element$position$des3 = element.position.desktop) === null || _element$position$des3 === void 0 ? void 0 : _element$position$des3.x) || 0) + (((_element$size = element.size) === null || _element$size === void 0 ? void 0 : _element$size.width) || 200),\n    bottom: (((_element$position$des4 = element.position.desktop) === null || _element$position$des4 === void 0 ? void 0 : _element$position$des4.y) || 0) + (((_element$size2 = element.size) === null || _element$size2 === void 0 ? void 0 : _element$size2.height) || 50),\n    centerX: (((_element$position$des5 = element.position.desktop) === null || _element$position$des5 === void 0 ? void 0 : _element$position$des5.x) || 0) + (((_element$size3 = element.size) === null || _element$size3 === void 0 ? void 0 : _element$size3.width) || 200) / 2,\n    centerY: (((_element$position$des6 = element.position.desktop) === null || _element$position$des6 === void 0 ? void 0 : _element$position$des6.y) || 0) + (((_element$size4 = element.size) === null || _element$size4 === void 0 ? void 0 : _element$size4.height) || 50) / 2\n  };\n};\nconst Element = /*#__PURE__*/_s(/*#__PURE__*/React.memo(_c = _s(({\n  element,\n  isSelected,\n  onSelectElement,\n  onUpdatePosition,\n  viewMode,\n  zoomLevel,\n  gridSize,\n  onContextMenu,\n  canvasRef,\n  snapPoints,\n  canvasBounds\n}) => {\n  var _position$viewMode3, _position$viewMode4;\n  _s();\n  const {\n    id,\n    type,\n    componentData = {},\n    position = {},\n    size = {\n      width: 200,\n      height: 50\n    },\n    styles = {}\n  } = element;\n  const elementRef = useRef(null);\n  const tempPositionRef = useRef(position[viewMode] || {\n    x: 0,\n    y: 0\n  });\n  const offsetRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const [{\n    isDragging\n  }, drag] = useDrag(() => ({\n    type: ItemTypes.EXISTING_ELEMENT,\n    item: () => {\n      var _elementRef$current, _canvasRef$current, _position$viewMode, _position$viewMode2;\n      const elementRect = (_elementRef$current = elementRef.current) === null || _elementRef$current === void 0 ? void 0 : _elementRef$current.getBoundingClientRect();\n      const canvasRect = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getBoundingClientRect();\n      if (!elementRect || !canvasRect) {\n        console.error('Cannot calculate offset for element:', id);\n        return {\n          id,\n          offset: {\n            x: 0,\n            y: 0\n          }\n        };\n      }\n      const offset = {\n        x: (elementRect.left - canvasRect.left) / (zoomLevel / 100) - (((_position$viewMode = position[viewMode]) === null || _position$viewMode === void 0 ? void 0 : _position$viewMode.x) || 0),\n        y: (elementRect.top - canvasRect.top) / (zoomLevel / 100) - (((_position$viewMode2 = position[viewMode]) === null || _position$viewMode2 === void 0 ? void 0 : _position$viewMode2.y) || 0)\n      };\n      offsetRef.current = offset;\n      return {\n        id,\n        offset\n      };\n    },\n    end: (item, monitor) => {\n      const clientOffset = monitor.getClientOffset();\n      if (!clientOffset || !canvasRef.current) return;\n      const pos = getCanvasPosition(clientOffset.x, clientOffset.y, canvasRef, zoomLevel, canvasRef.current.scrollLeft, canvasRef.current.scrollTop);\n      const prevPosition = position[viewMode]; // Lưu vị trí cũ cho undo\n      const snapped = snapToGrid(pos.x - item.offset.x, pos.y - item.offset.y, gridSize, snapPoints, canvasBounds);\n      onUpdatePosition(id, {\n        [viewMode]: snapped\n      }, true, prevPosition); // Truyền prevPosition cho undo\n      tempPositionRef.current = snapped;\n    },\n    collect: monitor => ({\n      isDragging: !!monitor.isDragging()\n    })\n  }));\n  const handleMouseMove = useCallback(e => {\n    // Sử dụng requestAnimationFrame thay vì throttle cho mượt mà hơn\n    if (!isDragging || !canvasRef.current) return;\n    const pos = getCanvasPosition(e.clientX, e.clientY, canvasRef, zoomLevel, canvasRef.current.scrollLeft, canvasRef.current.scrollTop);\n    const rawX = pos.x - offsetRef.current.x;\n    const rawY = pos.y - offsetRef.current.y;\n    const snapped = e.altKey ? {\n      x: rawX,\n      y: rawY\n    } // Tắt snapping nếu giữ Alt\n    : snapToGrid(rawX, rawY, gridSize, snapPoints, canvasBounds);\n\n    // Giới hạn trong bounds canvas\n    snapped.x = Math.max(0, Math.min(snapped.x, canvasBounds.width - size.width));\n    snapped.y = Math.max(0, Math.min(snapped.y, canvasBounds.height - size.height));\n    tempPositionRef.current = snapped;\n    if (elementRef.current) {\n      elementRef.current.style.left = `${snapped.x}px`;\n      elementRef.current.style.top = `${snapped.y}px`;\n    }\n  }, [isDragging, canvasRef, zoomLevel, gridSize, snapPoints, canvasBounds, size]);\n  useEffect(() => {\n    let animationFrameId;\n    if (isDragging) {\n      const onMove = e => {\n        animationFrameId = requestAnimationFrame(() => handleMouseMove(e));\n      };\n      document.addEventListener('mousemove', onMove);\n      return () => {\n        document.removeEventListener('mousemove', onMove);\n        cancelAnimationFrame(animationFrameId);\n      };\n    }\n  }, [isDragging, handleMouseMove]);\n  const handleMouseDown = e => {\n    e.stopPropagation();\n    onSelectElement(id, e.ctrlKey);\n  };\n  const handleContextMenu = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    onContextMenu(id, {\n      x: e.clientX,\n      y: e.clientY\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: node => {\n      elementRef.current = node;\n      drag(node);\n    },\n    className: `lpb-canvas-element ${isSelected ? 'lpb-canvas-element-selected' : ''} ${isDragging ? 'lpb-canvas-element-dragging' : ''}`,\n    style: {\n      position: 'absolute',\n      left: ((_position$viewMode3 = position[viewMode]) === null || _position$viewMode3 === void 0 ? void 0 : _position$viewMode3.x) || 0,\n      top: ((_position$viewMode4 = position[viewMode]) === null || _position$viewMode4 === void 0 ? void 0 : _position$viewMode4.y) || 0,\n      width: size.width,\n      height: size.height,\n      zIndex: position.z || 1,\n      cursor: isDragging ? 'grabbing' : 'grab',\n      opacity: isDragging ? 0.8 : 1,\n      ...styles\n    },\n    onMouseDown: handleMouseDown,\n    onContextMenu: handleContextMenu,\n    children: (() => {\n      switch (type) {\n        case 'heading':\n          return /*#__PURE__*/_jsxDEV(\"h2\", {\n            style: {\n              fontSize: componentData.fontSize || '1.5rem',\n              color: componentData.color || '#1f2937',\n              margin: 0,\n              userSelect: 'none'\n            },\n            children: componentData.content || 'Tiêu đề'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 33\n          }, this);\n        case 'paragraph':\n          return /*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              fontSize: componentData.fontSize || '1rem',\n              color: componentData.color || '#1f2937',\n              margin: 0,\n              userSelect: 'none'\n            },\n            children: componentData.content || 'Đoạn văn'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 33\n          }, this);\n        case 'button':\n          return /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              padding: '8px 16px',\n              borderRadius: '8px',\n              background: componentData.background || '#2563eb',\n              color: componentData.color || '#fff',\n              border: 'none',\n              cursor: 'pointer',\n              userSelect: 'none'\n            },\n            children: componentData.content || 'Nút'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 33\n          }, this);\n        case 'image':\n          return /*#__PURE__*/_jsxDEV(\"img\", {\n            src: componentData.src || 'https://via.placeholder.com/150',\n            alt: \"Image\",\n            style: {\n              maxWidth: '100%',\n              height: 'auto',\n              userSelect: 'none',\n              pointerEvents: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 33\n          }, this);\n        case 'form':\n          return /*#__PURE__*/_jsxDEV(\"form\", {\n            style: {\n              display: 'flex',\n              flexDirection: 'column',\n              gap: '10px',\n              userSelect: 'none'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Input\",\n              style: {\n                padding: '8px',\n                borderRadius: '8px',\n                border: '1px solid #ccc'\n              },\n              readOnly: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              style: {\n                background: '#2563eb',\n                color: '#fff',\n                padding: '8px 16px',\n                borderRadius: '8px',\n                border: 'none'\n              },\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 33\n          }, this);\n        default:\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              userSelect: 'none'\n            },\n            children: componentData.content || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 36\n          }, this);\n      }\n    })()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 13\n  }, this);\n}, \"OZO2o8gtw9PPb6FIcJUgehx0kmc=\", false, function () {\n  return [useDrag];\n})), \"OZO2o8gtw9PPb6FIcJUgehx0kmc=\", false, function () {\n  return [useDrag];\n});\n_c2 = Element;\nconst Canvas = /*#__PURE__*/_s2(/*#__PURE__*/React.memo(_c3 = _s2(({\n  pageData,\n  selectedIds,\n  onSelectElement,\n  onUpdatePosition,\n  onUpdateSize,\n  onDeleteElement,\n  onAddElement,\n  onGroupElements,\n  viewMode,\n  zoomLevel,\n  gridSize,\n  showGrid\n}) => {\n  var _pageData$canvas, _pageData$canvas2, _pageData$canvas3, _pageData$elements2, _dragItem$offset, _dragItem$offset2, _dragItem$json$size, _dragItem$json$size2, _pageData$elements3;\n  _s2();\n  const canvasRef = useRef(null);\n  const [guidelines, setGuidelines] = useState([]);\n  const [contextMenu, setContextMenu] = useState(null);\n  const [history, setHistory] = useState([]); // Stack cho undo/redo (demo đơn giản)\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const canvasBounds = {\n    width: (pageData === null || pageData === void 0 ? void 0 : (_pageData$canvas = pageData.canvas) === null || _pageData$canvas === void 0 ? void 0 : _pageData$canvas.width) || 1200,\n    height: (pageData === null || pageData === void 0 ? void 0 : (_pageData$canvas2 = pageData.canvas) === null || _pageData$canvas2 === void 0 ? void 0 : _pageData$canvas2.height) || 1000\n  };\n  const snapPoints = React.useMemo(() => {\n    var _pageData$elements;\n    const points = (pageData === null || pageData === void 0 ? void 0 : (_pageData$elements = pageData.elements) === null || _pageData$elements === void 0 ? void 0 : _pageData$elements.flatMap(el => {\n      const bounds = getElementBounds(el);\n      return [{\n        x: bounds.left,\n        y: bounds.top\n      }, {\n        x: bounds.right,\n        y: bounds.bottom\n      }, {\n        x: bounds.centerX,\n        y: bounds.centerY\n      }, {\n        x: bounds.left,\n        y: bounds.centerY\n      }, {\n        x: bounds.right,\n        y: bounds.centerY\n      }, {\n        x: bounds.centerX,\n        y: bounds.top\n      }, {\n        x: bounds.centerX,\n        y: bounds.bottom\n      }];\n    })) || [];\n    points.push({\n      x: 0,\n      y: 0\n    }, {\n      x: canvasBounds.width,\n      y: 0\n    }, {\n      x: 0,\n      y: canvasBounds.height\n    }, {\n      x: canvasBounds.width,\n      y: canvasBounds.height\n    }, {\n      x: canvasBounds.width / 2,\n      y: canvasBounds.height / 2\n    });\n    return points;\n  }, [pageData === null || pageData === void 0 ? void 0 : pageData.elements, canvasBounds]);\n  const handleUpdatePosition = (id, newPos, commit, prevPos) => {\n    if (commit && prevPos) {\n      // Lưu vào history cho undo\n      setHistory(prev => [...prev.slice(0, historyIndex + 1), {\n        id,\n        prevPos,\n        newPos\n      }]);\n      setHistoryIndex(prev => prev + 1);\n    }\n    onUpdatePosition(id, newPos, commit);\n  };\n  const handleUndo = () => {\n    if (historyIndex >= 0) {\n      const {\n        id,\n        prevPos\n      } = history[historyIndex];\n      onUpdatePosition(id, {\n        [viewMode]: prevPos\n      }, true);\n      setHistoryIndex(prev => prev - 1);\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      const {\n        id,\n        newPos\n      } = history[historyIndex + 1];\n      onUpdatePosition(id, {\n        [viewMode]: newPos\n      }, true);\n      setHistoryIndex(prev => prev + 1);\n    }\n  };\n  useHotkeys('ctrl+z', handleUndo, [history, historyIndex]);\n  useHotkeys('ctrl+y', handleRedo, [history, historyIndex]);\n  const [{\n    isOver,\n    dragItem\n  }, drop] = useDrop(() => ({\n    accept: [ItemTypes.ELEMENT, ItemTypes.EXISTING_ELEMENT],\n    hover: (item, monitor) => {\n      const clientOffset = monitor.getClientOffset();\n      if (!clientOffset || !canvasRef.current) return;\n      const pos = getCanvasPosition(clientOffset.x, clientOffset.y, canvasRef, zoomLevel, canvasRef.current.scrollLeft, canvasRef.current.scrollTop);\n      const snapped = snapToGrid(pos.x, pos.y, showGrid ? gridSize : Infinity, snapPoints, canvasBounds);\n      const newGuidelines = [];\n      snapPoints.forEach(point => {\n        if (Math.abs(snapped.x - point.x) < 15) {\n          newGuidelines.push({\n            vertical: true,\n            position: point.x\n          });\n        }\n        if (Math.abs(snapped.y - point.y) < 15) {\n          newGuidelines.push({\n            vertical: false,\n            position: point.y\n          });\n        }\n      });\n      setGuidelines(newGuidelines);\n    },\n    drop: (item, monitor) => {\n      const clientOffset = monitor.getClientOffset();\n      if (!clientOffset || !canvasRef.current) {\n        toast.error('Không thể xác định vị trí thả!');\n        return;\n      }\n      const pos = getCanvasPosition(clientOffset.x, clientOffset.y, canvasRef, zoomLevel, canvasRef.current.scrollLeft, canvasRef.current.scrollTop);\n      const snapped = snapToGrid(pos.x, pos.y, showGrid ? gridSize : Infinity, snapPoints, canvasBounds);\n      if (item.json) {\n        // Thêm phần tử mới\n        onAddElement({\n          id: `${item.id}-${Date.now()}`,\n          type: item.json.type,\n          componentData: item.json.componentData || {},\n          position: {\n            [viewMode]: snapped,\n            desktop: snapped,\n            tablet: snapped,\n            mobile: snapped\n          },\n          size: item.json.size || {\n            width: 200,\n            height: 50\n          },\n          styles: item.json.styles || {}\n        });\n        toast.success('Đã thêm phần tử!');\n      } else if (item.id) {\n        var _pageData$elements$fi;\n        // Di chuyển phần tử hiện có, sử dụng handleUpdatePosition để hỗ trợ undo\n        const prevPosition = (_pageData$elements$fi = pageData.elements.find(el => el.id === item.id)) === null || _pageData$elements$fi === void 0 ? void 0 : _pageData$elements$fi.position[viewMode];\n        handleUpdatePosition(item.id, {\n          [viewMode]: snapped\n        }, true, prevPosition);\n        toast.success('Đã di chuyển phần tử!');\n      }\n      setGuidelines([]);\n    },\n    collect: monitor => ({\n      isOver: !!monitor.isOver(),\n      dragItem: monitor.getItem()\n    })\n  }));\n  const handleCanvasClick = e => {\n    if (e.target === canvasRef.current) {\n      onSelectElement([]);\n      setContextMenu(null);\n    }\n  };\n  const handleContextMenu = (id, position) => {\n    setContextMenu({\n      id,\n      position\n    });\n  };\n  const handleKeyDown = useCallback(e => {\n    if (!selectedIds.length) return;\n    const nudgeDistance = e.shiftKey ? 10 : 1;\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        selectedIds.forEach(id => {\n          const element = pageData.elements.find(el => el.id === id);\n          if (element) {\n            const currentPos = element.position[viewMode] || {\n              x: 0,\n              y: 0\n            };\n            const prevPos = currentPos;\n            const newY = Math.max(0, currentPos.y - nudgeDistance);\n            handleUpdatePosition(id, {\n              [viewMode]: {\n                x: currentPos.x,\n                y: newY\n              }\n            }, true, prevPos);\n          }\n        });\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        selectedIds.forEach(id => {\n          const element = pageData.elements.find(el => el.id === id);\n          if (element) {\n            const currentPos = element.position[viewMode] || {\n              x: 0,\n              y: 0\n            };\n            const prevPos = currentPos;\n            const newY = Math.min(canvasBounds.height - element.size.height, currentPos.y + nudgeDistance);\n            handleUpdatePosition(id, {\n              [viewMode]: {\n                x: currentPos.x,\n                y: newY\n              }\n            }, true, prevPos);\n          }\n        });\n        break;\n      case 'ArrowLeft':\n        e.preventDefault();\n        selectedIds.forEach(id => {\n          const element = pageData.elements.find(el => el.id === id);\n          if (element) {\n            const currentPos = element.position[viewMode] || {\n              x: 0,\n              y: 0\n            };\n            const prevPos = currentPos;\n            const newX = Math.max(0, currentPos.x - nudgeDistance);\n            handleUpdatePosition(id, {\n              [viewMode]: {\n                x: newX,\n                y: currentPos.y\n              }\n            }, true, prevPos);\n          }\n        });\n        break;\n      case 'ArrowRight':\n        e.preventDefault();\n        selectedIds.forEach(id => {\n          const element = pageData.elements.find(el => el.id === id);\n          if (element) {\n            const currentPos = element.position[viewMode] || {\n              x: 0,\n              y: 0\n            };\n            const prevPos = currentPos;\n            const newX = Math.min(canvasBounds.width - element.size.width, currentPos.x + nudgeDistance);\n            handleUpdatePosition(id, {\n              [viewMode]: {\n                x: newX,\n                y: currentPos.y\n              }\n            }, true, prevPos);\n          }\n        });\n        break;\n      case 'Delete':\n      case 'Backspace':\n        e.preventDefault();\n        selectedIds.forEach(id => onDeleteElement(id));\n        break;\n      case 'Escape':\n        e.preventDefault();\n        onSelectElement([]);\n        setContextMenu(null);\n        break;\n    }\n  }, [selectedIds, handleUpdatePosition, onDeleteElement, onSelectElement, viewMode, pageData.elements, canvasBounds]);\n  useHotkeys('ctrl+a', e => {\n    e.preventDefault();\n    onSelectElement(pageData.elements.map(el => el.id));\n  }, [pageData.elements, onSelectElement]);\n  useHotkeys('ctrl+g', e => {\n    e.preventDefault();\n    if (selectedIds.length > 1) {\n      onGroupElements(selectedIds);\n    }\n  }, [selectedIds, onGroupElements]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"lpb-canvas-wrapper\",\n    onKeyDown: handleKeyDown,\n    tabIndex: 0,\n    style: {\n      outline: 'none'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: node => {\n        canvasRef.current = node;\n        drop(node);\n      },\n      className: `lpb-canvas ${viewMode === 'mobile' ? 'lpb-canvas-mobile' : viewMode === 'tablet' ? 'lpb-canvas-tablet' : ''}`,\n      style: {\n        position: 'relative',\n        width: canvasBounds.width,\n        height: canvasBounds.height,\n        minHeight: '100vh',\n        background: (pageData === null || pageData === void 0 ? void 0 : (_pageData$canvas3 = pageData.canvas) === null || _pageData$canvas3 === void 0 ? void 0 : _pageData$canvas3.background) || '#ffffff',\n        transform: `scale(${zoomLevel / 100})`,\n        transformOrigin: 'top left',\n        cursor: isOver ? 'copy' : 'default'\n      },\n      onClick: handleCanvasClick,\n      children: [/*#__PURE__*/_jsxDEV(Rulers, {\n        canvasWidth: canvasBounds.width,\n        canvasHeight: canvasBounds.height,\n        zoomLevel: zoomLevel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Guidelines, {\n        guidelines: guidelines,\n        zoomLevel: zoomLevel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 21\n      }, this), showGrid && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lpb-canvas-grid\",\n        style: {\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          backgroundImage: `\n                                    linear-gradient(to right, #e5e7eb 1px, transparent 1px),\n                                    linear-gradient(to bottom, #e5e7eb 1px, transparent 1px)\n                                `,\n          backgroundSize: `${gridSize}px ${gridSize}px`,\n          pointerEvents: 'none',\n          opacity: 0.5\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 494,\n        columnNumber: 25\n      }, this), pageData === null || pageData === void 0 ? void 0 : (_pageData$elements2 = pageData.elements) === null || _pageData$elements2 === void 0 ? void 0 : _pageData$elements2.map(element => /*#__PURE__*/_jsxDEV(Element, {\n        element: element,\n        isSelected: selectedIds.includes(element.id),\n        onSelectElement: onSelectElement,\n        onUpdatePosition: handleUpdatePosition // Sử dụng phiên bản hỗ trợ undo\n        ,\n        viewMode: viewMode,\n        zoomLevel: zoomLevel,\n        gridSize: showGrid ? gridSize : Infinity,\n        onContextMenu: handleContextMenu,\n        canvasRef: canvasRef,\n        snapPoints: snapPoints,\n        canvasBounds: canvasBounds\n      }, element.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 25\n      }, this)), isOver && (dragItem === null || dragItem === void 0 ? void 0 : dragItem.json) && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          left: `${((_dragItem$offset = dragItem.offset) === null || _dragItem$offset === void 0 ? void 0 : _dragItem$offset.x) || 0}px`,\n          // Sử dụng offset nếu có\n          top: `${((_dragItem$offset2 = dragItem.offset) === null || _dragItem$offset2 === void 0 ? void 0 : _dragItem$offset2.y) || 0}px`,\n          width: ((_dragItem$json$size = dragItem.json.size) === null || _dragItem$json$size === void 0 ? void 0 : _dragItem$json$size.width) || 200,\n          height: ((_dragItem$json$size2 = dragItem.json.size) === null || _dragItem$json$size2 === void 0 ? void 0 : _dragItem$json$size2.height) || 50,\n          background: '#ccc',\n          opacity: 0.5,\n          pointerEvents: 'none',\n          zIndex: 9999\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 530,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(SelectionOverlay, {\n        selectedElements: (pageData === null || pageData === void 0 ? void 0 : (_pageData$elements3 = pageData.elements) === null || _pageData$elements3 === void 0 ? void 0 : _pageData$elements3.filter(el => selectedIds.includes(el.id))) || [],\n        onResize: onUpdateSize,\n        zoomLevel: zoomLevel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 544,\n        columnNumber: 21\n      }, this), contextMenu && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lpb-context-menu\",\n        style: {\n          position: 'fixed',\n          left: contextMenu.position.x,\n          top: contextMenu.position.y,\n          background: 'white',\n          border: '1px solid #ccc',\n          borderRadius: '4px',\n          boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n          zIndex: 10000\n        },\n        onClick: () => setContextMenu(null),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lpb-context-menu-item\",\n          style: {\n            padding: '8px 12px',\n            cursor: 'pointer',\n            borderBottom: '1px solid #eee'\n          },\n          onClick: () => {\n            onDeleteElement(contextMenu.id);\n            setContextMenu(null);\n          },\n          children: \"Delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 564,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lpb-context-menu-item\",\n          style: {\n            padding: '8px 12px',\n            cursor: 'pointer'\n          },\n          onClick: () => {\n            onGroupElements([contextMenu.id]);\n            setContextMenu(null);\n          },\n          children: \"Group\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 574,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 550,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 473,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 472,\n    columnNumber: 13\n  }, this);\n}, \"V/hebefIp+0XDbG4hV/SYNWVVdE=\", false, function () {\n  return [useHotkeys, useHotkeys, useDrop, useHotkeys, useHotkeys];\n})), \"V/hebefIp+0XDbG4hV/SYNWVVdE=\", false, function () {\n  return [useHotkeys, useHotkeys, useDrop, useHotkeys, useHotkeys];\n});\n_c4 = Canvas;\nexport default Canvas;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"Element$React.memo\");\n$RefreshReg$(_c2, \"Element\");\n$RefreshReg$(_c3, \"Canvas$React.memo\");\n$RefreshReg$(_c4, \"Canvas\");","map":{"version":3,"names":["React","useRef","useCallback","useState","useEffect","useDrop","useDrag","useHotkeys","toast","Guidelines","Rulers","SelectionOverlay","throttle","jsxDEV","_jsxDEV","ItemTypes","ELEMENT","EXISTING_ELEMENT","getCanvasPosition","mouseX","mouseY","canvasRef","zoomLevel","scrollX","scrollY","current","console","error","x","y","canvasRect","getBoundingClientRect","left","top","Math","max","snapToGrid","gridSize","snapPoints","canvasBounds","snappedX","round","snappedY","forEach","point","abs","min","width","height","getElementBounds","element","_element$position$des","_element$position$des2","_element$position$des3","_element$size","_element$position$des4","_element$size2","_element$position$des5","_element$size3","_element$position$des6","_element$size4","position","desktop","right","size","bottom","centerX","centerY","Element","_s","memo","_c","isSelected","onSelectElement","onUpdatePosition","viewMode","onContextMenu","_position$viewMode3","_position$viewMode4","id","type","componentData","styles","elementRef","tempPositionRef","offsetRef","isDragging","drag","item","_elementRef$current","_canvasRef$current","_position$viewMode","_position$viewMode2","elementRect","offset","end","monitor","clientOffset","getClientOffset","pos","scrollLeft","scrollTop","prevPosition","snapped","collect","handleMouseMove","e","clientX","clientY","rawX","rawY","altKey","style","animationFrameId","onMove","requestAnimationFrame","document","addEventListener","removeEventListener","cancelAnimationFrame","handleMouseDown","stopPropagation","ctrlKey","handleContextMenu","preventDefault","ref","node","className","zIndex","z","cursor","opacity","onMouseDown","children","fontSize","color","margin","userSelect","content","fileName","_jsxFileName","lineNumber","columnNumber","padding","borderRadius","background","border","src","alt","maxWidth","pointerEvents","display","flexDirection","gap","placeholder","readOnly","_c2","Canvas","_s2","_c3","pageData","selectedIds","onUpdateSize","onDeleteElement","onAddElement","onGroupElements","showGrid","_pageData$canvas","_pageData$canvas2","_pageData$canvas3","_pageData$elements2","_dragItem$offset","_dragItem$offset2","_dragItem$json$size","_dragItem$json$size2","_pageData$elements3","guidelines","setGuidelines","contextMenu","setContextMenu","history","setHistory","historyIndex","setHistoryIndex","canvas","useMemo","_pageData$elements","points","elements","flatMap","el","bounds","push","handleUpdatePosition","newPos","commit","prevPos","prev","slice","handleUndo","handleRedo","length","isOver","dragItem","drop","accept","hover","Infinity","newGuidelines","vertical","json","Date","now","tablet","mobile","success","_pageData$elements$fi","find","getItem","handleCanvasClick","target","handleKeyDown","nudgeDistance","shiftKey","key","currentPos","newY","newX","map","onKeyDown","tabIndex","outline","minHeight","transform","transformOrigin","onClick","canvasWidth","canvasHeight","backgroundImage","backgroundSize","includes","selectedElements","filter","onResize","boxShadow","borderBottom","_c4","$RefreshReg$"],"sources":["F:/landinghub-iconic/apps/web/src/components/create-page/Canvas.js"],"sourcesContent":["import React, { useRef, useCallback, useState, useEffect } from 'react';\r\nimport { useDrop, useDrag } from 'react-dnd';\r\nimport { useHotkeys } from 'react-hotkeys-hook';\r\nimport { toast } from 'react-toastify';\r\nimport Guidelines from './Guidelines';\r\nimport Rulers from './Rulers';\r\nimport SelectionOverlay from './SelectionOverlay';\r\nimport { throttle } from 'lodash'; // npm install lodash\r\nimport '../../styles/Canvas.css';\r\n\r\nconst ItemTypes = {\r\n    ELEMENT: 'element',\r\n    EXISTING_ELEMENT: 'existingElement',\r\n};\r\n\r\n// Hàm tính tọa độ trên Canvas\r\nconst getCanvasPosition = (mouseX, mouseY, canvasRef, zoomLevel, scrollX = 0, scrollY = 0) => {\r\n    if (!canvasRef.current) {\r\n        console.error('Canvas ref is null in getCanvasPosition');\r\n        return { x: 0, y: 0 };\r\n    }\r\n    const canvasRect = canvasRef.current.getBoundingClientRect();\r\n    const x = (mouseX - canvasRect.left + scrollX) / (zoomLevel / 100);\r\n    const y = (mouseY - canvasRect.top + scrollY) / (zoomLevel / 100);\r\n    return { x: Math.max(0, x), y: Math.max(0, y) };\r\n};\r\n\r\n// Hàm snapping\r\nconst snapToGrid = (x, y, gridSize, snapPoints = [], canvasBounds) => {\r\n    let snappedX = Math.round(x / gridSize) * gridSize;\r\n    let snappedY = Math.round(y / gridSize) * gridSize;\r\n\r\n    snapPoints.forEach((point) => {\r\n        if (Math.abs(x - point.x) < 15) snappedX = point.x;\r\n        if (Math.abs(y - point.y) < 15) snappedY = point.y;\r\n    });\r\n\r\n    snappedX = Math.max(0, Math.min(snappedX, canvasBounds.width));\r\n    snappedY = Math.max(0, Math.min(snappedY, canvasBounds.height));\r\n\r\n    return { x: snappedX, y: snappedY };\r\n};\r\n\r\n// Hàm tính bounds của phần tử\r\nconst getElementBounds = (element) => ({\r\n    left: element.position.desktop?.x || 0,\r\n    top: element.position.desktop?.y || 0,\r\n    right: (element.position.desktop?.x || 0) + (element.size?.width || 200),\r\n    bottom: (element.position.desktop?.y || 0) + (element.size?.height || 50),\r\n    centerX: (element.position.desktop?.x || 0) + (element.size?.width || 200) / 2,\r\n    centerY: (element.position.desktop?.y || 0) + (element.size?.height || 50) / 2,\r\n});\r\n\r\nconst Element = React.memo(\r\n    ({\r\n         element,\r\n         isSelected,\r\n         onSelectElement,\r\n         onUpdatePosition,\r\n         viewMode,\r\n         zoomLevel,\r\n         gridSize,\r\n         onContextMenu,\r\n         canvasRef,\r\n         snapPoints,\r\n         canvasBounds,\r\n     }) => {\r\n        const { id, type, componentData = {}, position = {}, size = { width: 200, height: 50 }, styles = {} } = element;\r\n        const elementRef = useRef(null);\r\n        const tempPositionRef = useRef(position[viewMode] || { x: 0, y: 0 });\r\n        const offsetRef = useRef({ x: 0, y: 0 });\r\n\r\n        const [{ isDragging }, drag] = useDrag(() => ({\r\n            type: ItemTypes.EXISTING_ELEMENT,\r\n            item: () => {\r\n                const elementRect = elementRef.current?.getBoundingClientRect();\r\n                const canvasRect = canvasRef.current?.getBoundingClientRect();\r\n                if (!elementRect || !canvasRect) {\r\n                    console.error('Cannot calculate offset for element:', id);\r\n                    return { id, offset: { x: 0, y: 0 } };\r\n                }\r\n                const offset = {\r\n                    x: (elementRect.left - canvasRect.left) / (zoomLevel / 100) - (position[viewMode]?.x || 0),\r\n                    y: (elementRect.top - canvasRect.top) / (zoomLevel / 100) - (position[viewMode]?.y || 0),\r\n                };\r\n                offsetRef.current = offset;\r\n                return { id, offset };\r\n            },\r\n            end: (item, monitor) => {\r\n                const clientOffset = monitor.getClientOffset();\r\n                if (!clientOffset || !canvasRef.current) return;\r\n                const pos = getCanvasPosition(\r\n                    clientOffset.x,\r\n                    clientOffset.y,\r\n                    canvasRef,\r\n                    zoomLevel,\r\n                    canvasRef.current.scrollLeft,\r\n                    canvasRef.current.scrollTop\r\n                );\r\n                const prevPosition = position[viewMode]; // Lưu vị trí cũ cho undo\r\n                const snapped = snapToGrid(pos.x - item.offset.x, pos.y - item.offset.y, gridSize, snapPoints, canvasBounds);\r\n                onUpdatePosition(id, { [viewMode]: snapped }, true, prevPosition); // Truyền prevPosition cho undo\r\n                tempPositionRef.current = snapped;\r\n            },\r\n            collect: (monitor) => ({\r\n                isDragging: !!monitor.isDragging(),\r\n            }),\r\n        }));\r\n\r\n        const handleMouseMove = useCallback(\r\n            (e) => { // Sử dụng requestAnimationFrame thay vì throttle cho mượt mà hơn\r\n                if (!isDragging || !canvasRef.current) return;\r\n                const pos = getCanvasPosition(\r\n                    e.clientX,\r\n                    e.clientY,\r\n                    canvasRef,\r\n                    zoomLevel,\r\n                    canvasRef.current.scrollLeft,\r\n                    canvasRef.current.scrollTop\r\n                );\r\n                const rawX = pos.x - offsetRef.current.x;\r\n                const rawY = pos.y - offsetRef.current.y;\r\n                const snapped = e.altKey\r\n                    ? { x: rawX, y: rawY } // Tắt snapping nếu giữ Alt\r\n                    : snapToGrid(rawX, rawY, gridSize, snapPoints, canvasBounds);\r\n\r\n                // Giới hạn trong bounds canvas\r\n                snapped.x = Math.max(0, Math.min(snapped.x, canvasBounds.width - size.width));\r\n                snapped.y = Math.max(0, Math.min(snapped.y, canvasBounds.height - size.height));\r\n\r\n                tempPositionRef.current = snapped;\r\n                if (elementRef.current) {\r\n                    elementRef.current.style.left = `${snapped.x}px`;\r\n                    elementRef.current.style.top = `${snapped.y}px`;\r\n                }\r\n            },\r\n            [isDragging, canvasRef, zoomLevel, gridSize, snapPoints, canvasBounds, size]\r\n        );\r\n\r\n        useEffect(() => {\r\n            let animationFrameId;\r\n            if (isDragging) {\r\n                const onMove = (e) => {\r\n                    animationFrameId = requestAnimationFrame(() => handleMouseMove(e));\r\n                };\r\n                document.addEventListener('mousemove', onMove);\r\n                return () => {\r\n                    document.removeEventListener('mousemove', onMove);\r\n                    cancelAnimationFrame(animationFrameId);\r\n                };\r\n            }\r\n        }, [isDragging, handleMouseMove]);\r\n\r\n        const handleMouseDown = (e) => {\r\n            e.stopPropagation();\r\n            onSelectElement(id, e.ctrlKey);\r\n        };\r\n\r\n        const handleContextMenu = (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            onContextMenu(id, { x: e.clientX, y: e.clientY });\r\n        };\r\n\r\n        return (\r\n            <div\r\n                ref={(node) => {\r\n                    elementRef.current = node;\r\n                    drag(node);\r\n                }}\r\n                className={`lpb-canvas-element ${isSelected ? 'lpb-canvas-element-selected' : ''} ${isDragging ? 'lpb-canvas-element-dragging' : ''}`}\r\n                style={{\r\n                    position: 'absolute',\r\n                    left: position[viewMode]?.x || 0,\r\n                    top: position[viewMode]?.y || 0,\r\n                    width: size.width,\r\n                    height: size.height,\r\n                    zIndex: position.z || 1,\r\n                    cursor: isDragging ? 'grabbing' : 'grab',\r\n                    opacity: isDragging ? 0.8 : 1,\r\n                    ...styles,\r\n                }}\r\n                onMouseDown={handleMouseDown}\r\n                onContextMenu={handleContextMenu}\r\n            >\r\n                {(() => {\r\n                    switch (type) {\r\n                        case 'heading':\r\n                            return (\r\n                                <h2 style={{ fontSize: componentData.fontSize || '1.5rem', color: componentData.color || '#1f2937', margin: 0, userSelect: 'none' }}>\r\n                                    {componentData.content || 'Tiêu đề'}\r\n                                </h2>\r\n                            );\r\n                        case 'paragraph':\r\n                            return (\r\n                                <p style={{ fontSize: componentData.fontSize || '1rem', color: componentData.color || '#1f2937', margin: 0, userSelect: 'none' }}>\r\n                                    {componentData.content || 'Đoạn văn'}\r\n                                </p>\r\n                            );\r\n                        case 'button':\r\n                            return (\r\n                                <button style={{ padding: '8px 16px', borderRadius: '8px', background: componentData.background || '#2563eb', color: componentData.color || '#fff', border: 'none', cursor: 'pointer', userSelect: 'none' }}>\r\n                                    {componentData.content || 'Nút'}\r\n                                </button>\r\n                            );\r\n                        case 'image':\r\n                            return (\r\n                                <img\r\n                                    src={componentData.src || 'https://via.placeholder.com/150'}\r\n                                    alt=\"Image\"\r\n                                    style={{ maxWidth: '100%', height: 'auto', userSelect: 'none', pointerEvents: 'none' }}\r\n                                />\r\n                            );\r\n                        case 'form':\r\n                            return (\r\n                                <form style={{ display: 'flex', flexDirection: 'column', gap: '10px', userSelect: 'none' }}>\r\n                                    <input type=\"text\" placeholder=\"Input\" style={{ padding: '8px', borderRadius: '8px', border: '1px solid #ccc' }} readOnly />\r\n                                    <button type=\"button\" style={{ background: '#2563eb', color: '#fff', padding: '8px 16px', borderRadius: '8px', border: 'none' }}>\r\n                                        Submit\r\n                                    </button>\r\n                                </form>\r\n                            );\r\n                        default:\r\n                            return <div style={{ userSelect: 'none' }}>{componentData.content || 'Unknown'}</div>;\r\n                    }\r\n                })()}\r\n            </div>\r\n        );\r\n    }\r\n);\r\n\r\nconst Canvas = React.memo(\r\n    ({\r\n         pageData,\r\n         selectedIds,\r\n         onSelectElement,\r\n         onUpdatePosition,\r\n         onUpdateSize,\r\n         onDeleteElement,\r\n         onAddElement,\r\n         onGroupElements,\r\n         viewMode,\r\n         zoomLevel,\r\n         gridSize,\r\n         showGrid,\r\n     }) => {\r\n        const canvasRef = useRef(null);\r\n        const [guidelines, setGuidelines] = useState([]);\r\n        const [contextMenu, setContextMenu] = useState(null);\r\n        const [history, setHistory] = useState([]); // Stack cho undo/redo (demo đơn giản)\r\n        const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n        const canvasBounds = {\r\n            width: pageData?.canvas?.width || 1200,\r\n            height: pageData?.canvas?.height || 1000,\r\n        };\r\n\r\n        const snapPoints = React.useMemo(() => {\r\n            const points = pageData?.elements?.flatMap((el) => {\r\n                const bounds = getElementBounds(el);\r\n                return [\r\n                    { x: bounds.left, y: bounds.top },\r\n                    { x: bounds.right, y: bounds.bottom },\r\n                    { x: bounds.centerX, y: bounds.centerY },\r\n                    { x: bounds.left, y: bounds.centerY },\r\n                    { x: bounds.right, y: bounds.centerY },\r\n                    { x: bounds.centerX, y: bounds.top },\r\n                    { x: bounds.centerX, y: bounds.bottom },\r\n                ];\r\n            }) || [];\r\n            points.push(\r\n                { x: 0, y: 0 },\r\n                { x: canvasBounds.width, y: 0 },\r\n                { x: 0, y: canvasBounds.height },\r\n                { x: canvasBounds.width, y: canvasBounds.height },\r\n                { x: canvasBounds.width / 2, y: canvasBounds.height / 2 }\r\n            );\r\n            return points;\r\n        }, [pageData?.elements, canvasBounds]);\r\n\r\n        const handleUpdatePosition = (id, newPos, commit, prevPos) => {\r\n            if (commit && prevPos) {\r\n                // Lưu vào history cho undo\r\n                setHistory((prev) => [...prev.slice(0, historyIndex + 1), { id, prevPos, newPos }]);\r\n                setHistoryIndex((prev) => prev + 1);\r\n            }\r\n            onUpdatePosition(id, newPos, commit);\r\n        };\r\n\r\n        const handleUndo = () => {\r\n            if (historyIndex >= 0) {\r\n                const { id, prevPos } = history[historyIndex];\r\n                onUpdatePosition(id, { [viewMode]: prevPos }, true);\r\n                setHistoryIndex((prev) => prev - 1);\r\n            }\r\n        };\r\n\r\n        const handleRedo = () => {\r\n            if (historyIndex < history.length - 1) {\r\n                const { id, newPos } = history[historyIndex + 1];\r\n                onUpdatePosition(id, { [viewMode]: newPos }, true);\r\n                setHistoryIndex((prev) => prev + 1);\r\n            }\r\n        };\r\n\r\n        useHotkeys('ctrl+z', handleUndo, [history, historyIndex]);\r\n        useHotkeys('ctrl+y', handleRedo, [history, historyIndex]);\r\n\r\n        const [{ isOver, dragItem }, drop] = useDrop(() => ({\r\n            accept: [ItemTypes.ELEMENT, ItemTypes.EXISTING_ELEMENT],\r\n            hover: (item, monitor) => {\r\n                const clientOffset = monitor.getClientOffset();\r\n                if (!clientOffset || !canvasRef.current) return;\r\n\r\n                const pos = getCanvasPosition(\r\n                    clientOffset.x,\r\n                    clientOffset.y,\r\n                    canvasRef,\r\n                    zoomLevel,\r\n                    canvasRef.current.scrollLeft,\r\n                    canvasRef.current.scrollTop\r\n                );\r\n                const snapped = snapToGrid(pos.x, pos.y, showGrid ? gridSize : Infinity, snapPoints, canvasBounds);\r\n\r\n                const newGuidelines = [];\r\n                snapPoints.forEach((point) => {\r\n                    if (Math.abs(snapped.x - point.x) < 15) {\r\n                        newGuidelines.push({ vertical: true, position: point.x });\r\n                    }\r\n                    if (Math.abs(snapped.y - point.y) < 15) {\r\n                        newGuidelines.push({ vertical: false, position: point.y });\r\n                    }\r\n                });\r\n                setGuidelines(newGuidelines);\r\n            },\r\n            drop: (item, monitor) => {\r\n                const clientOffset = monitor.getClientOffset();\r\n                if (!clientOffset || !canvasRef.current) {\r\n                    toast.error('Không thể xác định vị trí thả!');\r\n                    return;\r\n                }\r\n\r\n                const pos = getCanvasPosition(\r\n                    clientOffset.x,\r\n                    clientOffset.y,\r\n                    canvasRef,\r\n                    zoomLevel,\r\n                    canvasRef.current.scrollLeft,\r\n                    canvasRef.current.scrollTop\r\n                );\r\n                const snapped = snapToGrid(pos.x, pos.y, showGrid ? gridSize : Infinity, snapPoints, canvasBounds);\r\n\r\n                if (item.json) {\r\n                    // Thêm phần tử mới\r\n                    onAddElement({\r\n                        id: `${item.id}-${Date.now()}`,\r\n                        type: item.json.type,\r\n                        componentData: item.json.componentData || {},\r\n                        position: { [viewMode]: snapped, desktop: snapped, tablet: snapped, mobile: snapped },\r\n                        size: item.json.size || { width: 200, height: 50 },\r\n                        styles: item.json.styles || {},\r\n                    });\r\n                    toast.success('Đã thêm phần tử!');\r\n                } else if (item.id) {\r\n                    // Di chuyển phần tử hiện có, sử dụng handleUpdatePosition để hỗ trợ undo\r\n                    const prevPosition = pageData.elements.find((el) => el.id === item.id)?.position[viewMode];\r\n                    handleUpdatePosition(item.id, { [viewMode]: snapped }, true, prevPosition);\r\n                    toast.success('Đã di chuyển phần tử!');\r\n                }\r\n                setGuidelines([]);\r\n            },\r\n            collect: (monitor) => ({\r\n                isOver: !!monitor.isOver(),\r\n                dragItem: monitor.getItem(),\r\n            }),\r\n        }));\r\n\r\n        const handleCanvasClick = (e) => {\r\n            if (e.target === canvasRef.current) {\r\n                onSelectElement([]);\r\n                setContextMenu(null);\r\n            }\r\n        };\r\n\r\n        const handleContextMenu = (id, position) => {\r\n            setContextMenu({ id, position });\r\n        };\r\n\r\n        const handleKeyDown = useCallback(\r\n            (e) => {\r\n                if (!selectedIds.length) return;\r\n\r\n                const nudgeDistance = e.shiftKey ? 10 : 1;\r\n\r\n                switch (e.key) {\r\n                    case 'ArrowUp':\r\n                        e.preventDefault();\r\n                        selectedIds.forEach((id) => {\r\n                            const element = pageData.elements.find((el) => el.id === id);\r\n                            if (element) {\r\n                                const currentPos = element.position[viewMode] || { x: 0, y: 0 };\r\n                                const prevPos = currentPos;\r\n                                const newY = Math.max(0, currentPos.y - nudgeDistance);\r\n                                handleUpdatePosition(id, { [viewMode]: { x: currentPos.x, y: newY } }, true, prevPos);\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'ArrowDown':\r\n                        e.preventDefault();\r\n                        selectedIds.forEach((id) => {\r\n                            const element = pageData.elements.find((el) => el.id === id);\r\n                            if (element) {\r\n                                const currentPos = element.position[viewMode] || { x: 0, y: 0 };\r\n                                const prevPos = currentPos;\r\n                                const newY = Math.min(canvasBounds.height - element.size.height, currentPos.y + nudgeDistance);\r\n                                handleUpdatePosition(id, { [viewMode]: { x: currentPos.x, y: newY } }, true, prevPos);\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'ArrowLeft':\r\n                        e.preventDefault();\r\n                        selectedIds.forEach((id) => {\r\n                            const element = pageData.elements.find((el) => el.id === id);\r\n                            if (element) {\r\n                                const currentPos = element.position[viewMode] || { x: 0, y: 0 };\r\n                                const prevPos = currentPos;\r\n                                const newX = Math.max(0, currentPos.x - nudgeDistance);\r\n                                handleUpdatePosition(id, { [viewMode]: { x: newX, y: currentPos.y } }, true, prevPos);\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'ArrowRight':\r\n                        e.preventDefault();\r\n                        selectedIds.forEach((id) => {\r\n                            const element = pageData.elements.find((el) => el.id === id);\r\n                            if (element) {\r\n                                const currentPos = element.position[viewMode] || { x: 0, y: 0 };\r\n                                const prevPos = currentPos;\r\n                                const newX = Math.min(canvasBounds.width - element.size.width, currentPos.x + nudgeDistance);\r\n                                handleUpdatePosition(id, { [viewMode]: { x: newX, y: currentPos.y } }, true, prevPos);\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'Delete':\r\n                    case 'Backspace':\r\n                        e.preventDefault();\r\n                        selectedIds.forEach((id) => onDeleteElement(id));\r\n                        break;\r\n                    case 'Escape':\r\n                        e.preventDefault();\r\n                        onSelectElement([]);\r\n                        setContextMenu(null);\r\n                        break;\r\n                }\r\n            },\r\n            [selectedIds, handleUpdatePosition, onDeleteElement, onSelectElement, viewMode, pageData.elements, canvasBounds]\r\n        );\r\n\r\n        useHotkeys('ctrl+a', (e) => {\r\n            e.preventDefault();\r\n            onSelectElement(pageData.elements.map((el) => el.id));\r\n        }, [pageData.elements, onSelectElement]);\r\n\r\n        useHotkeys('ctrl+g', (e) => {\r\n            e.preventDefault();\r\n            if (selectedIds.length > 1) {\r\n                onGroupElements(selectedIds);\r\n            }\r\n        }, [selectedIds, onGroupElements]);\r\n\r\n        return (\r\n            <div className=\"lpb-canvas-wrapper\" onKeyDown={handleKeyDown} tabIndex={0} style={{ outline: 'none' }}>\r\n                <div\r\n                    ref={(node) => {\r\n                        canvasRef.current = node;\r\n                        drop(node);\r\n                    }}\r\n                    className={`lpb-canvas ${viewMode === 'mobile' ? 'lpb-canvas-mobile' : viewMode === 'tablet' ? 'lpb-canvas-tablet' : ''}`}\r\n                    style={{\r\n                        position: 'relative',\r\n                        width: canvasBounds.width,\r\n                        height: canvasBounds.height,\r\n                        minHeight: '100vh',\r\n                        background: pageData?.canvas?.background || '#ffffff',\r\n                        transform: `scale(${zoomLevel / 100})`,\r\n                        transformOrigin: 'top left',\r\n                        cursor: isOver ? 'copy' : 'default',\r\n                    }}\r\n                    onClick={handleCanvasClick}\r\n                >\r\n                    <Rulers canvasWidth={canvasBounds.width} canvasHeight={canvasBounds.height} zoomLevel={zoomLevel} />\r\n                    <Guidelines guidelines={guidelines} zoomLevel={zoomLevel} />\r\n                    {showGrid && (\r\n                        <div\r\n                            className=\"lpb-canvas-grid\"\r\n                            style={{\r\n                                position: 'absolute',\r\n                                top: 0,\r\n                                left: 0,\r\n                                right: 0,\r\n                                bottom: 0,\r\n                                backgroundImage: `\r\n                                    linear-gradient(to right, #e5e7eb 1px, transparent 1px),\r\n                                    linear-gradient(to bottom, #e5e7eb 1px, transparent 1px)\r\n                                `,\r\n                                backgroundSize: `${gridSize}px ${gridSize}px`,\r\n                                pointerEvents: 'none',\r\n                                opacity: 0.5,\r\n                            }}\r\n                        />\r\n                    )}\r\n                    {pageData?.elements?.map((element) => (\r\n                        <Element\r\n                            key={element.id}\r\n                            element={element}\r\n                            isSelected={selectedIds.includes(element.id)}\r\n                            onSelectElement={onSelectElement}\r\n                            onUpdatePosition={handleUpdatePosition} // Sử dụng phiên bản hỗ trợ undo\r\n                            viewMode={viewMode}\r\n                            zoomLevel={zoomLevel}\r\n                            gridSize={showGrid ? gridSize : Infinity}\r\n                            onContextMenu={handleContextMenu}\r\n                            canvasRef={canvasRef}\r\n                            snapPoints={snapPoints}\r\n                            canvasBounds={canvasBounds}\r\n                        />\r\n                    ))}\r\n                    {/* Preview khi kéo phần tử mới */}\r\n                    {isOver && dragItem?.json && (\r\n                        <div\r\n                            style={{\r\n                                position: 'absolute',\r\n                                left: `${dragItem.offset?.x || 0}px`, // Sử dụng offset nếu có\r\n                                top: `${dragItem.offset?.y || 0}px`,\r\n                                width: dragItem.json.size?.width || 200,\r\n                                height: dragItem.json.size?.height || 50,\r\n                                background: '#ccc',\r\n                                opacity: 0.5,\r\n                                pointerEvents: 'none',\r\n                                zIndex: 9999,\r\n                            }}\r\n                        />\r\n                    )}\r\n                    <SelectionOverlay\r\n                        selectedElements={pageData?.elements?.filter((el) => selectedIds.includes(el.id)) || []}\r\n                        onResize={onUpdateSize}\r\n                        zoomLevel={zoomLevel}\r\n                    />\r\n                    {contextMenu && (\r\n                        <div\r\n                            className=\"lpb-context-menu\"\r\n                            style={{\r\n                                position: 'fixed',\r\n                                left: contextMenu.position.x,\r\n                                top: contextMenu.position.y,\r\n                                background: 'white',\r\n                                border: '1px solid #ccc',\r\n                                borderRadius: '4px',\r\n                                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\r\n                                zIndex: 10000,\r\n                            }}\r\n                            onClick={() => setContextMenu(null)}\r\n                        >\r\n                            <div\r\n                                className=\"lpb-context-menu-item\"\r\n                                style={{ padding: '8px 12px', cursor: 'pointer', borderBottom: '1px solid #eee' }}\r\n                                onClick={() => {\r\n                                    onDeleteElement(contextMenu.id);\r\n                                    setContextMenu(null);\r\n                                }}\r\n                            >\r\n                                Delete\r\n                            </div>\r\n                            <div\r\n                                className=\"lpb-context-menu-item\"\r\n                                style={{ padding: '8px 12px', cursor: 'pointer' }}\r\n                                onClick={() => {\r\n                                    onGroupElements([contextMenu.id]);\r\n                                    setContextMenu(null);\r\n                                }}\r\n                            >\r\n                                Group\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n);\r\n\r\nexport default Canvas;"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,WAAW,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AACvE,SAASC,OAAO,EAAEC,OAAO,QAAQ,WAAW;AAC5C,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,SAASC,KAAK,QAAQ,gBAAgB;AACtC,OAAOC,UAAU,MAAM,cAAc;AACrC,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,gBAAgB,MAAM,oBAAoB;AACjD,SAASC,QAAQ,QAAQ,QAAQ,CAAC,CAAC;AACnC,OAAO,yBAAyB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEjC,MAAMC,SAAS,GAAG;EACdC,OAAO,EAAE,SAAS;EAClBC,gBAAgB,EAAE;AACtB,CAAC;;AAED;AACA,MAAMC,iBAAiB,GAAGA,CAACC,MAAM,EAAEC,MAAM,EAAEC,SAAS,EAAEC,SAAS,EAAEC,OAAO,GAAG,CAAC,EAAEC,OAAO,GAAG,CAAC,KAAK;EAC1F,IAAI,CAACH,SAAS,CAACI,OAAO,EAAE;IACpBC,OAAO,CAACC,KAAK,CAAC,yCAAyC,CAAC;IACxD,OAAO;MAAEC,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;EACzB;EACA,MAAMC,UAAU,GAAGT,SAAS,CAACI,OAAO,CAACM,qBAAqB,CAAC,CAAC;EAC5D,MAAMH,CAAC,GAAG,CAACT,MAAM,GAAGW,UAAU,CAACE,IAAI,GAAGT,OAAO,KAAKD,SAAS,GAAG,GAAG,CAAC;EAClE,MAAMO,CAAC,GAAG,CAACT,MAAM,GAAGU,UAAU,CAACG,GAAG,GAAGT,OAAO,KAAKF,SAAS,GAAG,GAAG,CAAC;EACjE,OAAO;IAAEM,CAAC,EAAEM,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEP,CAAC,CAAC;IAAEC,CAAC,EAAEK,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEN,CAAC;EAAE,CAAC;AACnD,CAAC;;AAED;AACA,MAAMO,UAAU,GAAGA,CAACR,CAAC,EAAEC,CAAC,EAAEQ,QAAQ,EAAEC,UAAU,GAAG,EAAE,EAAEC,YAAY,KAAK;EAClE,IAAIC,QAAQ,GAAGN,IAAI,CAACO,KAAK,CAACb,CAAC,GAAGS,QAAQ,CAAC,GAAGA,QAAQ;EAClD,IAAIK,QAAQ,GAAGR,IAAI,CAACO,KAAK,CAACZ,CAAC,GAAGQ,QAAQ,CAAC,GAAGA,QAAQ;EAElDC,UAAU,CAACK,OAAO,CAAEC,KAAK,IAAK;IAC1B,IAAIV,IAAI,CAACW,GAAG,CAACjB,CAAC,GAAGgB,KAAK,CAAChB,CAAC,CAAC,GAAG,EAAE,EAAEY,QAAQ,GAAGI,KAAK,CAAChB,CAAC;IAClD,IAAIM,IAAI,CAACW,GAAG,CAAChB,CAAC,GAAGe,KAAK,CAACf,CAAC,CAAC,GAAG,EAAE,EAAEa,QAAQ,GAAGE,KAAK,CAACf,CAAC;EACtD,CAAC,CAAC;EAEFW,QAAQ,GAAGN,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACY,GAAG,CAACN,QAAQ,EAAED,YAAY,CAACQ,KAAK,CAAC,CAAC;EAC9DL,QAAQ,GAAGR,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACY,GAAG,CAACJ,QAAQ,EAAEH,YAAY,CAACS,MAAM,CAAC,CAAC;EAE/D,OAAO;IAAEpB,CAAC,EAAEY,QAAQ;IAAEX,CAAC,EAAEa;EAAS,CAAC;AACvC,CAAC;;AAED;AACA,MAAMO,gBAAgB,GAAIC,OAAO;EAAA,IAAAC,qBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,aAAA,EAAAC,sBAAA,EAAAC,cAAA,EAAAC,sBAAA,EAAAC,cAAA,EAAAC,sBAAA,EAAAC,cAAA;EAAA,OAAM;IACnC5B,IAAI,EAAE,EAAAmB,qBAAA,GAAAD,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAX,qBAAA,uBAAxBA,qBAAA,CAA0BvB,CAAC,KAAI,CAAC;IACtCK,GAAG,EAAE,EAAAmB,sBAAA,GAAAF,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAV,sBAAA,uBAAxBA,sBAAA,CAA0BvB,CAAC,KAAI,CAAC;IACrCkC,KAAK,EAAE,CAAC,EAAAV,sBAAA,GAAAH,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAT,sBAAA,uBAAxBA,sBAAA,CAA0BzB,CAAC,KAAI,CAAC,KAAK,EAAA0B,aAAA,GAAAJ,OAAO,CAACc,IAAI,cAAAV,aAAA,uBAAZA,aAAA,CAAcP,KAAK,KAAI,GAAG,CAAC;IACxEkB,MAAM,EAAE,CAAC,EAAAV,sBAAA,GAAAL,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAP,sBAAA,uBAAxBA,sBAAA,CAA0B1B,CAAC,KAAI,CAAC,KAAK,EAAA2B,cAAA,GAAAN,OAAO,CAACc,IAAI,cAAAR,cAAA,uBAAZA,cAAA,CAAcR,MAAM,KAAI,EAAE,CAAC;IACzEkB,OAAO,EAAE,CAAC,EAAAT,sBAAA,GAAAP,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAL,sBAAA,uBAAxBA,sBAAA,CAA0B7B,CAAC,KAAI,CAAC,IAAI,CAAC,EAAA8B,cAAA,GAAAR,OAAO,CAACc,IAAI,cAAAN,cAAA,uBAAZA,cAAA,CAAcX,KAAK,KAAI,GAAG,IAAI,CAAC;IAC9EoB,OAAO,EAAE,CAAC,EAAAR,sBAAA,GAAAT,OAAO,CAACW,QAAQ,CAACC,OAAO,cAAAH,sBAAA,uBAAxBA,sBAAA,CAA0B9B,CAAC,KAAI,CAAC,IAAI,CAAC,EAAA+B,cAAA,GAAAV,OAAO,CAACc,IAAI,cAAAJ,cAAA,uBAAZA,cAAA,CAAcZ,MAAM,KAAI,EAAE,IAAI;EACjF,CAAC;AAAA,CAAC;AAEF,MAAMoB,OAAO,gBAAAC,EAAA,cAAGrE,KAAK,CAACsE,IAAI,CAAAC,EAAA,GAAAF,EAAA,CACtB,CAAC;EACInB,OAAO;EACPsB,UAAU;EACVC,eAAe;EACfC,gBAAgB;EAChBC,QAAQ;EACRrD,SAAS;EACTe,QAAQ;EACRuC,aAAa;EACbvD,SAAS;EACTiB,UAAU;EACVC;AACJ,CAAC,KAAK;EAAA,IAAAsC,mBAAA,EAAAC,mBAAA;EAAAT,EAAA;EACH,MAAM;IAAEU,EAAE;IAAEC,IAAI;IAAEC,aAAa,GAAG,CAAC,CAAC;IAAEpB,QAAQ,GAAG,CAAC,CAAC;IAAEG,IAAI,GAAG;MAAEjB,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAE;IAAG,CAAC;IAAEkC,MAAM,GAAG,CAAC;EAAE,CAAC,GAAGhC,OAAO;EAC/G,MAAMiC,UAAU,GAAGlF,MAAM,CAAC,IAAI,CAAC;EAC/B,MAAMmF,eAAe,GAAGnF,MAAM,CAAC4D,QAAQ,CAACc,QAAQ,CAAC,IAAI;IAAE/C,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAE,CAAC,CAAC;EACpE,MAAMwD,SAAS,GAAGpF,MAAM,CAAC;IAAE2B,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAE,CAAC,CAAC;EAExC,MAAM,CAAC;IAAEyD;EAAW,CAAC,EAAEC,IAAI,CAAC,GAAGjF,OAAO,CAAC,OAAO;IAC1C0E,IAAI,EAAEjE,SAAS,CAACE,gBAAgB;IAChCuE,IAAI,EAAEA,CAAA,KAAM;MAAA,IAAAC,mBAAA,EAAAC,kBAAA,EAAAC,kBAAA,EAAAC,mBAAA;MACR,MAAMC,WAAW,IAAAJ,mBAAA,GAAGN,UAAU,CAAC1D,OAAO,cAAAgE,mBAAA,uBAAlBA,mBAAA,CAAoB1D,qBAAqB,CAAC,CAAC;MAC/D,MAAMD,UAAU,IAAA4D,kBAAA,GAAGrE,SAAS,CAACI,OAAO,cAAAiE,kBAAA,uBAAjBA,kBAAA,CAAmB3D,qBAAqB,CAAC,CAAC;MAC7D,IAAI,CAAC8D,WAAW,IAAI,CAAC/D,UAAU,EAAE;QAC7BJ,OAAO,CAACC,KAAK,CAAC,sCAAsC,EAAEoD,EAAE,CAAC;QACzD,OAAO;UAAEA,EAAE;UAAEe,MAAM,EAAE;YAAElE,CAAC,EAAE,CAAC;YAAEC,CAAC,EAAE;UAAE;QAAE,CAAC;MACzC;MACA,MAAMiE,MAAM,GAAG;QACXlE,CAAC,EAAE,CAACiE,WAAW,CAAC7D,IAAI,GAAGF,UAAU,CAACE,IAAI,KAAKV,SAAS,GAAG,GAAG,CAAC,IAAI,EAAAqE,kBAAA,GAAA9B,QAAQ,CAACc,QAAQ,CAAC,cAAAgB,kBAAA,uBAAlBA,kBAAA,CAAoB/D,CAAC,KAAI,CAAC,CAAC;QAC1FC,CAAC,EAAE,CAACgE,WAAW,CAAC5D,GAAG,GAAGH,UAAU,CAACG,GAAG,KAAKX,SAAS,GAAG,GAAG,CAAC,IAAI,EAAAsE,mBAAA,GAAA/B,QAAQ,CAACc,QAAQ,CAAC,cAAAiB,mBAAA,uBAAlBA,mBAAA,CAAoB/D,CAAC,KAAI,CAAC;MAC3F,CAAC;MACDwD,SAAS,CAAC5D,OAAO,GAAGqE,MAAM;MAC1B,OAAO;QAAEf,EAAE;QAAEe;MAAO,CAAC;IACzB,CAAC;IACDC,GAAG,EAAEA,CAACP,IAAI,EAAEQ,OAAO,KAAK;MACpB,MAAMC,YAAY,GAAGD,OAAO,CAACE,eAAe,CAAC,CAAC;MAC9C,IAAI,CAACD,YAAY,IAAI,CAAC5E,SAAS,CAACI,OAAO,EAAE;MACzC,MAAM0E,GAAG,GAAGjF,iBAAiB,CACzB+E,YAAY,CAACrE,CAAC,EACdqE,YAAY,CAACpE,CAAC,EACdR,SAAS,EACTC,SAAS,EACTD,SAAS,CAACI,OAAO,CAAC2E,UAAU,EAC5B/E,SAAS,CAACI,OAAO,CAAC4E,SACtB,CAAC;MACD,MAAMC,YAAY,GAAGzC,QAAQ,CAACc,QAAQ,CAAC,CAAC,CAAC;MACzC,MAAM4B,OAAO,GAAGnE,UAAU,CAAC+D,GAAG,CAACvE,CAAC,GAAG4D,IAAI,CAACM,MAAM,CAAClE,CAAC,EAAEuE,GAAG,CAACtE,CAAC,GAAG2D,IAAI,CAACM,MAAM,CAACjE,CAAC,EAAEQ,QAAQ,EAAEC,UAAU,EAAEC,YAAY,CAAC;MAC5GmC,gBAAgB,CAACK,EAAE,EAAE;QAAE,CAACJ,QAAQ,GAAG4B;MAAQ,CAAC,EAAE,IAAI,EAAED,YAAY,CAAC,CAAC,CAAC;MACnElB,eAAe,CAAC3D,OAAO,GAAG8E,OAAO;IACrC,CAAC;IACDC,OAAO,EAAGR,OAAO,KAAM;MACnBV,UAAU,EAAE,CAAC,CAACU,OAAO,CAACV,UAAU,CAAC;IACrC,CAAC;EACL,CAAC,CAAC,CAAC;EAEH,MAAMmB,eAAe,GAAGvG,WAAW,CAC9BwG,CAAC,IAAK;IAAE;IACL,IAAI,CAACpB,UAAU,IAAI,CAACjE,SAAS,CAACI,OAAO,EAAE;IACvC,MAAM0E,GAAG,GAAGjF,iBAAiB,CACzBwF,CAAC,CAACC,OAAO,EACTD,CAAC,CAACE,OAAO,EACTvF,SAAS,EACTC,SAAS,EACTD,SAAS,CAACI,OAAO,CAAC2E,UAAU,EAC5B/E,SAAS,CAACI,OAAO,CAAC4E,SACtB,CAAC;IACD,MAAMQ,IAAI,GAAGV,GAAG,CAACvE,CAAC,GAAGyD,SAAS,CAAC5D,OAAO,CAACG,CAAC;IACxC,MAAMkF,IAAI,GAAGX,GAAG,CAACtE,CAAC,GAAGwD,SAAS,CAAC5D,OAAO,CAACI,CAAC;IACxC,MAAM0E,OAAO,GAAGG,CAAC,CAACK,MAAM,GAClB;MAAEnF,CAAC,EAAEiF,IAAI;MAAEhF,CAAC,EAAEiF;IAAK,CAAC,CAAC;IAAA,EACrB1E,UAAU,CAACyE,IAAI,EAAEC,IAAI,EAAEzE,QAAQ,EAAEC,UAAU,EAAEC,YAAY,CAAC;;IAEhE;IACAgE,OAAO,CAAC3E,CAAC,GAAGM,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACY,GAAG,CAACyD,OAAO,CAAC3E,CAAC,EAAEW,YAAY,CAACQ,KAAK,GAAGiB,IAAI,CAACjB,KAAK,CAAC,CAAC;IAC7EwD,OAAO,CAAC1E,CAAC,GAAGK,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACY,GAAG,CAACyD,OAAO,CAAC1E,CAAC,EAAEU,YAAY,CAACS,MAAM,GAAGgB,IAAI,CAAChB,MAAM,CAAC,CAAC;IAE/EoC,eAAe,CAAC3D,OAAO,GAAG8E,OAAO;IACjC,IAAIpB,UAAU,CAAC1D,OAAO,EAAE;MACpB0D,UAAU,CAAC1D,OAAO,CAACuF,KAAK,CAAChF,IAAI,GAAG,GAAGuE,OAAO,CAAC3E,CAAC,IAAI;MAChDuD,UAAU,CAAC1D,OAAO,CAACuF,KAAK,CAAC/E,GAAG,GAAG,GAAGsE,OAAO,CAAC1E,CAAC,IAAI;IACnD;EACJ,CAAC,EACD,CAACyD,UAAU,EAAEjE,SAAS,EAAEC,SAAS,EAAEe,QAAQ,EAAEC,UAAU,EAAEC,YAAY,EAAEyB,IAAI,CAC/E,CAAC;EAED5D,SAAS,CAAC,MAAM;IACZ,IAAI6G,gBAAgB;IACpB,IAAI3B,UAAU,EAAE;MACZ,MAAM4B,MAAM,GAAIR,CAAC,IAAK;QAClBO,gBAAgB,GAAGE,qBAAqB,CAAC,MAAMV,eAAe,CAACC,CAAC,CAAC,CAAC;MACtE,CAAC;MACDU,QAAQ,CAACC,gBAAgB,CAAC,WAAW,EAAEH,MAAM,CAAC;MAC9C,OAAO,MAAM;QACTE,QAAQ,CAACE,mBAAmB,CAAC,WAAW,EAAEJ,MAAM,CAAC;QACjDK,oBAAoB,CAACN,gBAAgB,CAAC;MAC1C,CAAC;IACL;EACJ,CAAC,EAAE,CAAC3B,UAAU,EAAEmB,eAAe,CAAC,CAAC;EAEjC,MAAMe,eAAe,GAAId,CAAC,IAAK;IAC3BA,CAAC,CAACe,eAAe,CAAC,CAAC;IACnBhD,eAAe,CAACM,EAAE,EAAE2B,CAAC,CAACgB,OAAO,CAAC;EAClC,CAAC;EAED,MAAMC,iBAAiB,GAAIjB,CAAC,IAAK;IAC7BA,CAAC,CAACkB,cAAc,CAAC,CAAC;IAClBlB,CAAC,CAACe,eAAe,CAAC,CAAC;IACnB7C,aAAa,CAACG,EAAE,EAAE;MAAEnD,CAAC,EAAE8E,CAAC,CAACC,OAAO;MAAE9E,CAAC,EAAE6E,CAAC,CAACE;IAAQ,CAAC,CAAC;EACrD,CAAC;EAED,oBACI9F,OAAA;IACI+G,GAAG,EAAGC,IAAI,IAAK;MACX3C,UAAU,CAAC1D,OAAO,GAAGqG,IAAI;MACzBvC,IAAI,CAACuC,IAAI,CAAC;IACd,CAAE;IACFC,SAAS,EAAE,sBAAsBvD,UAAU,GAAG,6BAA6B,GAAG,EAAE,IAAIc,UAAU,GAAG,6BAA6B,GAAG,EAAE,EAAG;IACtI0B,KAAK,EAAE;MACHnD,QAAQ,EAAE,UAAU;MACpB7B,IAAI,EAAE,EAAA6C,mBAAA,GAAAhB,QAAQ,CAACc,QAAQ,CAAC,cAAAE,mBAAA,uBAAlBA,mBAAA,CAAoBjD,CAAC,KAAI,CAAC;MAChCK,GAAG,EAAE,EAAA6C,mBAAA,GAAAjB,QAAQ,CAACc,QAAQ,CAAC,cAAAG,mBAAA,uBAAlBA,mBAAA,CAAoBjD,CAAC,KAAI,CAAC;MAC/BkB,KAAK,EAAEiB,IAAI,CAACjB,KAAK;MACjBC,MAAM,EAAEgB,IAAI,CAAChB,MAAM;MACnBgF,MAAM,EAAEnE,QAAQ,CAACoE,CAAC,IAAI,CAAC;MACvBC,MAAM,EAAE5C,UAAU,GAAG,UAAU,GAAG,MAAM;MACxC6C,OAAO,EAAE7C,UAAU,GAAG,GAAG,GAAG,CAAC;MAC7B,GAAGJ;IACP,CAAE;IACFkD,WAAW,EAAEZ,eAAgB;IAC7B5C,aAAa,EAAE+C,iBAAkB;IAAAU,QAAA,EAEhC,CAAC,MAAM;MACJ,QAAQrD,IAAI;QACR,KAAK,SAAS;UACV,oBACIlE,OAAA;YAAIkG,KAAK,EAAE;cAAEsB,QAAQ,EAAErD,aAAa,CAACqD,QAAQ,IAAI,QAAQ;cAAEC,KAAK,EAAEtD,aAAa,CAACsD,KAAK,IAAI,SAAS;cAAEC,MAAM,EAAE,CAAC;cAAEC,UAAU,EAAE;YAAO,CAAE;YAAAJ,QAAA,EAC/HpD,aAAa,CAACyD,OAAO,IAAI;UAAS;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnC,CAAC;QAEb,KAAK,WAAW;UACZ,oBACIhI,OAAA;YAAGkG,KAAK,EAAE;cAAEsB,QAAQ,EAAErD,aAAa,CAACqD,QAAQ,IAAI,MAAM;cAAEC,KAAK,EAAEtD,aAAa,CAACsD,KAAK,IAAI,SAAS;cAAEC,MAAM,EAAE,CAAC;cAAEC,UAAU,EAAE;YAAO,CAAE;YAAAJ,QAAA,EAC5HpD,aAAa,CAACyD,OAAO,IAAI;UAAU;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrC,CAAC;QAEZ,KAAK,QAAQ;UACT,oBACIhI,OAAA;YAAQkG,KAAK,EAAE;cAAE+B,OAAO,EAAE,UAAU;cAAEC,YAAY,EAAE,KAAK;cAAEC,UAAU,EAAEhE,aAAa,CAACgE,UAAU,IAAI,SAAS;cAAEV,KAAK,EAAEtD,aAAa,CAACsD,KAAK,IAAI,MAAM;cAAEW,MAAM,EAAE,MAAM;cAAEhB,MAAM,EAAE,SAAS;cAAEO,UAAU,EAAE;YAAO,CAAE;YAAAJ,QAAA,EACvMpD,aAAa,CAACyD,OAAO,IAAI;UAAK;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC3B,CAAC;QAEjB,KAAK,OAAO;UACR,oBACIhI,OAAA;YACIqI,GAAG,EAAElE,aAAa,CAACkE,GAAG,IAAI,iCAAkC;YAC5DC,GAAG,EAAC,OAAO;YACXpC,KAAK,EAAE;cAAEqC,QAAQ,EAAE,MAAM;cAAErG,MAAM,EAAE,MAAM;cAAEyF,UAAU,EAAE,MAAM;cAAEa,aAAa,EAAE;YAAO;UAAE;YAAAX,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1F,CAAC;QAEV,KAAK,MAAM;UACP,oBACIhI,OAAA;YAAMkG,KAAK,EAAE;cAAEuC,OAAO,EAAE,MAAM;cAAEC,aAAa,EAAE,QAAQ;cAAEC,GAAG,EAAE,MAAM;cAAEhB,UAAU,EAAE;YAAO,CAAE;YAAAJ,QAAA,gBACvFvH,OAAA;cAAOkE,IAAI,EAAC,MAAM;cAAC0E,WAAW,EAAC,OAAO;cAAC1C,KAAK,EAAE;gBAAE+B,OAAO,EAAE,KAAK;gBAAEC,YAAY,EAAE,KAAK;gBAAEE,MAAM,EAAE;cAAiB,CAAE;cAACS,QAAQ;YAAA;cAAAhB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAC5HhI,OAAA;cAAQkE,IAAI,EAAC,QAAQ;cAACgC,KAAK,EAAE;gBAAEiC,UAAU,EAAE,SAAS;gBAAEV,KAAK,EAAE,MAAM;gBAAEQ,OAAO,EAAE,UAAU;gBAAEC,YAAY,EAAE,KAAK;gBAAEE,MAAM,EAAE;cAAO,CAAE;cAAAb,QAAA,EAAC;YAEjI;cAAAM,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACP,CAAC;QAEf;UACI,oBAAOhI,OAAA;YAAKkG,KAAK,EAAE;cAAEyB,UAAU,EAAE;YAAO,CAAE;YAAAJ,QAAA,EAAEpD,aAAa,CAACyD,OAAO,IAAI;UAAS;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;MAC7F;IACJ,CAAC,EAAE;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEd,CAAC;EAAA,QA5JkCxI,OAAO;AAAA,EA6J9C,CAAC;EAAA,QA7JsCA,OAAO;AAAA,EA6J7C;AAACsJ,GAAA,GAhLIxF,OAAO;AAkLb,MAAMyF,MAAM,gBAAAC,GAAA,cAAG9J,KAAK,CAACsE,IAAI,CAAAyF,GAAA,GAAAD,GAAA,CACrB,CAAC;EACIE,QAAQ;EACRC,WAAW;EACXxF,eAAe;EACfC,gBAAgB;EAChBwF,YAAY;EACZC,eAAe;EACfC,YAAY;EACZC,eAAe;EACf1F,QAAQ;EACRrD,SAAS;EACTe,QAAQ;EACRiI;AACJ,CAAC,KAAK;EAAA,IAAAC,gBAAA,EAAAC,iBAAA,EAAAC,iBAAA,EAAAC,mBAAA,EAAAC,gBAAA,EAAAC,iBAAA,EAAAC,mBAAA,EAAAC,oBAAA,EAAAC,mBAAA;EAAAjB,GAAA;EACH,MAAMzI,SAAS,GAAGpB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAM,CAAC+K,UAAU,EAAEC,aAAa,CAAC,GAAG9K,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAAC+K,WAAW,EAAEC,cAAc,CAAC,GAAGhL,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACiL,OAAO,EAAEC,UAAU,CAAC,GAAGlL,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;EAC5C,MAAM,CAACmL,YAAY,EAAEC,eAAe,CAAC,GAAGpL,QAAQ,CAAC,CAAC,CAAC,CAAC;EAEpD,MAAMoC,YAAY,GAAG;IACjBQ,KAAK,EAAE,CAAAiH,QAAQ,aAARA,QAAQ,wBAAAO,gBAAA,GAARP,QAAQ,CAAEwB,MAAM,cAAAjB,gBAAA,uBAAhBA,gBAAA,CAAkBxH,KAAK,KAAI,IAAI;IACtCC,MAAM,EAAE,CAAAgH,QAAQ,aAARA,QAAQ,wBAAAQ,iBAAA,GAARR,QAAQ,CAAEwB,MAAM,cAAAhB,iBAAA,uBAAhBA,iBAAA,CAAkBxH,MAAM,KAAI;EACxC,CAAC;EAED,MAAMV,UAAU,GAAGtC,KAAK,CAACyL,OAAO,CAAC,MAAM;IAAA,IAAAC,kBAAA;IACnC,MAAMC,MAAM,GAAG,CAAA3B,QAAQ,aAARA,QAAQ,wBAAA0B,kBAAA,GAAR1B,QAAQ,CAAE4B,QAAQ,cAAAF,kBAAA,uBAAlBA,kBAAA,CAAoBG,OAAO,CAAEC,EAAE,IAAK;MAC/C,MAAMC,MAAM,GAAG9I,gBAAgB,CAAC6I,EAAE,CAAC;MACnC,OAAO,CACH;QAAElK,CAAC,EAAEmK,MAAM,CAAC/J,IAAI;QAAEH,CAAC,EAAEkK,MAAM,CAAC9J;MAAI,CAAC,EACjC;QAAEL,CAAC,EAAEmK,MAAM,CAAChI,KAAK;QAAElC,CAAC,EAAEkK,MAAM,CAAC9H;MAAO,CAAC,EACrC;QAAErC,CAAC,EAAEmK,MAAM,CAAC7H,OAAO;QAAErC,CAAC,EAAEkK,MAAM,CAAC5H;MAAQ,CAAC,EACxC;QAAEvC,CAAC,EAAEmK,MAAM,CAAC/J,IAAI;QAAEH,CAAC,EAAEkK,MAAM,CAAC5H;MAAQ,CAAC,EACrC;QAAEvC,CAAC,EAAEmK,MAAM,CAAChI,KAAK;QAAElC,CAAC,EAAEkK,MAAM,CAAC5H;MAAQ,CAAC,EACtC;QAAEvC,CAAC,EAAEmK,MAAM,CAAC7H,OAAO;QAAErC,CAAC,EAAEkK,MAAM,CAAC9J;MAAI,CAAC,EACpC;QAAEL,CAAC,EAAEmK,MAAM,CAAC7H,OAAO;QAAErC,CAAC,EAAEkK,MAAM,CAAC9H;MAAO,CAAC,CAC1C;IACL,CAAC,CAAC,KAAI,EAAE;IACR0H,MAAM,CAACK,IAAI,CACP;MAAEpK,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC,EACd;MAAED,CAAC,EAAEW,YAAY,CAACQ,KAAK;MAAElB,CAAC,EAAE;IAAE,CAAC,EAC/B;MAAED,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAEU,YAAY,CAACS;IAAO,CAAC,EAChC;MAAEpB,CAAC,EAAEW,YAAY,CAACQ,KAAK;MAAElB,CAAC,EAAEU,YAAY,CAACS;IAAO,CAAC,EACjD;MAAEpB,CAAC,EAAEW,YAAY,CAACQ,KAAK,GAAG,CAAC;MAAElB,CAAC,EAAEU,YAAY,CAACS,MAAM,GAAG;IAAE,CAC5D,CAAC;IACD,OAAO2I,MAAM;EACjB,CAAC,EAAE,CAAC3B,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAE4B,QAAQ,EAAErJ,YAAY,CAAC,CAAC;EAEtC,MAAM0J,oBAAoB,GAAGA,CAAClH,EAAE,EAAEmH,MAAM,EAAEC,MAAM,EAAEC,OAAO,KAAK;IAC1D,IAAID,MAAM,IAAIC,OAAO,EAAE;MACnB;MACAf,UAAU,CAAEgB,IAAI,IAAK,CAAC,GAAGA,IAAI,CAACC,KAAK,CAAC,CAAC,EAAEhB,YAAY,GAAG,CAAC,CAAC,EAAE;QAAEvG,EAAE;QAAEqH,OAAO;QAAEF;MAAO,CAAC,CAAC,CAAC;MACnFX,eAAe,CAAEc,IAAI,IAAKA,IAAI,GAAG,CAAC,CAAC;IACvC;IACA3H,gBAAgB,CAACK,EAAE,EAAEmH,MAAM,EAAEC,MAAM,CAAC;EACxC,CAAC;EAED,MAAMI,UAAU,GAAGA,CAAA,KAAM;IACrB,IAAIjB,YAAY,IAAI,CAAC,EAAE;MACnB,MAAM;QAAEvG,EAAE;QAAEqH;MAAQ,CAAC,GAAGhB,OAAO,CAACE,YAAY,CAAC;MAC7C5G,gBAAgB,CAACK,EAAE,EAAE;QAAE,CAACJ,QAAQ,GAAGyH;MAAQ,CAAC,EAAE,IAAI,CAAC;MACnDb,eAAe,CAAEc,IAAI,IAAKA,IAAI,GAAG,CAAC,CAAC;IACvC;EACJ,CAAC;EAED,MAAMG,UAAU,GAAGA,CAAA,KAAM;IACrB,IAAIlB,YAAY,GAAGF,OAAO,CAACqB,MAAM,GAAG,CAAC,EAAE;MACnC,MAAM;QAAE1H,EAAE;QAAEmH;MAAO,CAAC,GAAGd,OAAO,CAACE,YAAY,GAAG,CAAC,CAAC;MAChD5G,gBAAgB,CAACK,EAAE,EAAE;QAAE,CAACJ,QAAQ,GAAGuH;MAAO,CAAC,EAAE,IAAI,CAAC;MAClDX,eAAe,CAAEc,IAAI,IAAKA,IAAI,GAAG,CAAC,CAAC;IACvC;EACJ,CAAC;EAED9L,UAAU,CAAC,QAAQ,EAAEgM,UAAU,EAAE,CAACnB,OAAO,EAAEE,YAAY,CAAC,CAAC;EACzD/K,UAAU,CAAC,QAAQ,EAAEiM,UAAU,EAAE,CAACpB,OAAO,EAAEE,YAAY,CAAC,CAAC;EAEzD,MAAM,CAAC;IAAEoB,MAAM;IAAEC;EAAS,CAAC,EAAEC,IAAI,CAAC,GAAGvM,OAAO,CAAC,OAAO;IAChDwM,MAAM,EAAE,CAAC9L,SAAS,CAACC,OAAO,EAAED,SAAS,CAACE,gBAAgB,CAAC;IACvD6L,KAAK,EAAEA,CAACtH,IAAI,EAAEQ,OAAO,KAAK;MACtB,MAAMC,YAAY,GAAGD,OAAO,CAACE,eAAe,CAAC,CAAC;MAC9C,IAAI,CAACD,YAAY,IAAI,CAAC5E,SAAS,CAACI,OAAO,EAAE;MAEzC,MAAM0E,GAAG,GAAGjF,iBAAiB,CACzB+E,YAAY,CAACrE,CAAC,EACdqE,YAAY,CAACpE,CAAC,EACdR,SAAS,EACTC,SAAS,EACTD,SAAS,CAACI,OAAO,CAAC2E,UAAU,EAC5B/E,SAAS,CAACI,OAAO,CAAC4E,SACtB,CAAC;MACD,MAAME,OAAO,GAAGnE,UAAU,CAAC+D,GAAG,CAACvE,CAAC,EAAEuE,GAAG,CAACtE,CAAC,EAAEyI,QAAQ,GAAGjI,QAAQ,GAAG0K,QAAQ,EAAEzK,UAAU,EAAEC,YAAY,CAAC;MAElG,MAAMyK,aAAa,GAAG,EAAE;MACxB1K,UAAU,CAACK,OAAO,CAAEC,KAAK,IAAK;QAC1B,IAAIV,IAAI,CAACW,GAAG,CAAC0D,OAAO,CAAC3E,CAAC,GAAGgB,KAAK,CAAChB,CAAC,CAAC,GAAG,EAAE,EAAE;UACpCoL,aAAa,CAAChB,IAAI,CAAC;YAAEiB,QAAQ,EAAE,IAAI;YAAEpJ,QAAQ,EAAEjB,KAAK,CAAChB;UAAE,CAAC,CAAC;QAC7D;QACA,IAAIM,IAAI,CAACW,GAAG,CAAC0D,OAAO,CAAC1E,CAAC,GAAGe,KAAK,CAACf,CAAC,CAAC,GAAG,EAAE,EAAE;UACpCmL,aAAa,CAAChB,IAAI,CAAC;YAAEiB,QAAQ,EAAE,KAAK;YAAEpJ,QAAQ,EAAEjB,KAAK,CAACf;UAAE,CAAC,CAAC;QAC9D;MACJ,CAAC,CAAC;MACFoJ,aAAa,CAAC+B,aAAa,CAAC;IAChC,CAAC;IACDJ,IAAI,EAAEA,CAACpH,IAAI,EAAEQ,OAAO,KAAK;MACrB,MAAMC,YAAY,GAAGD,OAAO,CAACE,eAAe,CAAC,CAAC;MAC9C,IAAI,CAACD,YAAY,IAAI,CAAC5E,SAAS,CAACI,OAAO,EAAE;QACrCjB,KAAK,CAACmB,KAAK,CAAC,gCAAgC,CAAC;QAC7C;MACJ;MAEA,MAAMwE,GAAG,GAAGjF,iBAAiB,CACzB+E,YAAY,CAACrE,CAAC,EACdqE,YAAY,CAACpE,CAAC,EACdR,SAAS,EACTC,SAAS,EACTD,SAAS,CAACI,OAAO,CAAC2E,UAAU,EAC5B/E,SAAS,CAACI,OAAO,CAAC4E,SACtB,CAAC;MACD,MAAME,OAAO,GAAGnE,UAAU,CAAC+D,GAAG,CAACvE,CAAC,EAAEuE,GAAG,CAACtE,CAAC,EAAEyI,QAAQ,GAAGjI,QAAQ,GAAG0K,QAAQ,EAAEzK,UAAU,EAAEC,YAAY,CAAC;MAElG,IAAIiD,IAAI,CAAC0H,IAAI,EAAE;QACX;QACA9C,YAAY,CAAC;UACTrF,EAAE,EAAE,GAAGS,IAAI,CAACT,EAAE,IAAIoI,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;UAC9BpI,IAAI,EAAEQ,IAAI,CAAC0H,IAAI,CAAClI,IAAI;UACpBC,aAAa,EAAEO,IAAI,CAAC0H,IAAI,CAACjI,aAAa,IAAI,CAAC,CAAC;UAC5CpB,QAAQ,EAAE;YAAE,CAACc,QAAQ,GAAG4B,OAAO;YAAEzC,OAAO,EAAEyC,OAAO;YAAE8G,MAAM,EAAE9G,OAAO;YAAE+G,MAAM,EAAE/G;UAAQ,CAAC;UACrFvC,IAAI,EAAEwB,IAAI,CAAC0H,IAAI,CAAClJ,IAAI,IAAI;YAAEjB,KAAK,EAAE,GAAG;YAAEC,MAAM,EAAE;UAAG,CAAC;UAClDkC,MAAM,EAAEM,IAAI,CAAC0H,IAAI,CAAChI,MAAM,IAAI,CAAC;QACjC,CAAC,CAAC;QACF1E,KAAK,CAAC+M,OAAO,CAAC,kBAAkB,CAAC;MACrC,CAAC,MAAM,IAAI/H,IAAI,CAACT,EAAE,EAAE;QAAA,IAAAyI,qBAAA;QAChB;QACA,MAAMlH,YAAY,IAAAkH,qBAAA,GAAGxD,QAAQ,CAAC4B,QAAQ,CAAC6B,IAAI,CAAE3B,EAAE,IAAKA,EAAE,CAAC/G,EAAE,KAAKS,IAAI,CAACT,EAAE,CAAC,cAAAyI,qBAAA,uBAAjDA,qBAAA,CAAmD3J,QAAQ,CAACc,QAAQ,CAAC;QAC1FsH,oBAAoB,CAACzG,IAAI,CAACT,EAAE,EAAE;UAAE,CAACJ,QAAQ,GAAG4B;QAAQ,CAAC,EAAE,IAAI,EAAED,YAAY,CAAC;QAC1E9F,KAAK,CAAC+M,OAAO,CAAC,uBAAuB,CAAC;MAC1C;MACAtC,aAAa,CAAC,EAAE,CAAC;IACrB,CAAC;IACDzE,OAAO,EAAGR,OAAO,KAAM;MACnB0G,MAAM,EAAE,CAAC,CAAC1G,OAAO,CAAC0G,MAAM,CAAC,CAAC;MAC1BC,QAAQ,EAAE3G,OAAO,CAAC0H,OAAO,CAAC;IAC9B,CAAC;EACL,CAAC,CAAC,CAAC;EAEH,MAAMC,iBAAiB,GAAIjH,CAAC,IAAK;IAC7B,IAAIA,CAAC,CAACkH,MAAM,KAAKvM,SAAS,CAACI,OAAO,EAAE;MAChCgD,eAAe,CAAC,EAAE,CAAC;MACnB0G,cAAc,CAAC,IAAI,CAAC;IACxB;EACJ,CAAC;EAED,MAAMxD,iBAAiB,GAAGA,CAAC5C,EAAE,EAAElB,QAAQ,KAAK;IACxCsH,cAAc,CAAC;MAAEpG,EAAE;MAAElB;IAAS,CAAC,CAAC;EACpC,CAAC;EAED,MAAMgK,aAAa,GAAG3N,WAAW,CAC5BwG,CAAC,IAAK;IACH,IAAI,CAACuD,WAAW,CAACwC,MAAM,EAAE;IAEzB,MAAMqB,aAAa,GAAGpH,CAAC,CAACqH,QAAQ,GAAG,EAAE,GAAG,CAAC;IAEzC,QAAQrH,CAAC,CAACsH,GAAG;MACT,KAAK,SAAS;QACVtH,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBqC,WAAW,CAACtH,OAAO,CAAEoC,EAAE,IAAK;UACxB,MAAM7B,OAAO,GAAG8G,QAAQ,CAAC4B,QAAQ,CAAC6B,IAAI,CAAE3B,EAAE,IAAKA,EAAE,CAAC/G,EAAE,KAAKA,EAAE,CAAC;UAC5D,IAAI7B,OAAO,EAAE;YACT,MAAM+K,UAAU,GAAG/K,OAAO,CAACW,QAAQ,CAACc,QAAQ,CAAC,IAAI;cAAE/C,CAAC,EAAE,CAAC;cAAEC,CAAC,EAAE;YAAE,CAAC;YAC/D,MAAMuK,OAAO,GAAG6B,UAAU;YAC1B,MAAMC,IAAI,GAAGhM,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE8L,UAAU,CAACpM,CAAC,GAAGiM,aAAa,CAAC;YACtD7B,oBAAoB,CAAClH,EAAE,EAAE;cAAE,CAACJ,QAAQ,GAAG;gBAAE/C,CAAC,EAAEqM,UAAU,CAACrM,CAAC;gBAAEC,CAAC,EAAEqM;cAAK;YAAE,CAAC,EAAE,IAAI,EAAE9B,OAAO,CAAC;UACzF;QACJ,CAAC,CAAC;QACF;MACJ,KAAK,WAAW;QACZ1F,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBqC,WAAW,CAACtH,OAAO,CAAEoC,EAAE,IAAK;UACxB,MAAM7B,OAAO,GAAG8G,QAAQ,CAAC4B,QAAQ,CAAC6B,IAAI,CAAE3B,EAAE,IAAKA,EAAE,CAAC/G,EAAE,KAAKA,EAAE,CAAC;UAC5D,IAAI7B,OAAO,EAAE;YACT,MAAM+K,UAAU,GAAG/K,OAAO,CAACW,QAAQ,CAACc,QAAQ,CAAC,IAAI;cAAE/C,CAAC,EAAE,CAAC;cAAEC,CAAC,EAAE;YAAE,CAAC;YAC/D,MAAMuK,OAAO,GAAG6B,UAAU;YAC1B,MAAMC,IAAI,GAAGhM,IAAI,CAACY,GAAG,CAACP,YAAY,CAACS,MAAM,GAAGE,OAAO,CAACc,IAAI,CAAChB,MAAM,EAAEiL,UAAU,CAACpM,CAAC,GAAGiM,aAAa,CAAC;YAC9F7B,oBAAoB,CAAClH,EAAE,EAAE;cAAE,CAACJ,QAAQ,GAAG;gBAAE/C,CAAC,EAAEqM,UAAU,CAACrM,CAAC;gBAAEC,CAAC,EAAEqM;cAAK;YAAE,CAAC,EAAE,IAAI,EAAE9B,OAAO,CAAC;UACzF;QACJ,CAAC,CAAC;QACF;MACJ,KAAK,WAAW;QACZ1F,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBqC,WAAW,CAACtH,OAAO,CAAEoC,EAAE,IAAK;UACxB,MAAM7B,OAAO,GAAG8G,QAAQ,CAAC4B,QAAQ,CAAC6B,IAAI,CAAE3B,EAAE,IAAKA,EAAE,CAAC/G,EAAE,KAAKA,EAAE,CAAC;UAC5D,IAAI7B,OAAO,EAAE;YACT,MAAM+K,UAAU,GAAG/K,OAAO,CAACW,QAAQ,CAACc,QAAQ,CAAC,IAAI;cAAE/C,CAAC,EAAE,CAAC;cAAEC,CAAC,EAAE;YAAE,CAAC;YAC/D,MAAMuK,OAAO,GAAG6B,UAAU;YAC1B,MAAME,IAAI,GAAGjM,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE8L,UAAU,CAACrM,CAAC,GAAGkM,aAAa,CAAC;YACtD7B,oBAAoB,CAAClH,EAAE,EAAE;cAAE,CAACJ,QAAQ,GAAG;gBAAE/C,CAAC,EAAEuM,IAAI;gBAAEtM,CAAC,EAAEoM,UAAU,CAACpM;cAAE;YAAE,CAAC,EAAE,IAAI,EAAEuK,OAAO,CAAC;UACzF;QACJ,CAAC,CAAC;QACF;MACJ,KAAK,YAAY;QACb1F,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBqC,WAAW,CAACtH,OAAO,CAAEoC,EAAE,IAAK;UACxB,MAAM7B,OAAO,GAAG8G,QAAQ,CAAC4B,QAAQ,CAAC6B,IAAI,CAAE3B,EAAE,IAAKA,EAAE,CAAC/G,EAAE,KAAKA,EAAE,CAAC;UAC5D,IAAI7B,OAAO,EAAE;YACT,MAAM+K,UAAU,GAAG/K,OAAO,CAACW,QAAQ,CAACc,QAAQ,CAAC,IAAI;cAAE/C,CAAC,EAAE,CAAC;cAAEC,CAAC,EAAE;YAAE,CAAC;YAC/D,MAAMuK,OAAO,GAAG6B,UAAU;YAC1B,MAAME,IAAI,GAAGjM,IAAI,CAACY,GAAG,CAACP,YAAY,CAACQ,KAAK,GAAGG,OAAO,CAACc,IAAI,CAACjB,KAAK,EAAEkL,UAAU,CAACrM,CAAC,GAAGkM,aAAa,CAAC;YAC5F7B,oBAAoB,CAAClH,EAAE,EAAE;cAAE,CAACJ,QAAQ,GAAG;gBAAE/C,CAAC,EAAEuM,IAAI;gBAAEtM,CAAC,EAAEoM,UAAU,CAACpM;cAAE;YAAE,CAAC,EAAE,IAAI,EAAEuK,OAAO,CAAC;UACzF;QACJ,CAAC,CAAC;QACF;MACJ,KAAK,QAAQ;MACb,KAAK,WAAW;QACZ1F,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBqC,WAAW,CAACtH,OAAO,CAAEoC,EAAE,IAAKoF,eAAe,CAACpF,EAAE,CAAC,CAAC;QAChD;MACJ,KAAK,QAAQ;QACT2B,CAAC,CAACkB,cAAc,CAAC,CAAC;QAClBnD,eAAe,CAAC,EAAE,CAAC;QACnB0G,cAAc,CAAC,IAAI,CAAC;QACpB;IACR;EACJ,CAAC,EACD,CAAClB,WAAW,EAAEgC,oBAAoB,EAAE9B,eAAe,EAAE1F,eAAe,EAAEE,QAAQ,EAAEqF,QAAQ,CAAC4B,QAAQ,EAAErJ,YAAY,CACnH,CAAC;EAEDhC,UAAU,CAAC,QAAQ,EAAGmG,CAAC,IAAK;IACxBA,CAAC,CAACkB,cAAc,CAAC,CAAC;IAClBnD,eAAe,CAACuF,QAAQ,CAAC4B,QAAQ,CAACwC,GAAG,CAAEtC,EAAE,IAAKA,EAAE,CAAC/G,EAAE,CAAC,CAAC;EACzD,CAAC,EAAE,CAACiF,QAAQ,CAAC4B,QAAQ,EAAEnH,eAAe,CAAC,CAAC;EAExClE,UAAU,CAAC,QAAQ,EAAGmG,CAAC,IAAK;IACxBA,CAAC,CAACkB,cAAc,CAAC,CAAC;IAClB,IAAIqC,WAAW,CAACwC,MAAM,GAAG,CAAC,EAAE;MACxBpC,eAAe,CAACJ,WAAW,CAAC;IAChC;EACJ,CAAC,EAAE,CAACA,WAAW,EAAEI,eAAe,CAAC,CAAC;EAElC,oBACIvJ,OAAA;IAAKiH,SAAS,EAAC,oBAAoB;IAACsG,SAAS,EAAER,aAAc;IAACS,QAAQ,EAAE,CAAE;IAACtH,KAAK,EAAE;MAAEuH,OAAO,EAAE;IAAO,CAAE;IAAAlG,QAAA,eAClGvH,OAAA;MACI+G,GAAG,EAAGC,IAAI,IAAK;QACXzG,SAAS,CAACI,OAAO,GAAGqG,IAAI;QACxB8E,IAAI,CAAC9E,IAAI,CAAC;MACd,CAAE;MACFC,SAAS,EAAE,cAAcpD,QAAQ,KAAK,QAAQ,GAAG,mBAAmB,GAAGA,QAAQ,KAAK,QAAQ,GAAG,mBAAmB,GAAG,EAAE,EAAG;MAC1HqC,KAAK,EAAE;QACHnD,QAAQ,EAAE,UAAU;QACpBd,KAAK,EAAER,YAAY,CAACQ,KAAK;QACzBC,MAAM,EAAET,YAAY,CAACS,MAAM;QAC3BwL,SAAS,EAAE,OAAO;QAClBvF,UAAU,EAAE,CAAAe,QAAQ,aAARA,QAAQ,wBAAAS,iBAAA,GAART,QAAQ,CAAEwB,MAAM,cAAAf,iBAAA,uBAAhBA,iBAAA,CAAkBxB,UAAU,KAAI,SAAS;QACrDwF,SAAS,EAAE,SAASnN,SAAS,GAAG,GAAG,GAAG;QACtCoN,eAAe,EAAE,UAAU;QAC3BxG,MAAM,EAAEwE,MAAM,GAAG,MAAM,GAAG;MAC9B,CAAE;MACFiC,OAAO,EAAEhB,iBAAkB;MAAAtF,QAAA,gBAE3BvH,OAAA,CAACJ,MAAM;QAACkO,WAAW,EAAErM,YAAY,CAACQ,KAAM;QAAC8L,YAAY,EAAEtM,YAAY,CAACS,MAAO;QAAC1B,SAAS,EAAEA;MAAU;QAAAqH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACpGhI,OAAA,CAACL,UAAU;QAACuK,UAAU,EAAEA,UAAW;QAAC1J,SAAS,EAAEA;MAAU;QAAAqH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,EAC3DwB,QAAQ,iBACLxJ,OAAA;QACIiH,SAAS,EAAC,iBAAiB;QAC3Bf,KAAK,EAAE;UACHnD,QAAQ,EAAE,UAAU;UACpB5B,GAAG,EAAE,CAAC;UACND,IAAI,EAAE,CAAC;UACP+B,KAAK,EAAE,CAAC;UACRE,MAAM,EAAE,CAAC;UACT6K,eAAe,EAAE;AACjD;AACA;AACA,iCAAiC;UACDC,cAAc,EAAE,GAAG1M,QAAQ,MAAMA,QAAQ,IAAI;UAC7CiH,aAAa,EAAE,MAAM;UACrBnB,OAAO,EAAE;QACb;MAAE;QAAAQ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CACJ,EACAkB,QAAQ,aAARA,QAAQ,wBAAAU,mBAAA,GAARV,QAAQ,CAAE4B,QAAQ,cAAAlB,mBAAA,uBAAlBA,mBAAA,CAAoB0D,GAAG,CAAElL,OAAO,iBAC7BpC,OAAA,CAACsD,OAAO;QAEJlB,OAAO,EAAEA,OAAQ;QACjBsB,UAAU,EAAEyF,WAAW,CAAC+E,QAAQ,CAAC9L,OAAO,CAAC6B,EAAE,CAAE;QAC7CN,eAAe,EAAEA,eAAgB;QACjCC,gBAAgB,EAAEuH,oBAAqB,CAAC;QAAA;QACxCtH,QAAQ,EAAEA,QAAS;QACnBrD,SAAS,EAAEA,SAAU;QACrBe,QAAQ,EAAEiI,QAAQ,GAAGjI,QAAQ,GAAG0K,QAAS;QACzCnI,aAAa,EAAE+C,iBAAkB;QACjCtG,SAAS,EAAEA,SAAU;QACrBiB,UAAU,EAAEA,UAAW;QACvBC,YAAY,EAAEA;MAAa,GAXtBW,OAAO,CAAC6B,EAAE;QAAA4D,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAYlB,CACJ,CAAC,EAED4D,MAAM,KAAIC,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEO,IAAI,kBACrBpM,OAAA;QACIkG,KAAK,EAAE;UACHnD,QAAQ,EAAE,UAAU;UACpB7B,IAAI,EAAE,GAAG,EAAA2I,gBAAA,GAAAgC,QAAQ,CAAC7G,MAAM,cAAA6E,gBAAA,uBAAfA,gBAAA,CAAiB/I,CAAC,KAAI,CAAC,IAAI;UAAE;UACtCK,GAAG,EAAE,GAAG,EAAA2I,iBAAA,GAAA+B,QAAQ,CAAC7G,MAAM,cAAA8E,iBAAA,uBAAfA,iBAAA,CAAiB/I,CAAC,KAAI,CAAC,IAAI;UACnCkB,KAAK,EAAE,EAAA8H,mBAAA,GAAA8B,QAAQ,CAACO,IAAI,CAAClJ,IAAI,cAAA6G,mBAAA,uBAAlBA,mBAAA,CAAoB9H,KAAK,KAAI,GAAG;UACvCC,MAAM,EAAE,EAAA8H,oBAAA,GAAA6B,QAAQ,CAACO,IAAI,CAAClJ,IAAI,cAAA8G,oBAAA,uBAAlBA,oBAAA,CAAoB9H,MAAM,KAAI,EAAE;UACxCiG,UAAU,EAAE,MAAM;UAClBd,OAAO,EAAE,GAAG;UACZmB,aAAa,EAAE,MAAM;UACrBtB,MAAM,EAAE;QACZ;MAAE;QAAAW,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CACJ,eACDhI,OAAA,CAACH,gBAAgB;QACbsO,gBAAgB,EAAE,CAAAjF,QAAQ,aAARA,QAAQ,wBAAAe,mBAAA,GAARf,QAAQ,CAAE4B,QAAQ,cAAAb,mBAAA,uBAAlBA,mBAAA,CAAoBmE,MAAM,CAAEpD,EAAE,IAAK7B,WAAW,CAAC+E,QAAQ,CAAClD,EAAE,CAAC/G,EAAE,CAAC,CAAC,KAAI,EAAG;QACxFoK,QAAQ,EAAEjF,YAAa;QACvB5I,SAAS,EAAEA;MAAU;QAAAqH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxB,CAAC,EACDoC,WAAW,iBACRpK,OAAA;QACIiH,SAAS,EAAC,kBAAkB;QAC5Bf,KAAK,EAAE;UACHnD,QAAQ,EAAE,OAAO;UACjB7B,IAAI,EAAEkJ,WAAW,CAACrH,QAAQ,CAACjC,CAAC;UAC5BK,GAAG,EAAEiJ,WAAW,CAACrH,QAAQ,CAAChC,CAAC;UAC3BoH,UAAU,EAAE,OAAO;UACnBC,MAAM,EAAE,gBAAgB;UACxBF,YAAY,EAAE,KAAK;UACnBoG,SAAS,EAAE,4BAA4B;UACvCpH,MAAM,EAAE;QACZ,CAAE;QACF2G,OAAO,EAAEA,CAAA,KAAMxD,cAAc,CAAC,IAAI,CAAE;QAAA9C,QAAA,gBAEpCvH,OAAA;UACIiH,SAAS,EAAC,uBAAuB;UACjCf,KAAK,EAAE;YAAE+B,OAAO,EAAE,UAAU;YAAEb,MAAM,EAAE,SAAS;YAAEmH,YAAY,EAAE;UAAiB,CAAE;UAClFV,OAAO,EAAEA,CAAA,KAAM;YACXxE,eAAe,CAACe,WAAW,CAACnG,EAAE,CAAC;YAC/BoG,cAAc,CAAC,IAAI,CAAC;UACxB,CAAE;UAAA9C,QAAA,EACL;QAED;UAAAM,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,eACNhI,OAAA;UACIiH,SAAS,EAAC,uBAAuB;UACjCf,KAAK,EAAE;YAAE+B,OAAO,EAAE,UAAU;YAAEb,MAAM,EAAE;UAAU,CAAE;UAClDyG,OAAO,EAAEA,CAAA,KAAM;YACXtE,eAAe,CAAC,CAACa,WAAW,CAACnG,EAAE,CAAC,CAAC;YACjCoG,cAAc,CAAC,IAAI,CAAC;UACxB,CAAE;UAAA9C,QAAA,EACL;QAED;UAAAM,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CACR;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEd,CAAC;EAAA,QA3RGvI,UAAU,EACVA,UAAU,EAE2BF,OAAO,EAsJ5CE,UAAU,EAKVA,UAAU;AAAA,EA8HlB,CAAC;EAAA,QA5ROA,UAAU,EACVA,UAAU,EAE2BF,OAAO,EAsJ5CE,UAAU,EAKVA,UAAU;AAAA,EA8HjB;AAAC+O,GAAA,GAtWIzF,MAAM;AAwWZ,eAAeA,MAAM;AAAC,IAAAtF,EAAA,EAAAqF,GAAA,EAAAG,GAAA,EAAAuF,GAAA;AAAAC,YAAA,CAAAhL,EAAA;AAAAgL,YAAA,CAAA3F,GAAA;AAAA2F,YAAA,CAAAxF,GAAA;AAAAwF,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}