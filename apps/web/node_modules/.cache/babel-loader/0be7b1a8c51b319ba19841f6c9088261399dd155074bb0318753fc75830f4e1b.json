{"ast":null,"code":"// ==================== FIX #1: Render Element v·ªõi ID ch√≠nh x√°c ====================\n\n/**\r\n * Render m·ªôt element th√†nh HTML v·ªõi proper ID v√† event binding\r\n */\nconst renderElementHTML = (element, isChild = false) => {\n  var _position$desktop, _position$desktop2, _componentData$icon;\n  const {\n    id,\n    type,\n    componentData = {},\n    styles = {},\n    size = {},\n    position = {},\n    children = []\n  } = element;\n\n  // Convert styles object to inline CSS\n  const inlineStyles = Object.entries(styles).filter(([key]) => !key.startsWith(':') && !key.startsWith('@')).map(([key, value]) => {\n    const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\n    return `${kebabKey}:${value}`;\n  }).join(';');\n\n  // Base attributes - CRITICAL: Lu√¥n c√≥ id v√† data-element-id\n  const baseAttrs = `\n        id=\"${id}\"\n        data-element-id=\"${id}\"\n        data-type=\"${type}\"\n        class=\"lpb-element lpb-${type}\"\n    `.trim();\n\n  // Position styles cho child elements\n  const positionStyles = isChild ? `\n        position: absolute;\n        left: ${((_position$desktop = position.desktop) === null || _position$desktop === void 0 ? void 0 : _position$desktop.x) || 0}px;\n        top: ${((_position$desktop2 = position.desktop) === null || _position$desktop2 === void 0 ? void 0 : _position$desktop2.y) || 0}px;\n        width: ${size.width || 200}px;\n        height: ${size.height || 50}px;\n    ` : '';\n\n  // Render based on type\n  switch (type) {\n    case 'section':\n      return renderSectionHTML(element);\n    case 'button':\n      return `\n                <button \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Button'}\n                </button>\n            `;\n    case 'heading':\n      const HeadingTag = componentData.level || 'h2';\n      return `\n                <${HeadingTag} \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Heading'}\n                </${HeadingTag}>\n            `;\n    case 'paragraph':\n      return `\n                <p \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || 'Paragraph'}\n                </p>\n            `;\n    case 'image':\n      // FIX: Th√™m baseAttrs v√†o img tag\n      return `\n                <img \n                    ${baseAttrs}\n                    src=\"${componentData.src || componentData.imageUrl || 'https://via.placeholder.com/150'}\"\n                    alt=\"${componentData.alt || 'Image'}\"\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                />\n            `;\n    case 'icon':\n      // FIX: ƒê·∫£m b·∫£o div wrapper c√≥ baseAttrs\n      const isSvg = (_componentData$icon = componentData.icon) === null || _componentData$icon === void 0 ? void 0 : _componentData$icon.startsWith('<svg');\n      return `\n                <div \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                    title=\"${componentData.title || ''}\"\n                >\n                    ${componentData.imageUrl ? `<img src=\"${componentData.imageUrl}\" alt=\"${componentData.title || 'Icon'}\" style=\"width:100%;height:100%;object-fit:contain;\" />` : isSvg ? componentData.icon : componentData.icon ? `<i class=\"${componentData.icon}\"></i>` : 'üì¶'}\n                </div>\n            `;\n    case 'gallery':\n      return renderGalleryHTML(element, isChild);\n    default:\n      return `\n                <div \n                    ${baseAttrs}\n                    style=\"${inlineStyles}; ${positionStyles}\"\n                >\n                    ${componentData.content || type}\n                </div>\n            `;\n  }\n};\n\n// ==================== FIX #2: Extract Events ƒê√öNG c√°ch ====================\n\n/**\r\n * Extract t·∫•t c·∫£ events t·ª´ pageData elements (FIXED VERSION)\r\n */\nconst extractEvents = pageData => {\n  const events = [];\n  const processedIds = new Set(); // Tr√°nh duplicate\n\n  const processElement = (element, parentId = null) => {\n    var _element$componentDat;\n    const elementId = element.id;\n\n    // Skip n·∫øu ƒë√£ x·ª≠ l√Ω\n    if (processedIds.has(elementId)) {\n      console.warn(`[extractEvents] Duplicate ID detected: ${elementId}`);\n      return;\n    }\n\n    // Check element events\n    if ((_element$componentDat = element.componentData) !== null && _element$componentDat !== void 0 && _element$componentDat.events) {\n      const hasValidEvent = Object.values(element.componentData.events).some(event => event && event.type && event.type !== 'none');\n      if (hasValidEvent) {\n        events.push({\n          elementId: elementId,\n          events: element.componentData.events,\n          type: element.type,\n          parentId: parentId\n        });\n        processedIds.add(elementId);\n        console.log(`[extractEvents] Added event for: ${elementId}`, element.componentData.events);\n      }\n    }\n\n    // Check children events recursively\n    if (Array.isArray(element.children)) {\n      element.children.forEach(child => {\n        processElement(child, elementId); // Pass current element as parent\n      });\n    }\n  };\n  pageData.elements.forEach(element => {\n    processElement(element, null);\n  });\n  console.log(`[extractEvents] Total events extracted: ${events.length}`);\n  return events;\n};\n\n// ==================== FIX #3: Runtime Script v·ªõi Debug Mode ====================\n\n/**\r\n * Generate runtime script v·ªõi debug logging\r\n */\nconst generateEventRuntime = (events, popups) => {\n  return `\n    // Landing Page Builder Runtime v1.1 (Fixed Event Binding)\n    (function() {\n        'use strict';\n        \n        window.LPB = window.LPB || {};\n        \n        // Debug mode\n        const DEBUG = true;\n        const log = (...args) => DEBUG && console.log('[LPB]', ...args);\n        \n        // ========== POPUP MANAGER ==========\n        LPB.popups = {\n            active: new Set(),\n            \n            open: function(popupId, data) {\n                log('Opening popup:', popupId);\n                const popup = document.getElementById(popupId);\n                if (!popup) {\n                    console.error('[LPB] Popup not found:', popupId);\n                    return;\n                }\n                \n                // Update content n·∫øu c√≥ data\n                if (data && data.html) {\n                    const content = popup.querySelector('.lpb-popup-body');\n                    if (content) content.innerHTML = data.html;\n                }\n                \n                // Show popup\n                popup.classList.add('lpb-popup-active');\n                document.body.style.overflow = 'hidden';\n                this.active.add(popupId);\n                \n                log('Popup opened successfully:', popupId);\n                \n                // Analytics tracking\n                if (window.gtag) {\n                    gtag('event', 'popup_open', {\n                        event_category: 'Engagement',\n                        event_label: popupId\n                    });\n                }\n            },\n            \n            close: function(popupId) {\n                log('Closing popup:', popupId);\n                const popup = document.getElementById(popupId);\n                if (popup) {\n                    popup.classList.remove('lpb-popup-active');\n                    this.active.delete(popupId);\n                    \n                    // Restore scroll n·∫øu kh√¥ng c√≤n popup n√†o\n                    if (this.active.size === 0) {\n                        document.body.style.overflow = '';\n                    }\n                    log('Popup closed:', popupId);\n                }\n            },\n            \n            closeAll: function() {\n                log('Closing all popups');\n                this.active.forEach(id => this.close(id));\n            }\n        };\n        \n        // ========== API MANAGER ==========\n        LPB.api = {\n            cache: new Map(),\n            \n            getCacheKey: function(endpoint, params) {\n                return endpoint + JSON.stringify(params || {});\n            },\n            \n            fetch: async function(endpoint, options = {}) {\n                const cacheKey = this.getCacheKey(endpoint, options.params);\n                \n                // Check cache\n                if (this.cache.has(cacheKey)) {\n                    const cached = this.cache.get(cacheKey);\n                    const now = Date.now();\n                    const TTL = options.ttl || 5 * 60 * 1000;\n                    \n                    if (now - cached.timestamp < TTL) {\n                        log('Cache hit:', endpoint);\n                        return cached.data;\n                    }\n                }\n                \n                // Fetch m·ªõi\n                try {\n                    log('Fetching:', endpoint);\n                    const response = await fetch(endpoint, {\n                        method: options.method || 'GET',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            ...options.headers\n                        },\n                        body: options.data ? JSON.stringify(options.data) : undefined\n                    });\n                    \n                    if (!response.ok) {\n                        throw new Error(\\`HTTP \\${response.status}: \\${response.statusText}\\`);\n                    }\n                    \n                    const data = await response.json();\n                    \n                    // Cache result\n                    this.cache.set(cacheKey, {\n                        data: data,\n                        timestamp: Date.now()\n                    });\n                    \n                    return data;\n                } catch (error) {\n                    console.error('[LPB] API Error:', error);\n                    throw error;\n                }\n            },\n            \n            clearCache: function(endpoint) {\n                if (endpoint) {\n                    for (let key of this.cache.keys()) {\n                        if (key.startsWith(endpoint)) {\n                            this.cache.delete(key);\n                        }\n                    }\n                } else {\n                    this.cache.clear();\n                }\n            }\n        };\n        \n        // ========== EVENT HANDLER ==========\n        LPB.handleEvent = async function(config) {\n            const { type } = config;\n            log('Handling event:', type, config);\n            \n            try {\n                switch(type) {\n                    case 'openPopup':\n                        if (!config.popupId) {\n                            console.error('[LPB] Missing popupId');\n                            return;\n                        }\n                        this.popups.open(config.popupId, config.data);\n                        break;\n                        \n                    case 'closePopup':\n                        const targetPopupId = config.popupId || config.elementId;\n                        if (!targetPopupId) {\n                            console.error('[LPB] Missing popupId');\n                            return;\n                        }\n                        this.popups.close(targetPopupId);\n                        break;\n                        \n                    case 'triggerApi':\n                        if (!config.apiUrl) {\n                            console.error('[LPB] Missing apiUrl');\n                            return;\n                        }\n                        const data = await this.api.fetch(config.apiUrl, {\n                            method: config.method || 'GET',\n                            params: config.params,\n                            data: config.data\n                        });\n                        \n                        // Update target n·∫øu c√≥\n                        if (config.updateTarget) {\n                            const target = document.getElementById(config.updateTarget);\n                            if (target && data.html) {\n                                target.innerHTML = data.html;\n                            }\n                        }\n                        break;\n                        \n                    case 'both':\n                        // Open popup immediately v·ªõi loading\n                        this.popups.open(config.popupId, { \n                            html: '<div style=\"text-align:center;padding:40px;\"><div class=\"lpb-spinner\"></div><p>ƒêang t·∫£i...</p></div>' \n                        });\n                        \n                        // Fetch API in background\n                        const apiData = await this.api.fetch(config.apiUrl, {\n                            method: config.method || 'GET',\n                            params: config.params\n                        });\n                        \n                        // Update popup content\n                        this.popups.open(config.popupId, { html: apiData.html || JSON.stringify(apiData) });\n                        break;\n                        \n                    case 'navigate':\n                        if (!config.url) {\n                            console.error('[LPB] Missing url');\n                            return;\n                        }\n                        if (config.newTab) {\n                            window.open(config.url, '_blank');\n                        } else {\n                            window.location.href = config.url;\n                        }\n                        break;\n                        \n                    case 'scrollToSection':\n                        if (!config.sectionId) {\n                            console.error('[LPB] Missing sectionId');\n                            return;\n                        }\n                        const section = document.querySelector(\\`[data-element-id=\"\\${config.sectionId}\"]\\`);\n                        if (section) {\n                            section.scrollIntoView({ \n                                behavior: config.smooth !== false ? 'smooth' : 'auto',\n                                block: 'start'\n                            });\n                        } else {\n                            console.error('[LPB] Section not found:', config.sectionId);\n                        }\n                        break;\n                        \n                    case 'submitForm':\n                        if (!config.apiUrl) {\n                            console.error('[LPB] Missing apiUrl');\n                            return;\n                        }\n                        log('Form submit to:', config.apiUrl);\n                        break;\n                        \n                    default:\n                        console.warn('[LPB] Unknown event type:', type);\n                }\n            } catch (error) {\n                console.error('[LPB] Event handling error:', error);\n                alert('C√≥ l·ªói x·∫£y ra: ' + error.message);\n            }\n        };\n        \n        // ========== AUTO-BIND EVENTS (FIXED) ==========\n        const eventsConfig = ${JSON.stringify(events, null, 2)};\n        \n        document.addEventListener('DOMContentLoaded', function() {\n            log('Initializing events...', eventsConfig.length, 'configs found');\n            \n            let boundCount = 0;\n            let notFoundCount = 0;\n            \n            eventsConfig.forEach((config, index) => {\n                log(\\`Processing config #\\${index + 1}:\\`, config);\n                \n                const element = document.getElementById(config.elementId);\n                if (!element) {\n                    console.warn('[LPB] Element not found:', config.elementId);\n                    notFoundCount++;\n                    return;\n                }\n                \n                log('Found element:', config.elementId, element);\n                \n                // Bind onClick\n                if (config.events.onClick && config.events.onClick.type !== 'none') {\n                    element.addEventListener('click', function(e) {\n                        log('Click detected on:', config.elementId);\n                        e.preventDefault();\n                        e.stopPropagation();\n                        LPB.handleEvent(config.events.onClick);\n                    });\n                    \n                    element.style.cursor = 'pointer';\n                    boundCount++;\n                    log('Bound onClick to:', config.elementId);\n                }\n                \n                // Bind hover prefetch\n                if (config.events.onClick?.params?.apiConfig?.preload) {\n                    element.addEventListener('mouseenter', function() {\n                        LPB.api.fetch(\n                            config.events.onClick.params.apiConfig.endpoint,\n                            config.events.onClick.params.apiConfig\n                        ).catch(() => {}); // Silent prefetch\n                    }, { once: true });\n                }\n                \n                // Bind onHover effects\n                if (config.events.onHover) {\n                    const hoverClass = config.events.onHover.className;\n                    if (hoverClass) {\n                        element.addEventListener('mouseenter', function() {\n                            this.classList.add(hoverClass);\n                        });\n                        element.addEventListener('mouseleave', function() {\n                            this.classList.remove(hoverClass);\n                        });\n                    }\n                }\n            });\n            \n            log(\\`Events initialized! Bound: \\${boundCount}, Not Found: \\${notFoundCount}\\`);\n            \n            // Final validation\n            if (notFoundCount > 0) {\n                console.warn(\\`[LPB] \\${notFoundCount} elements not found in DOM. Check your HTML structure.\\`);\n            }\n        });\n        \n        // ========== ESC TO CLOSE POPUP ==========\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                LPB.popups.closeAll();\n            }\n        });\n        \n        log('Runtime loaded successfully');\n    })();\n    `;\n};\n\n// ==================== EXPORT FUNCTIONS ====================\n\nexport { renderElementHTML, extractEvents, generateEventRuntime };","map":{"version":3,"names":["renderElementHTML","element","isChild","_position$desktop","_position$desktop2","_componentData$icon","id","type","componentData","styles","size","position","children","inlineStyles","Object","entries","filter","key","startsWith","map","value","kebabKey","replace","m","toLowerCase","join","baseAttrs","trim","positionStyles","desktop","x","y","width","height","renderSectionHTML","content","HeadingTag","level","src","imageUrl","alt","isSvg","icon","title","renderGalleryHTML","extractEvents","pageData","events","processedIds","Set","processElement","parentId","_element$componentDat","elementId","has","console","warn","hasValidEvent","values","some","event","push","add","log","Array","isArray","forEach","child","elements","length","generateEventRuntime","popups","JSON","stringify"],"sources":["F:/landinghub-iconic/apps/web/src/utils/pageUtils.js"],"sourcesContent":["// ==================== FIX #1: Render Element v·ªõi ID ch√≠nh x√°c ====================\r\n\r\n/**\r\n * Render m·ªôt element th√†nh HTML v·ªõi proper ID v√† event binding\r\n */\r\nconst renderElementHTML = (element, isChild = false) => {\r\n    const { id, type, componentData = {}, styles = {}, size = {}, position = {}, children = [] } = element;\r\n\r\n    // Convert styles object to inline CSS\r\n    const inlineStyles = Object.entries(styles)\r\n        .filter(([key]) => !key.startsWith(':') && !key.startsWith('@'))\r\n        .map(([key, value]) => {\r\n            const kebabKey = key.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`);\r\n            return `${kebabKey}:${value}`;\r\n        })\r\n        .join(';');\r\n\r\n    // Base attributes - CRITICAL: Lu√¥n c√≥ id v√† data-element-id\r\n    const baseAttrs = `\r\n        id=\"${id}\"\r\n        data-element-id=\"${id}\"\r\n        data-type=\"${type}\"\r\n        class=\"lpb-element lpb-${type}\"\r\n    `.trim();\r\n\r\n    // Position styles cho child elements\r\n    const positionStyles = isChild ? `\r\n        position: absolute;\r\n        left: ${position.desktop?.x || 0}px;\r\n        top: ${position.desktop?.y || 0}px;\r\n        width: ${size.width || 200}px;\r\n        height: ${size.height || 50}px;\r\n    ` : '';\r\n\r\n    // Render based on type\r\n    switch(type) {\r\n        case 'section':\r\n            return renderSectionHTML(element);\r\n\r\n        case 'button':\r\n            return `\r\n                <button \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Button'}\r\n                </button>\r\n            `;\r\n\r\n        case 'heading':\r\n            const HeadingTag = componentData.level || 'h2';\r\n            return `\r\n                <${HeadingTag} \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Heading'}\r\n                </${HeadingTag}>\r\n            `;\r\n\r\n        case 'paragraph':\r\n            return `\r\n                <p \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || 'Paragraph'}\r\n                </p>\r\n            `;\r\n\r\n        case 'image':\r\n            // FIX: Th√™m baseAttrs v√†o img tag\r\n            return `\r\n                <img \r\n                    ${baseAttrs}\r\n                    src=\"${componentData.src || componentData.imageUrl || 'https://via.placeholder.com/150'}\"\r\n                    alt=\"${componentData.alt || 'Image'}\"\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                />\r\n            `;\r\n\r\n        case 'icon':\r\n            // FIX: ƒê·∫£m b·∫£o div wrapper c√≥ baseAttrs\r\n            const isSvg = componentData.icon?.startsWith('<svg');\r\n            return `\r\n                <div \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                    title=\"${componentData.title || ''}\"\r\n                >\r\n                    ${componentData.imageUrl\r\n                ? `<img src=\"${componentData.imageUrl}\" alt=\"${componentData.title || 'Icon'}\" style=\"width:100%;height:100%;object-fit:contain;\" />`\r\n                : isSvg\r\n                    ? componentData.icon\r\n                    : componentData.icon\r\n                        ? `<i class=\"${componentData.icon}\"></i>`\r\n                        : 'üì¶'\r\n            }\r\n                </div>\r\n            `;\r\n\r\n        case 'gallery':\r\n            return renderGalleryHTML(element, isChild);\r\n\r\n        default:\r\n            return `\r\n                <div \r\n                    ${baseAttrs}\r\n                    style=\"${inlineStyles}; ${positionStyles}\"\r\n                >\r\n                    ${componentData.content || type}\r\n                </div>\r\n            `;\r\n    }\r\n};\r\n\r\n// ==================== FIX #2: Extract Events ƒê√öNG c√°ch ====================\r\n\r\n/**\r\n * Extract t·∫•t c·∫£ events t·ª´ pageData elements (FIXED VERSION)\r\n */\r\nconst extractEvents = (pageData) => {\r\n    const events = [];\r\n    const processedIds = new Set(); // Tr√°nh duplicate\r\n\r\n    const processElement = (element, parentId = null) => {\r\n        const elementId = element.id;\r\n\r\n        // Skip n·∫øu ƒë√£ x·ª≠ l√Ω\r\n        if (processedIds.has(elementId)) {\r\n            console.warn(`[extractEvents] Duplicate ID detected: ${elementId}`);\r\n            return;\r\n        }\r\n\r\n        // Check element events\r\n        if (element.componentData?.events) {\r\n            const hasValidEvent = Object.values(element.componentData.events).some(\r\n                event => event && event.type && event.type !== 'none'\r\n            );\r\n\r\n            if (hasValidEvent) {\r\n                events.push({\r\n                    elementId: elementId,\r\n                    events: element.componentData.events,\r\n                    type: element.type,\r\n                    parentId: parentId\r\n                });\r\n                processedIds.add(elementId);\r\n\r\n                console.log(`[extractEvents] Added event for: ${elementId}`, element.componentData.events);\r\n            }\r\n        }\r\n\r\n        // Check children events recursively\r\n        if (Array.isArray(element.children)) {\r\n            element.children.forEach(child => {\r\n                processElement(child, elementId); // Pass current element as parent\r\n            });\r\n        }\r\n    };\r\n\r\n    pageData.elements.forEach(element => {\r\n        processElement(element, null);\r\n    });\r\n\r\n    console.log(`[extractEvents] Total events extracted: ${events.length}`);\r\n    return events;\r\n};\r\n\r\n// ==================== FIX #3: Runtime Script v·ªõi Debug Mode ====================\r\n\r\n/**\r\n * Generate runtime script v·ªõi debug logging\r\n */\r\nconst generateEventRuntime = (events, popups) => {\r\n    return `\r\n    // Landing Page Builder Runtime v1.1 (Fixed Event Binding)\r\n    (function() {\r\n        'use strict';\r\n        \r\n        window.LPB = window.LPB || {};\r\n        \r\n        // Debug mode\r\n        const DEBUG = true;\r\n        const log = (...args) => DEBUG && console.log('[LPB]', ...args);\r\n        \r\n        // ========== POPUP MANAGER ==========\r\n        LPB.popups = {\r\n            active: new Set(),\r\n            \r\n            open: function(popupId, data) {\r\n                log('Opening popup:', popupId);\r\n                const popup = document.getElementById(popupId);\r\n                if (!popup) {\r\n                    console.error('[LPB] Popup not found:', popupId);\r\n                    return;\r\n                }\r\n                \r\n                // Update content n·∫øu c√≥ data\r\n                if (data && data.html) {\r\n                    const content = popup.querySelector('.lpb-popup-body');\r\n                    if (content) content.innerHTML = data.html;\r\n                }\r\n                \r\n                // Show popup\r\n                popup.classList.add('lpb-popup-active');\r\n                document.body.style.overflow = 'hidden';\r\n                this.active.add(popupId);\r\n                \r\n                log('Popup opened successfully:', popupId);\r\n                \r\n                // Analytics tracking\r\n                if (window.gtag) {\r\n                    gtag('event', 'popup_open', {\r\n                        event_category: 'Engagement',\r\n                        event_label: popupId\r\n                    });\r\n                }\r\n            },\r\n            \r\n            close: function(popupId) {\r\n                log('Closing popup:', popupId);\r\n                const popup = document.getElementById(popupId);\r\n                if (popup) {\r\n                    popup.classList.remove('lpb-popup-active');\r\n                    this.active.delete(popupId);\r\n                    \r\n                    // Restore scroll n·∫øu kh√¥ng c√≤n popup n√†o\r\n                    if (this.active.size === 0) {\r\n                        document.body.style.overflow = '';\r\n                    }\r\n                    log('Popup closed:', popupId);\r\n                }\r\n            },\r\n            \r\n            closeAll: function() {\r\n                log('Closing all popups');\r\n                this.active.forEach(id => this.close(id));\r\n            }\r\n        };\r\n        \r\n        // ========== API MANAGER ==========\r\n        LPB.api = {\r\n            cache: new Map(),\r\n            \r\n            getCacheKey: function(endpoint, params) {\r\n                return endpoint + JSON.stringify(params || {});\r\n            },\r\n            \r\n            fetch: async function(endpoint, options = {}) {\r\n                const cacheKey = this.getCacheKey(endpoint, options.params);\r\n                \r\n                // Check cache\r\n                if (this.cache.has(cacheKey)) {\r\n                    const cached = this.cache.get(cacheKey);\r\n                    const now = Date.now();\r\n                    const TTL = options.ttl || 5 * 60 * 1000;\r\n                    \r\n                    if (now - cached.timestamp < TTL) {\r\n                        log('Cache hit:', endpoint);\r\n                        return cached.data;\r\n                    }\r\n                }\r\n                \r\n                // Fetch m·ªõi\r\n                try {\r\n                    log('Fetching:', endpoint);\r\n                    const response = await fetch(endpoint, {\r\n                        method: options.method || 'GET',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            ...options.headers\r\n                        },\r\n                        body: options.data ? JSON.stringify(options.data) : undefined\r\n                    });\r\n                    \r\n                    if (!response.ok) {\r\n                        throw new Error(\\`HTTP \\${response.status}: \\${response.statusText}\\`);\r\n                    }\r\n                    \r\n                    const data = await response.json();\r\n                    \r\n                    // Cache result\r\n                    this.cache.set(cacheKey, {\r\n                        data: data,\r\n                        timestamp: Date.now()\r\n                    });\r\n                    \r\n                    return data;\r\n                } catch (error) {\r\n                    console.error('[LPB] API Error:', error);\r\n                    throw error;\r\n                }\r\n            },\r\n            \r\n            clearCache: function(endpoint) {\r\n                if (endpoint) {\r\n                    for (let key of this.cache.keys()) {\r\n                        if (key.startsWith(endpoint)) {\r\n                            this.cache.delete(key);\r\n                        }\r\n                    }\r\n                } else {\r\n                    this.cache.clear();\r\n                }\r\n            }\r\n        };\r\n        \r\n        // ========== EVENT HANDLER ==========\r\n        LPB.handleEvent = async function(config) {\r\n            const { type } = config;\r\n            log('Handling event:', type, config);\r\n            \r\n            try {\r\n                switch(type) {\r\n                    case 'openPopup':\r\n                        if (!config.popupId) {\r\n                            console.error('[LPB] Missing popupId');\r\n                            return;\r\n                        }\r\n                        this.popups.open(config.popupId, config.data);\r\n                        break;\r\n                        \r\n                    case 'closePopup':\r\n                        const targetPopupId = config.popupId || config.elementId;\r\n                        if (!targetPopupId) {\r\n                            console.error('[LPB] Missing popupId');\r\n                            return;\r\n                        }\r\n                        this.popups.close(targetPopupId);\r\n                        break;\r\n                        \r\n                    case 'triggerApi':\r\n                        if (!config.apiUrl) {\r\n                            console.error('[LPB] Missing apiUrl');\r\n                            return;\r\n                        }\r\n                        const data = await this.api.fetch(config.apiUrl, {\r\n                            method: config.method || 'GET',\r\n                            params: config.params,\r\n                            data: config.data\r\n                        });\r\n                        \r\n                        // Update target n·∫øu c√≥\r\n                        if (config.updateTarget) {\r\n                            const target = document.getElementById(config.updateTarget);\r\n                            if (target && data.html) {\r\n                                target.innerHTML = data.html;\r\n                            }\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'both':\r\n                        // Open popup immediately v·ªõi loading\r\n                        this.popups.open(config.popupId, { \r\n                            html: '<div style=\"text-align:center;padding:40px;\"><div class=\"lpb-spinner\"></div><p>ƒêang t·∫£i...</p></div>' \r\n                        });\r\n                        \r\n                        // Fetch API in background\r\n                        const apiData = await this.api.fetch(config.apiUrl, {\r\n                            method: config.method || 'GET',\r\n                            params: config.params\r\n                        });\r\n                        \r\n                        // Update popup content\r\n                        this.popups.open(config.popupId, { html: apiData.html || JSON.stringify(apiData) });\r\n                        break;\r\n                        \r\n                    case 'navigate':\r\n                        if (!config.url) {\r\n                            console.error('[LPB] Missing url');\r\n                            return;\r\n                        }\r\n                        if (config.newTab) {\r\n                            window.open(config.url, '_blank');\r\n                        } else {\r\n                            window.location.href = config.url;\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'scrollToSection':\r\n                        if (!config.sectionId) {\r\n                            console.error('[LPB] Missing sectionId');\r\n                            return;\r\n                        }\r\n                        const section = document.querySelector(\\`[data-element-id=\"\\${config.sectionId}\"]\\`);\r\n                        if (section) {\r\n                            section.scrollIntoView({ \r\n                                behavior: config.smooth !== false ? 'smooth' : 'auto',\r\n                                block: 'start'\r\n                            });\r\n                        } else {\r\n                            console.error('[LPB] Section not found:', config.sectionId);\r\n                        }\r\n                        break;\r\n                        \r\n                    case 'submitForm':\r\n                        if (!config.apiUrl) {\r\n                            console.error('[LPB] Missing apiUrl');\r\n                            return;\r\n                        }\r\n                        log('Form submit to:', config.apiUrl);\r\n                        break;\r\n                        \r\n                    default:\r\n                        console.warn('[LPB] Unknown event type:', type);\r\n                }\r\n            } catch (error) {\r\n                console.error('[LPB] Event handling error:', error);\r\n                alert('C√≥ l·ªói x·∫£y ra: ' + error.message);\r\n            }\r\n        };\r\n        \r\n        // ========== AUTO-BIND EVENTS (FIXED) ==========\r\n        const eventsConfig = ${JSON.stringify(events, null, 2)};\r\n        \r\n        document.addEventListener('DOMContentLoaded', function() {\r\n            log('Initializing events...', eventsConfig.length, 'configs found');\r\n            \r\n            let boundCount = 0;\r\n            let notFoundCount = 0;\r\n            \r\n            eventsConfig.forEach((config, index) => {\r\n                log(\\`Processing config #\\${index + 1}:\\`, config);\r\n                \r\n                const element = document.getElementById(config.elementId);\r\n                if (!element) {\r\n                    console.warn('[LPB] Element not found:', config.elementId);\r\n                    notFoundCount++;\r\n                    return;\r\n                }\r\n                \r\n                log('Found element:', config.elementId, element);\r\n                \r\n                // Bind onClick\r\n                if (config.events.onClick && config.events.onClick.type !== 'none') {\r\n                    element.addEventListener('click', function(e) {\r\n                        log('Click detected on:', config.elementId);\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        LPB.handleEvent(config.events.onClick);\r\n                    });\r\n                    \r\n                    element.style.cursor = 'pointer';\r\n                    boundCount++;\r\n                    log('Bound onClick to:', config.elementId);\r\n                }\r\n                \r\n                // Bind hover prefetch\r\n                if (config.events.onClick?.params?.apiConfig?.preload) {\r\n                    element.addEventListener('mouseenter', function() {\r\n                        LPB.api.fetch(\r\n                            config.events.onClick.params.apiConfig.endpoint,\r\n                            config.events.onClick.params.apiConfig\r\n                        ).catch(() => {}); // Silent prefetch\r\n                    }, { once: true });\r\n                }\r\n                \r\n                // Bind onHover effects\r\n                if (config.events.onHover) {\r\n                    const hoverClass = config.events.onHover.className;\r\n                    if (hoverClass) {\r\n                        element.addEventListener('mouseenter', function() {\r\n                            this.classList.add(hoverClass);\r\n                        });\r\n                        element.addEventListener('mouseleave', function() {\r\n                            this.classList.remove(hoverClass);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n            \r\n            log(\\`Events initialized! Bound: \\${boundCount}, Not Found: \\${notFoundCount}\\`);\r\n            \r\n            // Final validation\r\n            if (notFoundCount > 0) {\r\n                console.warn(\\`[LPB] \\${notFoundCount} elements not found in DOM. Check your HTML structure.\\`);\r\n            }\r\n        });\r\n        \r\n        // ========== ESC TO CLOSE POPUP ==========\r\n        document.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Escape') {\r\n                LPB.popups.closeAll();\r\n            }\r\n        });\r\n        \r\n        log('Runtime loaded successfully');\r\n    })();\r\n    `;\r\n};\r\n\r\n// ==================== EXPORT FUNCTIONS ====================\r\n\r\nexport {\r\n    renderElementHTML,\r\n    extractEvents,\r\n    generateEventRuntime\r\n};"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA,MAAMA,iBAAiB,GAAGA,CAACC,OAAO,EAAEC,OAAO,GAAG,KAAK,KAAK;EAAA,IAAAC,iBAAA,EAAAC,kBAAA,EAAAC,mBAAA;EACpD,MAAM;IAAEC,EAAE;IAAEC,IAAI;IAAEC,aAAa,GAAG,CAAC,CAAC;IAAEC,MAAM,GAAG,CAAC,CAAC;IAAEC,IAAI,GAAG,CAAC,CAAC;IAAEC,QAAQ,GAAG,CAAC,CAAC;IAAEC,QAAQ,GAAG;EAAG,CAAC,GAAGX,OAAO;;EAEtG;EACA,MAAMY,YAAY,GAAGC,MAAM,CAACC,OAAO,CAACN,MAAM,CAAC,CACtCO,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,KAAK,CAACA,GAAG,CAACC,UAAU,CAAC,GAAG,CAAC,IAAI,CAACD,GAAG,CAACC,UAAU,CAAC,GAAG,CAAC,CAAC,CAC/DC,GAAG,CAAC,CAAC,CAACF,GAAG,EAAEG,KAAK,CAAC,KAAK;IACnB,MAAMC,QAAQ,GAAGJ,GAAG,CAACK,OAAO,CAAC,QAAQ,EAAEC,CAAC,IAAI,IAAIA,CAAC,CAACC,WAAW,CAAC,CAAC,EAAE,CAAC;IAClE,OAAO,GAAGH,QAAQ,IAAID,KAAK,EAAE;EACjC,CAAC,CAAC,CACDK,IAAI,CAAC,GAAG,CAAC;;EAEd;EACA,MAAMC,SAAS,GAAG;AACtB,cAAcpB,EAAE;AAChB,2BAA2BA,EAAE;AAC7B,qBAAqBC,IAAI;AACzB,iCAAiCA,IAAI;AACrC,KAAK,CAACoB,IAAI,CAAC,CAAC;;EAER;EACA,MAAMC,cAAc,GAAG1B,OAAO,GAAG;AACrC;AACA,gBAAgB,EAAAC,iBAAA,GAAAQ,QAAQ,CAACkB,OAAO,cAAA1B,iBAAA,uBAAhBA,iBAAA,CAAkB2B,CAAC,KAAI,CAAC;AACxC,eAAe,EAAA1B,kBAAA,GAAAO,QAAQ,CAACkB,OAAO,cAAAzB,kBAAA,uBAAhBA,kBAAA,CAAkB2B,CAAC,KAAI,CAAC;AACvC,iBAAiBrB,IAAI,CAACsB,KAAK,IAAI,GAAG;AAClC,kBAAkBtB,IAAI,CAACuB,MAAM,IAAI,EAAE;AACnC,KAAK,GAAG,EAAE;;EAEN;EACA,QAAO1B,IAAI;IACP,KAAK,SAAS;MACV,OAAO2B,iBAAiB,CAACjC,OAAO,CAAC;IAErC,KAAK,QAAQ;MACT,OAAO;AACnB;AACA,sBAAsByB,SAAS;AAC/B,6BAA6Bb,YAAY,KAAKe,cAAc;AAC5D;AACA,sBAAsBpB,aAAa,CAAC2B,OAAO,IAAI,QAAQ;AACvD;AACA,aAAa;IAEL,KAAK,SAAS;MACV,MAAMC,UAAU,GAAG5B,aAAa,CAAC6B,KAAK,IAAI,IAAI;MAC9C,OAAO;AACnB,mBAAmBD,UAAU;AAC7B,sBAAsBV,SAAS;AAC/B,6BAA6Bb,YAAY,KAAKe,cAAc;AAC5D;AACA,sBAAsBpB,aAAa,CAAC2B,OAAO,IAAI,SAAS;AACxD,oBAAoBC,UAAU;AAC9B,aAAa;IAEL,KAAK,WAAW;MACZ,OAAO;AACnB;AACA,sBAAsBV,SAAS;AAC/B,6BAA6Bb,YAAY,KAAKe,cAAc;AAC5D;AACA,sBAAsBpB,aAAa,CAAC2B,OAAO,IAAI,WAAW;AAC1D;AACA,aAAa;IAEL,KAAK,OAAO;MACR;MACA,OAAO;AACnB;AACA,sBAAsBT,SAAS;AAC/B,2BAA2BlB,aAAa,CAAC8B,GAAG,IAAI9B,aAAa,CAAC+B,QAAQ,IAAI,iCAAiC;AAC3G,2BAA2B/B,aAAa,CAACgC,GAAG,IAAI,OAAO;AACvD,6BAA6B3B,YAAY,KAAKe,cAAc;AAC5D;AACA,aAAa;IAEL,KAAK,MAAM;MACP;MACA,MAAMa,KAAK,IAAApC,mBAAA,GAAGG,aAAa,CAACkC,IAAI,cAAArC,mBAAA,uBAAlBA,mBAAA,CAAoBa,UAAU,CAAC,MAAM,CAAC;MACpD,OAAO;AACnB;AACA,sBAAsBQ,SAAS;AAC/B,6BAA6Bb,YAAY,KAAKe,cAAc;AAC5D,6BAA6BpB,aAAa,CAACmC,KAAK,IAAI,EAAE;AACtD;AACA,sBAAsBnC,aAAa,CAAC+B,QAAQ,GAC1B,aAAa/B,aAAa,CAAC+B,QAAQ,UAAU/B,aAAa,CAACmC,KAAK,IAAI,MAAM,yDAAyD,GACnIF,KAAK,GACDjC,aAAa,CAACkC,IAAI,GAClBlC,aAAa,CAACkC,IAAI,GACd,aAAalC,aAAa,CAACkC,IAAI,QAAQ,GACvC,IAAI;AAC9B;AACA,aACa;IAEL,KAAK,SAAS;MACV,OAAOE,iBAAiB,CAAC3C,OAAO,EAAEC,OAAO,CAAC;IAE9C;MACI,OAAO;AACnB;AACA,sBAAsBwB,SAAS;AAC/B,6BAA6Bb,YAAY,KAAKe,cAAc;AAC5D;AACA,sBAAsBpB,aAAa,CAAC2B,OAAO,IAAI5B,IAAI;AACnD;AACA,aAAa;EACT;AACJ,CAAC;;AAED;;AAEA;AACA;AACA;AACA,MAAMsC,aAAa,GAAIC,QAAQ,IAAK;EAChC,MAAMC,MAAM,GAAG,EAAE;EACjB,MAAMC,YAAY,GAAG,IAAIC,GAAG,CAAC,CAAC,CAAC,CAAC;;EAEhC,MAAMC,cAAc,GAAGA,CAACjD,OAAO,EAAEkD,QAAQ,GAAG,IAAI,KAAK;IAAA,IAAAC,qBAAA;IACjD,MAAMC,SAAS,GAAGpD,OAAO,CAACK,EAAE;;IAE5B;IACA,IAAI0C,YAAY,CAACM,GAAG,CAACD,SAAS,CAAC,EAAE;MAC7BE,OAAO,CAACC,IAAI,CAAC,0CAA0CH,SAAS,EAAE,CAAC;MACnE;IACJ;;IAEA;IACA,KAAAD,qBAAA,GAAInD,OAAO,CAACO,aAAa,cAAA4C,qBAAA,eAArBA,qBAAA,CAAuBL,MAAM,EAAE;MAC/B,MAAMU,aAAa,GAAG3C,MAAM,CAAC4C,MAAM,CAACzD,OAAO,CAACO,aAAa,CAACuC,MAAM,CAAC,CAACY,IAAI,CAClEC,KAAK,IAAIA,KAAK,IAAIA,KAAK,CAACrD,IAAI,IAAIqD,KAAK,CAACrD,IAAI,KAAK,MACnD,CAAC;MAED,IAAIkD,aAAa,EAAE;QACfV,MAAM,CAACc,IAAI,CAAC;UACRR,SAAS,EAAEA,SAAS;UACpBN,MAAM,EAAE9C,OAAO,CAACO,aAAa,CAACuC,MAAM;UACpCxC,IAAI,EAAEN,OAAO,CAACM,IAAI;UAClB4C,QAAQ,EAAEA;QACd,CAAC,CAAC;QACFH,YAAY,CAACc,GAAG,CAACT,SAAS,CAAC;QAE3BE,OAAO,CAACQ,GAAG,CAAC,oCAAoCV,SAAS,EAAE,EAAEpD,OAAO,CAACO,aAAa,CAACuC,MAAM,CAAC;MAC9F;IACJ;;IAEA;IACA,IAAIiB,KAAK,CAACC,OAAO,CAAChE,OAAO,CAACW,QAAQ,CAAC,EAAE;MACjCX,OAAO,CAACW,QAAQ,CAACsD,OAAO,CAACC,KAAK,IAAI;QAC9BjB,cAAc,CAACiB,KAAK,EAAEd,SAAS,CAAC,CAAC,CAAC;MACtC,CAAC,CAAC;IACN;EACJ,CAAC;EAEDP,QAAQ,CAACsB,QAAQ,CAACF,OAAO,CAACjE,OAAO,IAAI;IACjCiD,cAAc,CAACjD,OAAO,EAAE,IAAI,CAAC;EACjC,CAAC,CAAC;EAEFsD,OAAO,CAACQ,GAAG,CAAC,2CAA2ChB,MAAM,CAACsB,MAAM,EAAE,CAAC;EACvE,OAAOtB,MAAM;AACjB,CAAC;;AAED;;AAEA;AACA;AACA;AACA,MAAMuB,oBAAoB,GAAGA,CAACvB,MAAM,EAAEwB,MAAM,KAAK;EAC7C,OAAO;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+BC,IAAI,CAACC,SAAS,CAAC1B,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;;AAED;;AAEA,SACI/C,iBAAiB,EACjB6C,aAAa,EACbyB,oBAAoB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}