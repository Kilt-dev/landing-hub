{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport imageService from '../services/imageService'; // Add this import\nimport { toast } from 'react-toastify';\nexport const useImageUpload = (pageId = null) => {\n  _s();\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [uploadedImages, setUploadedImages] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  // Load images when pageId changes\n  useEffect(() => {\n    if (pageId) {\n      loadPageImages(pageId);\n    } else {\n      loadAllImages();\n    }\n  }, [pageId]);\n\n  // Load images for specific page\n  const loadPageImages = useCallback(async targetPageId => {\n    setLoading(true);\n    try {\n      const response = await imageService.getPageImages(targetPageId);\n      setUploadedImages(response.data || []);\n    } catch (err) {\n      console.error('Failed to load page images:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Load all user images\n  const loadAllImages = useCallback(async () => {\n    setLoading(true);\n    try {\n      const response = await imageService.getUserImages();\n      setUploadedImages(response.data || []);\n    } catch (err) {\n      console.error('Failed to load images:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Upload single image\n  const uploadImage = useCallback(async (file, options = {}) => {\n    const {\n      compress = true,\n      validate = true,\n      targetPageId = pageId\n    } = options;\n    try {\n      // Validate\n      if (validate) {\n        const validation = imageService.validateImageFile(file);\n        if (!validation.valid) {\n          toast.error(validation.error);\n          return null;\n        }\n      }\n      setUploading(true);\n      setProgress(0);\n      setError(null);\n\n      // Compress if needed\n      let fileToUpload = file;\n      if (compress) {\n        toast.info('Đang nén ảnh...');\n        fileToUpload = await imageService.compressImage(file);\n      }\n\n      // Upload\n      const response = await imageService.uploadImage(fileToUpload, targetPageId, setProgress);\n      toast.success('Upload ảnh thành công!');\n      setUploadedImages(prev => [response.data, ...prev]);\n      return response.data;\n    } catch (err) {\n      console.error('Upload error:', err);\n      setError(err.message);\n      toast.error(err.message || 'Upload thất bại');\n      return null;\n    } finally {\n      setUploading(false);\n      setProgress(0);\n    }\n  }, [pageId]);\n\n  // Upload multiple images\n  const uploadMultiple = useCallback(async (files, options = {}) => {\n    const {\n      compress = true,\n      validate = true,\n      targetPageId = pageId\n    } = options;\n    try {\n      // Validate all files\n      if (validate) {\n        for (const file of files) {\n          const validation = imageService.validateImageFile(file);\n          if (!validation.valid) {\n            toast.error(`${file.name}: ${validation.error}`);\n            return [];\n          }\n        }\n      }\n      setUploading(true);\n      setProgress(0);\n      setError(null);\n\n      // Compress if needed\n      let filesToUpload = files;\n      if (compress) {\n        toast.info('Đang nén ảnh...');\n        filesToUpload = await Promise.all(files.map(file => imageService.compressImage(file)));\n      }\n\n      // Upload\n      const response = await imageService.uploadMultipleImages(filesToUpload, targetPageId, setProgress);\n      toast.success(`Upload ${response.data.length} ảnh thành công!`);\n      setUploadedImages(prev => [...response.data, ...prev]);\n      return response.data;\n    } catch (err) {\n      console.error('Upload error:', err);\n      setError(err.message);\n      toast.error(err.message || 'Upload thất bại');\n      return [];\n    } finally {\n      setUploading(false);\n      setProgress(0);\n    }\n  }, [pageId]);\n\n  // Delete image\n  const deleteImage = useCallback(async key => {\n    try {\n      await imageService.deleteImage(key);\n      setUploadedImages(prev => prev.filter(img => img.key !== key));\n      toast.success('Xóa ảnh thành công!');\n      return true;\n    } catch (err) {\n      console.error('Delete error:', err);\n      toast.error(err.message || 'Xóa ảnh thất bại');\n      return false;\n    }\n  }, []);\n\n  // Refresh images\n  const refreshImages = useCallback(() => {\n    if (pageId) {\n      loadPageImages(pageId);\n    } else {\n      loadAllImages();\n    }\n  }, [pageId, loadPageImages, loadAllImages]);\n  return {\n    uploading,\n    progress,\n    uploadedImages,\n    error,\n    loading,\n    loadPageImages,\n    loadAllImages,\n    uploadImage,\n    uploadMultiple,\n    deleteImage,\n    refreshImages,\n    setUploadedImages\n  };\n};\n_s(useImageUpload, \"du7Xa1xFJTXe5mr+0q6V0DpA/pw=\");\nexport default useImageUpload;","map":{"version":3,"names":["useState","useEffect","useCallback","imageService","toast","useImageUpload","pageId","_s","uploading","setUploading","progress","setProgress","uploadedImages","setUploadedImages","error","setError","loading","setLoading","loadPageImages","loadAllImages","targetPageId","response","getPageImages","data","err","console","message","getUserImages","uploadImage","file","options","compress","validate","validation","validateImageFile","valid","fileToUpload","info","compressImage","success","prev","uploadMultiple","files","name","filesToUpload","Promise","all","map","uploadMultipleImages","length","deleteImage","key","filter","img","refreshImages"],"sources":["F:/landinghub-iconic/apps/web/src/components/useImageUpload.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport imageService from '../services/imageService'; // Add this import\r\nimport { toast } from 'react-toastify';\r\n\r\nexport const useImageUpload = (pageId = null) => {\r\n    const [uploading, setUploading] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [uploadedImages, setUploadedImages] = useState([]);\r\n    const [error, setError] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Load images when pageId changes\r\n    useEffect(() => {\r\n        if (pageId) {\r\n            loadPageImages(pageId);\r\n        } else {\r\n            loadAllImages();\r\n        }\r\n    }, [pageId]);\r\n\r\n    // Load images for specific page\r\n    const loadPageImages = useCallback(async (targetPageId) => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await imageService.getPageImages(targetPageId);\r\n            setUploadedImages(response.data || []);\r\n        } catch (err) {\r\n            console.error('Failed to load page images:', err);\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    // Load all user images\r\n    const loadAllImages = useCallback(async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await imageService.getUserImages();\r\n            setUploadedImages(response.data || []);\r\n        } catch (err) {\r\n            console.error('Failed to load images:', err);\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    // Upload single image\r\n    const uploadImage = useCallback(async (file, options = {}) => {\r\n        const { compress = true, validate = true, targetPageId = pageId } = options;\r\n\r\n        try {\r\n            // Validate\r\n            if (validate) {\r\n                const validation = imageService.validateImageFile(file);\r\n                if (!validation.valid) {\r\n                    toast.error(validation.error);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            setUploading(true);\r\n            setProgress(0);\r\n            setError(null);\r\n\r\n            // Compress if needed\r\n            let fileToUpload = file;\r\n            if (compress) {\r\n                toast.info('Đang nén ảnh...');\r\n                fileToUpload = await imageService.compressImage(file);\r\n            }\r\n\r\n            // Upload\r\n            const response = await imageService.uploadImage(\r\n                fileToUpload,\r\n                targetPageId,\r\n                setProgress\r\n            );\r\n\r\n            toast.success('Upload ảnh thành công!');\r\n            setUploadedImages(prev => [response.data, ...prev]);\r\n\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('Upload error:', err);\r\n            setError(err.message);\r\n            toast.error(err.message || 'Upload thất bại');\r\n            return null;\r\n        } finally {\r\n            setUploading(false);\r\n            setProgress(0);\r\n        }\r\n    }, [pageId]);\r\n\r\n    // Upload multiple images\r\n    const uploadMultiple = useCallback(async (files, options = {}) => {\r\n        const { compress = true, validate = true, targetPageId = pageId } = options;\r\n\r\n        try {\r\n            // Validate all files\r\n            if (validate) {\r\n                for (const file of files) {\r\n                    const validation = imageService.validateImageFile(file);\r\n                    if (!validation.valid) {\r\n                        toast.error(`${file.name}: ${validation.error}`);\r\n                        return [];\r\n                    }\r\n                }\r\n            }\r\n\r\n            setUploading(true);\r\n            setProgress(0);\r\n            setError(null);\r\n\r\n            // Compress if needed\r\n            let filesToUpload = files;\r\n            if (compress) {\r\n                toast.info('Đang nén ảnh...');\r\n                filesToUpload = await Promise.all(\r\n                    files.map(file => imageService.compressImage(file))\r\n                );\r\n            }\r\n\r\n            // Upload\r\n            const response = await imageService.uploadMultipleImages(\r\n                filesToUpload,\r\n                targetPageId,\r\n                setProgress\r\n            );\r\n\r\n            toast.success(`Upload ${response.data.length} ảnh thành công!`);\r\n            setUploadedImages(prev => [...response.data, ...prev]);\r\n\r\n            return response.data;\r\n        } catch (err) {\r\n            console.error('Upload error:', err);\r\n            setError(err.message);\r\n            toast.error(err.message || 'Upload thất bại');\r\n            return [];\r\n        } finally {\r\n            setUploading(false);\r\n            setProgress(0);\r\n        }\r\n    }, [pageId]);\r\n\r\n    // Delete image\r\n    const deleteImage = useCallback(async (key) => {\r\n        try {\r\n            await imageService.deleteImage(key);\r\n            setUploadedImages(prev => prev.filter(img => img.key !== key));\r\n            toast.success('Xóa ảnh thành công!');\r\n            return true;\r\n        } catch (err) {\r\n            console.error('Delete error:', err);\r\n            toast.error(err.message || 'Xóa ảnh thất bại');\r\n            return false;\r\n        }\r\n    }, []);\r\n\r\n    // Refresh images\r\n    const refreshImages = useCallback(() => {\r\n        if (pageId) {\r\n            loadPageImages(pageId);\r\n        } else {\r\n            loadAllImages();\r\n        }\r\n    }, [pageId, loadPageImages, loadAllImages]);\r\n\r\n    return {\r\n        uploading,\r\n        progress,\r\n        uploadedImages,\r\n        error,\r\n        loading,\r\n        loadPageImages,\r\n        loadAllImages,\r\n        uploadImage,\r\n        uploadMultiple,\r\n        deleteImage,\r\n        refreshImages,\r\n        setUploadedImages\r\n    };\r\n};\r\n\r\nexport default useImageUpload;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}