{"ast":null,"code":"// utils/eventController.js\nimport { toast } from \"react-toastify\";\nclass EventUtils {\n  constructor() {\n    this.subscribers = {}; // { eventName: [callbacks] }\n    this.cache = new Map(); // Dự phòng cho cache API trong tương lai\n  }\n\n  // Đăng ký lắng nghe sự kiện\n  subscribe(eventName, callback) {\n    if (!this.subscribers[eventName]) {\n      this.subscribers[eventName] = [];\n    }\n    this.subscribers[eventName].push(callback);\n    return () => this.unsubscribe(eventName, callback); // Trả về hàm hủy đăng ký\n  }\n\n  // Hủy đăng ký sự kiện\n  unsubscribe(eventName, callback) {\n    if (this.subscribers[eventName]) {\n      this.subscribers[eventName] = this.subscribers[eventName].filter(cb => cb !== callback);\n    }\n  }\n\n  // Phát sự kiện với dữ liệu kèm theo\n  dispatch(eventName, payload = {}) {\n    if (this.subscribers[eventName]) {\n      this.subscribers[eventName].forEach(callback => {\n        try {\n          callback(payload);\n        } catch (error) {\n          console.error(`Lỗi trong callback ${eventName}:`, error);\n          toast.error(`Lỗi xử lý ${eventName}: ${error.message}`, {\n            position: \"bottom-right\",\n            autoClose: 2000\n          });\n        }\n      });\n    }\n  }\n\n  // Xử lý các sự kiện từ ButtonPropertiesPanel\n  handleEvent(config, elementId, isCanvas = false) {\n    const {\n      type,\n      popupId,\n      url,\n      newTab,\n      sectionId,\n      smooth,\n      apiUrl,\n      method\n    } = config;\n    switch (type) {\n      case \"openPopup\":\n        if (!popupId) {\n          toast.error(\"Không tìm thấy ID của popup!\");\n          return;\n        }\n        this.dispatch(\"popup-open\", {\n          popupId,\n          elementId\n        });\n        if (isCanvas) toast.info(`Mô phỏng: Mở popup \"${popupId}\"`);\n        break;\n      case \"closePopup\":\n        const targetPopupId = popupId || elementId;\n        if (!targetPopupId) {\n          toast.error(\"Không tìm thấy ID của popup để đóng!\");\n          return;\n        }\n        this.dispatch(\"popup-close\", {\n          popupId: targetPopupId,\n          elementId\n        });\n        if (isCanvas) toast.info(`Mô phỏng: Đóng popup \"${targetPopupId}\"`);\n        break;\n      case \"navigate\":\n        if (!url) {\n          toast.error(\"Không tìm thấy URL để điều hướng!\");\n          return;\n        }\n        if (isCanvas) {\n          toast.info(`Mô phỏng: Điều hướng đến ${url}`);\n        } else {\n          window.open(url, newTab ? \"_blank\" : \"_self\");\n        }\n        break;\n      case \"scrollToSection\":\n        if (!sectionId) {\n          toast.error(\"Không tìm thấy ID của section!\");\n          return;\n        }\n        const sectionElement = document.querySelector(`[data-element-id=\"${sectionId}\"]`);\n        if (sectionElement) {\n          sectionElement.scrollIntoView({\n            behavior: smooth !== false ? \"smooth\" : \"auto\",\n            block: \"start\"\n          });\n          if (isCanvas) toast.info(`Mô phỏng: Cuộn đến section \"${sectionId}\"`);\n        } else {\n          toast.error(\"Không tìm thấy section!\");\n        }\n        break;\n      case \"submitForm\":\n      case \"triggerApi\":\n        if (!apiUrl) {\n          toast.error(\"Không tìm thấy URL API!\");\n          return;\n        }\n        if (isCanvas) {\n          toast.info(`Mô phỏng: ${type === \"submitForm\" ? \"Gửi form\" : \"Gọi API\"} đến ${apiUrl} (${method || \"POST\"})`);\n        } else {\n          toast.info(`Gọi API đến ${apiUrl} chưa được triển khai.`);\n        }\n        break;\n      case \"none\":\n        break;\n      default:\n        toast.warn(`Loại sự kiện \"${type}\" không được hỗ trợ.`);\n        break;\n    }\n  }\n\n  // Tải trước nội dung (dự phòng cho tương lai)\n  prefetch(config) {\n    if (config.type === \"openPopup\" && config.popupId) {\n      console.log(`Tải trước nội dung popup: ${config.popupId}`);\n      this.dispatch(\"popup-prefetch\", {\n        popupId: config.popupId\n      });\n    } else if (config.type === \"triggerApi\" && config.apiUrl) {\n      console.log(`Tải trước dữ liệu API: ${config.apiUrl}`);\n    }\n  }\n}\n\n// Singleton instance\nconst eventController = new EventUtils();\nexport default eventController;","map":{"version":3,"names":["toast","EventUtils","constructor","subscribers","cache","Map","subscribe","eventName","callback","push","unsubscribe","filter","cb","dispatch","payload","forEach","error","console","message","position","autoClose","handleEvent","config","elementId","isCanvas","type","popupId","url","newTab","sectionId","smooth","apiUrl","method","info","targetPopupId","window","open","sectionElement","document","querySelector","scrollIntoView","behavior","block","warn","prefetch","log","eventController"],"sources":["F:/landinghub-iconic/apps/web/src/utils/EventUtils.js"],"sourcesContent":["// utils/eventController.js\r\nimport { toast } from \"react-toastify\";\r\n\r\nclass EventUtils {\r\n    constructor() {\r\n        this.subscribers = {}; // { eventName: [callbacks] }\r\n        this.cache = new Map(); // Dự phòng cho cache API trong tương lai\r\n    }\r\n\r\n    // Đăng ký lắng nghe sự kiện\r\n    subscribe(eventName, callback) {\r\n        if (!this.subscribers[eventName]) {\r\n            this.subscribers[eventName] = [];\r\n        }\r\n        this.subscribers[eventName].push(callback);\r\n        return () => this.unsubscribe(eventName, callback); // Trả về hàm hủy đăng ký\r\n    }\r\n\r\n    // Hủy đăng ký sự kiện\r\n    unsubscribe(eventName, callback) {\r\n        if (this.subscribers[eventName]) {\r\n            this.subscribers[eventName] = this.subscribers[eventName].filter(\r\n                (cb) => cb !== callback\r\n            );\r\n        }\r\n    }\r\n\r\n    // Phát sự kiện với dữ liệu kèm theo\r\n    dispatch(eventName, payload = {}) {\r\n        if (this.subscribers[eventName]) {\r\n            this.subscribers[eventName].forEach((callback) => {\r\n                try {\r\n                    callback(payload);\r\n                } catch (error) {\r\n                    console.error(`Lỗi trong callback ${eventName}:`, error);\r\n                    toast.error(`Lỗi xử lý ${eventName}: ${error.message}`, {\r\n                        position: \"bottom-right\",\r\n                        autoClose: 2000,\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    // Xử lý các sự kiện từ ButtonPropertiesPanel\r\n    handleEvent(config, elementId, isCanvas = false) {\r\n        const { type, popupId, url, newTab, sectionId, smooth, apiUrl, method } = config;\r\n        switch (type) {\r\n            case \"openPopup\":\r\n                if (!popupId) {\r\n                    toast.error(\"Không tìm thấy ID của popup!\");\r\n                    return;\r\n                }\r\n                this.dispatch(\"popup-open\", { popupId, elementId });\r\n                if (isCanvas) toast.info(`Mô phỏng: Mở popup \"${popupId}\"`);\r\n                break;\r\n            case \"closePopup\":\r\n                const targetPopupId = popupId || elementId;\r\n                if (!targetPopupId) {\r\n                    toast.error(\"Không tìm thấy ID của popup để đóng!\");\r\n                    return;\r\n                }\r\n                this.dispatch(\"popup-close\", { popupId: targetPopupId, elementId });\r\n                if (isCanvas) toast.info(`Mô phỏng: Đóng popup \"${targetPopupId}\"`);\r\n                break;\r\n            case \"navigate\":\r\n                if (!url) {\r\n                    toast.error(\"Không tìm thấy URL để điều hướng!\");\r\n                    return;\r\n                }\r\n                if (isCanvas) {\r\n                    toast.info(`Mô phỏng: Điều hướng đến ${url}`);\r\n                } else {\r\n                    window.open(url, newTab ? \"_blank\" : \"_self\");\r\n                }\r\n                break;\r\n            case \"scrollToSection\":\r\n                if (!sectionId) {\r\n                    toast.error(\"Không tìm thấy ID của section!\");\r\n                    return;\r\n                }\r\n                const sectionElement = document.querySelector(`[data-element-id=\"${sectionId}\"]`);\r\n                if (sectionElement) {\r\n                    sectionElement.scrollIntoView({ behavior: smooth !== false ? \"smooth\" : \"auto\", block: \"start\" });\r\n                    if (isCanvas) toast.info(`Mô phỏng: Cuộn đến section \"${sectionId}\"`);\r\n                } else {\r\n                    toast.error(\"Không tìm thấy section!\");\r\n                }\r\n                break;\r\n            case \"submitForm\":\r\n            case \"triggerApi\":\r\n                if (!apiUrl) {\r\n                    toast.error(\"Không tìm thấy URL API!\");\r\n                    return;\r\n                }\r\n                if (isCanvas) {\r\n                    toast.info(`Mô phỏng: ${type === \"submitForm\" ? \"Gửi form\" : \"Gọi API\"} đến ${apiUrl} (${method || \"POST\"})`);\r\n                } else {\r\n                    toast.info(`Gọi API đến ${apiUrl} chưa được triển khai.`);\r\n                }\r\n                break;\r\n            case \"none\":\r\n                break;\r\n            default:\r\n                toast.warn(`Loại sự kiện \"${type}\" không được hỗ trợ.`);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Tải trước nội dung (dự phòng cho tương lai)\r\n    prefetch(config) {\r\n        if (config.type === \"openPopup\" && config.popupId) {\r\n            console.log(`Tải trước nội dung popup: ${config.popupId}`);\r\n            this.dispatch(\"popup-prefetch\", { popupId: config.popupId });\r\n        } else if (config.type === \"triggerApi\" && config.apiUrl) {\r\n            console.log(`Tải trước dữ liệu API: ${config.apiUrl}`);\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nconst eventController = new EventUtils();\r\nexport default eventController;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}